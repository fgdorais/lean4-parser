<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.DocString.Links</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.DocString.Links";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">DocString</span>.<span class="name">Links</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/Syntax.html">Lean.Syntax</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.DocString.Links" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.manualRoot"><span class="name">Lean</span>.<span class="name">manualRoot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.rewriteManualLinksCore"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.rewriteManualLinksCore.urlChar"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span>.<span class="name">urlChar</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.rewriteManualLinksCore.lookingAt"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span>.<span class="name">lookingAt</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.rewriteManualLinksCore.rw"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span>.<span class="name">rw</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.rewriteManualLinks"><span class="name">Lean</span>.<span class="name">rewriteManualLinks</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.validateBuiltinDocString"><span class="name">Lean</span>.<span class="name">validateBuiltinDocString</span></a></div></nav><main>
<div class="decl" id="Lean.manualRoot"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L19-L36">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.manualRoot"><span class="name">Lean</span>.<span class="name">manualRoot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><p>Computes the root of the Lean reference manual that should be used for targets.</p><p>If the environment variable <code>LEAN_MANUAL_ROOT</code> is set, it is used as the root. If not, but a manual
root is pre-configured for the current Lean executable (typically true for releases), then it is
used. If neither are true, then <code>https://lean-lang.org/doc/reference/latest/</code> is used.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.manualRoot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.rewriteManualLinksCore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L38-L117">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinksCore"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> (<span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> (<a href="../.././Lean/Syntax.html#String.Range">String.Range</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Init/Prelude.html#String">String</a>)</span> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Init/Prelude.html#String">String</a>)</span></div></div><p>Rewrites links from the internal Lean manual syntax to the correct URL. This rewriting is an
overapproximation: any parentheses containing the internal syntax of a Lean manual URL is rewritten.</p><p>The internal syntax is the URL scheme <code>lean-manual</code> followed by the path <code>/KIND/MORE...</code>, where
<code>KIND</code> is a kind of content being linked to. Presently, the only valid kind is <code>section</code>, and it
requires that the remainder of the path consists of one element, which is a section or part identifier.</p><p>The correct URL is based on a manual root URL, which is determined by the <code>LEAN_MANUAL_ROOT</code>
environment variable. If this environment variable is not set, a manual root provided when Lean was
built is used (typically this is the version corresponding to the current release). If no such root
is available, the latest version of the manual is used.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.rewriteManualLinksCore" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.rewriteManualLinksCore.urlChar"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L89-L97">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinksCore.urlChar"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span>.<span class="name">urlChar</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href="../.././Init/Prelude.html#Char">Char</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Returns <code>true</code> if the character is one of those allowed in RFC 3986 sections 2.2 and 2.3. other
than '(' or')'.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.rewriteManualLinksCore.urlChar" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.rewriteManualLinksCore.lookingAt"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L102-L103">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinksCore.lookingAt"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span>.<span class="name">lookingAt</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">goal</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">iter</span> : <a href="../.././Init/Data/String/Basic.html#String.Iterator">String.Iterator</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Returns <code>true</code> if <code>goal</code> is a prefix of the string at the position pointed to by <code>iter</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinksCore.lookingAt">Lean.rewriteManualLinksCore.lookingAt</a> <span class="fn">goal</span> <span class="fn">iter</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">iter</span>.<a href="../.././Init/Data/String/Basic.html#String.Iterator.s">s</a></span>.<a href="../.././Init/Data/String/Basic.html#String.substrEq">substrEq</a></span> <span class="fn"><span class="fn">iter</span>.<a href="../.././Init/Data/String/Basic.html#String.Iterator.i">i</a></span> <span class="fn">goal</span> <span class="fn">0</span> <span class="fn"><span class="fn"><span class="fn">goal</span>.<a href="../.././Init/Prelude.html#String.endPos">endPos</a></span>.<a href="../.././Init/Prelude.html#String.Pos.byteIdx">byteIdx</a></span></span></li></ul></details><details id="instances-for-list-Lean.rewriteManualLinksCore.lookingAt" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.rewriteManualLinksCore.rw"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L105-L117">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinksCore.rw"><span class="name">Lean</span>.<span class="name">rewriteManualLinksCore</span>.<span class="name">rw</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">path</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/Prelude.html#String">String</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.rewriteManualLinksCore.rw" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.rewriteManualLinks"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L120-L137">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinks"><span class="name">Lean</span>.<span class="name">rewriteManualLinks</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">docString</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#String">String</a></span></div></div><p>Rewrites Lean reference manual links in <code>docstring</code> to point at the reference manual.</p><p>This assumes that all such links have already been validated by <code>validateDocComment</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.rewriteManualLinks" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.validateBuiltinDocString"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/DocString/Links.lean#L140-L153">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/DocString/Links.html#Lean.validateBuiltinDocString"><span class="name">Lean</span>.<span class="name">validateBuiltinDocString</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">docString</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Validates all links to the Lean reference manual in <code>docstring</code>, printing an error message if any
are invalid. Returns <code>true</code> if all links are valid.</p><p>This is intended to be used before saving a docstring that is later subject to rewriting with
<code><a href="../.././Lean/DocString/Links.html#Lean.rewriteManualLinks">rewriteManualLinks</a></code>, in contexts where the imports needed to produce better error messages in
<code>validateDocComment</code> are not yet available.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.validateBuiltinDocString" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>