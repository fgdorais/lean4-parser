<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="icon" href=".././favicon.svg"></link><link rel="mask-icon" href=".././favicon.svg" color="#000000"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.CoreM</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.CoreM";</script><script type="module" src=".././jump-src.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././expand-nav.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">CoreM</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Lean/Log.html">Lean.Log</a></li><li><a href=".././Lean/MonadEnv.html">Lean.MonadEnv</a></li><li><a href=".././Lean/ResolveName.html">Lean.ResolveName</a></li><li><a href=".././Lean/Elab/Exception.html">Lean.Elab.Exception</a></li><li><a href=".././Lean/Language/Basic.html">Lean.Language.Basic</a></li><li><a href=".././Lean/Util/RecDepth.html">Lean.Util.RecDepth</a></li><li><a href=".././Lean/Util/Trace.html">Lean.Util.Trace</a></li><li><a href=".././Lean/Elab/InfoTree/Types.html">Lean.Elab.InfoTree.Types</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.CoreM" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.diagnostics"><span class="name">Lean</span>.<span class="name">diagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.diagnostics.threshold"><span class="name">Lean</span>.<span class="name">diagnostics</span>.<span class="name">threshold</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.maxHeartbeats"><span class="name">Lean</span>.<span class="name">maxHeartbeats</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Elab.async"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">async</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Elab.inServer"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">inServer</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.internal.cmdlineSnapshots"><span class="name">Lean</span>.<span class="name">internal</span>.<span class="name">cmdlineSnapshots</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.useDiagnosticMsg"><span class="name">Lean</span>.<span class="name">useDiagnosticMsg</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.getMaxHeartbeats"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getMaxHeartbeats</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.InstantiateLevelCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">InstantiateLevelCache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.Cache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">Cache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instInhabitedCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instInhabitedCache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.State"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">State</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instNonemptyState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instNonemptyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.Context"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">Context</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instNonemptyContext"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instNonemptyContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.CoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instInhabitedCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instInhabitedCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadRefCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadRefCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadEnvCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadEnvCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadOptionsCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadOptionsCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadWithOptionsCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadWithOptionsCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instAddMessageContextCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instAddMessageContextCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadNameGeneratorCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadNameGeneratorCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadRecDepthCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadRecDepthCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadResolveNameCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadResolveNameCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.withFreshMacroScope"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withFreshMacroScope</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadQuotationCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadQuotationCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadInfoTreeCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadInfoTreeCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.modifyCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">modifyCache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.modifyInstLevelTypeCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">modifyInstLevelTypeCache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.modifyInstLevelValueCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">modifyInstLevelValueCache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instantiateTypeLevelParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instantiateValueLevelParams"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instantiateValueLevelParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.liftIOCore"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">liftIOCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadLiftIOCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadLiftIOCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadTraceCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadTraceCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.SavedState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">SavedState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instNonemptySavedState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instNonemptySavedState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.saveState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">saveState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.withRestoreOrSaveFull"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withRestoreOrSaveFull</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.SavedState.restore"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">SavedState</span>.<span class="name">restore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.mkFreshUserName"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">mkFreshUserName</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.CoreM.run"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span>.<span class="name">run</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.CoreM.run'"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span>.<span class="name">run'</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.CoreM.toIO"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span>.<span class="name">toIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.withIncRecDepth"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withIncRecDepth</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.checkInterrupted"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkInterrupted</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.debug.moduleNameAtTimeout"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">debug</span>.<span class="name">moduleNameAtTimeout</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.throwMaxHeartbeat"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">throwMaxHeartbeat</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.checkMaxHeartbeatsCore"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkMaxHeartbeatsCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.checkMaxHeartbeats"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkMaxHeartbeats</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.checkSystem"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkSystem</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.withCurrHeartbeats"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withCurrHeartbeats</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.setMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">setMessageLog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.resetMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">resetMessageLog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.getMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getMessageLog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.getAndEmptyMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getAndEmptyMessageLog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.getAndEmptySnapshotTasks"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getAndEmptySnapshotTasks</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.instMonadLogCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadLogCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.logSnapshotTask"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">logSnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.wrapAsync"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">wrapAsync</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.stderrAsMessages"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">stderrAsMessages</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.mkSnapshot"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">mkSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.wrapAsyncAsSnapshot"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">wrapAsyncAsSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.withAtLeastMaxRecDepth"><span class="name">Lean</span>.<span class="name">withAtLeastMaxRecDepth</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.catchInternalId"><span class="name">Lean</span>.<span class="name">catchInternalId</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.catchInternalIds"><span class="name">Lean</span>.<span class="name">catchInternalIds</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Exception.isMaxHeartbeat"><span class="name">Lean</span>.<span class="name">Exception</span>.<span class="name">isMaxHeartbeat</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkArrow"><span class="name">Lean</span>.<span class="name">mkArrow</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkArrowN"><span class="name">Lean</span>.<span class="name">mkArrowN</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.compiler.enableNew"><span class="name">Lean</span>.<span class="name">compiler</span>.<span class="name">enableNew</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.traceBlock"><span class="name">Lean</span>.<span class="name">traceBlock</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.compileDeclsNew"><span class="name">Lean</span>.<span class="name">compileDeclsNew</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.compileDeclsOld"><span class="name">Lean</span>.<span class="name">compileDeclsOld</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.compileDecls"><span class="name">Lean</span>.<span class="name">compileDecls</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.compileDecls.doCompile"><span class="name">Lean</span>.<span class="name">compileDecls</span>.<span class="name">doCompile</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.compileDecl"><span class="name">Lean</span>.<span class="name">compileDecl</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.getDiag"><span class="name">Lean</span>.<span class="name">getDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">isDiagnosticsEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM.runCoreM"><span class="name">Lean</span>.<span class="name">ImportM</span>.<span class="name">runCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Exception.isRuntime"><span class="name">Lean</span>.<span class="name">Exception</span>.<span class="name">isRuntime</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.tryCatch"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">tryCatch</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Core.tryCatchRuntimeEx"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">tryCatchRuntimeEx</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadExceptOfExceptionCoreM"><span class="name">Lean</span>.<span class="name">instMonadExceptOfExceptionCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MonadRuntimeException"><span class="name">Lean</span>.<span class="name">MonadRuntimeException</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadRuntimeExceptionCoreM"><span class="name">Lean</span>.<span class="name">instMonadRuntimeExceptionCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadRuntimeExceptionReaderT"><span class="name">Lean</span>.<span class="name">instMonadRuntimeExceptionReaderT</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadRuntimeExceptionStateRefT'"><span class="name">Lean</span>.<span class="name">instMonadRuntimeExceptionStateRefT'</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mapCoreM"><span class="name">Lean</span>.<span class="name">mapCoreM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.logMessageKind"><span class="name">Lean</span>.<span class="name">logMessageKind</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.enableRealizationsForConst"><span class="name">Lean</span>.<span class="name">enableRealizationsForConst</span></a></div></nav><main>
<div class="decl" id="Lean.diagnostics"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L17-L21">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.diagnostics"><span class="name">Lean</span>.<span class="name">diagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.diagnostics.threshold"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L23-L27">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.diagnostics.threshold"><span class="name">Lean</span>.<span class="name">diagnostics</span>.<span class="name">threshold</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></div></div></div><div class="decl" id="Lean.maxHeartbeats"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L29-L32">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.maxHeartbeats"><span class="name">Lean</span>.<span class="name">maxHeartbeats</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></div></div></div><div class="decl" id="Lean.Elab.async"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L34-L45">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Elab.async"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">async</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.Elab.inServer"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L47-L52">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Elab.inServer"><span class="name">Lean</span>.<span class="name">Elab</span>.<span class="name">inServer</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.internal.cmdlineSnapshots"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L54-L59">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.internal.cmdlineSnapshots"><span class="name">Lean</span>.<span class="name">internal</span>.<span class="name">cmdlineSnapshots</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Performance option used by cmdline driver.</p></div></div><div class="decl" id="Lean.useDiagnosticMsg"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L61-L71">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.useDiagnosticMsg"><span class="name">Lean</span>.<span class="name">useDiagnosticMsg</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Message.html#Lean.MessageData">MessageData</a></div></div><p>If the <code><a href=".././Lean/CoreM.html#Lean.diagnostics">diagnostics</a></code> option is not already set, gives a message explaining this option.
Begins with a <code>\n\n</code>, so an error message can look like <code>m!&quot;some error occurred{useDiagnosticMsg}&quot;</code>.
The double newline gives better visual separation from the main error message</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.useDiagnosticMsg" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.getMaxHeartbeats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L77-L78">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.getMaxHeartbeats"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getMaxHeartbeats</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Nat">Nat</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.getMaxHeartbeats">Lean.Core.getMaxHeartbeats</a> <span class="fn">opts</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option.get">Lean.Option.get</a> <span class="fn">opts</span> <a href=".././Lean/CoreM.html#Lean.maxHeartbeats">Lean.maxHeartbeats</a></span> <a href=".././Init/Prelude.html#HMul.hMul">*</a> <span class="fn">1000</span></li></ul></details><details id="instances-for-list-Lean.Core.getMaxHeartbeats" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.InstantiateLevelCache"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L80-L80">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">InstantiateLevelCache</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">Lean.Core.InstantiateLevelCache</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">Lean.PersistentHashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> (<span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Lean.Level</a></span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Expr.html#Lean.Expr">Lean.Expr</a>)</span></li></ul></details><details id="instances-for-list-Lean.Core.InstantiateLevelCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.Cache"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L82-L86">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.Cache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">Cache</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Cache for the <code><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></code> monad</p><ul class="structure_fields" id="Lean.Core.Cache.mk"><li id="Lean.Core.Cache.instLevelType" class="structure_field"><div class="structure_field_info">instLevelType : <a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">InstantiateLevelCache</a></div></li><li id="Lean.Core.Cache.instLevelValue" class="structure_field"><div class="structure_field_info">instLevelValue : <a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">InstantiateLevelCache</a></div></li></ul><details id="instances-for-list-Lean.Core.Cache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instInhabitedCache"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L86-L86">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instInhabitedCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instInhabitedCache</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/CoreM.html#Lean.Core.Cache">Cache</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.instInhabitedCache">Lean.Core.instInhabitedCache</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/CoreM.html#Lean.Core.Cache.mk">{</a> <span class="fn">instLevelType</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">instLevelValue</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/CoreM.html#Lean.Core.Cache.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Core.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L88-L111">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.State"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">State</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>State for the CoreM monad.</p><ul class="structure_fields" id="Lean.Core.State.mk"><li id="Lean.Core.State.env" class="structure_field"><div class="structure_field_info">env : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div><div class="structure_field_doc"><p>Current environment.</p></div></li><li id="Lean.Core.State.nextMacroScope" class="structure_field"><div class="structure_field_info">nextMacroScope : <a href=".././Init/Prelude.html#Lean.MacroScope">MacroScope</a></div><div class="structure_field_doc"><p>Next macro scope. We use macro scopes to avoid accidental name capture.</p></div></li><li id="Lean.Core.State.ngen" class="structure_field"><div class="structure_field_info">ngen : <a href=".././Init/MetaTypes.html#Lean.NameGenerator">NameGenerator</a></div><div class="structure_field_doc"><p>Name generator for producing unique <code>FVarId</code>s, <code>MVarId</code>s, and <code>LMVarId</code>s</p></div></li><li id="Lean.Core.State.traceState" class="structure_field"><div class="structure_field_info">traceState : <a href=".././Lean/Util/Trace.html#Lean.TraceState">TraceState</a></div><div class="structure_field_doc"><p>Trace messages</p></div></li><li id="Lean.Core.State.cache" class="structure_field"><div class="structure_field_info">cache : <a href=".././Lean/CoreM.html#Lean.Core.Cache">Cache</a></div><div class="structure_field_doc"><p>Cache for instantiating universe polymorphic declarations.</p></div></li><li id="Lean.Core.State.messages" class="structure_field"><div class="structure_field_info">messages : <a href=".././Lean/Message.html#Lean.MessageLog">MessageLog</a></div><div class="structure_field_doc"><p>Message log.</p></div></li><li id="Lean.Core.State.infoState" class="structure_field"><div class="structure_field_info">infoState : <a href=".././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoState">Elab.InfoState</a></div><div class="structure_field_doc"><p>Info tree. We have the info tree here because we want to update it while adding attributes.</p></div></li><li id="Lean.Core.State.snapshotTasks" class="structure_field"><div class="structure_field_info">snapshotTasks : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Language.SnapshotTask</a> <a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Language.SnapshotTree</a>)</span></span></div><div class="structure_field_doc"><p>Snapshot trees of asynchronous subtasks. As these are untyped and reported only at the end of the
command's main elaboration thread, they are only useful for basic message log reporting; for
incremental reporting and reuse within a long-running elaboration thread, types rooted in
<code>CommandParsedSnapshot</code> need to be adjusted.</p></div></li></ul><details id="instances-for-list-Lean.Core.State" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instNonemptyState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L111-L111">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instNonemptyState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instNonemptyState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/CoreM.html#Lean.Core.State">State</a></span></div></div></div></div><div class="decl" id="Lean.Core.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L113-L142">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.Context"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">Context</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Context for the CoreM monad.</p><ul class="structure_fields" id="Lean.Core.Context.mk"><li id="Lean.Core.Context.fileName" class="structure_field"><div class="structure_field_info">fileName : <a href=".././Init/Prelude.html#String">String</a></div><div class="structure_field_doc"><p>Name of the file being compiled.</p></div></li><li id="Lean.Core.Context.fileMap" class="structure_field"><div class="structure_field_info">fileMap : <a href=".././Lean/Data/Position.html#Lean.FileMap">FileMap</a></div><div class="structure_field_doc"><p>Auxiliary datastructure for converting <code><a href=".././Init/Prelude.html#String.Pos">String.Pos</a></code> into Line/Column number.</p></div></li><li id="Lean.Core.Context.options" class="structure_field"><div class="structure_field_info">options : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a></div></li><li id="Lean.Core.Context.currRecDepth" class="structure_field"><div class="structure_field_info">currRecDepth : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Core.Context.maxRecDepth" class="structure_field"><div class="structure_field_info">maxRecDepth : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Core.Context.ref" class="structure_field"><div class="structure_field_info">ref : <a href=".././Init/Prelude.html#Lean.Syntax">Syntax</a></div></li><li id="Lean.Core.Context.currNamespace" class="structure_field"><div class="structure_field_info">currNamespace : <a href=".././Init/Prelude.html#Lean.Name">Name</a></div></li><li id="Lean.Core.Context.openDecls" class="structure_field"><div class="structure_field_info">openDecls : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Data/OpenDecl.html#Lean.OpenDecl">OpenDecl</a></span></div></li><li id="Lean.Core.Context.initHeartbeats" class="structure_field"><div class="structure_field_info">initHeartbeats : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Core.Context.maxHeartbeats" class="structure_field"><div class="structure_field_info">maxHeartbeats : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Core.Context.currMacroScope" class="structure_field"><div class="structure_field_info">currMacroScope : <a href=".././Init/Prelude.html#Lean.MacroScope">MacroScope</a></div></li><li id="Lean.Core.Context.diag" class="structure_field"><div class="structure_field_info">diag : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>If <code><a href=".././Lean/CoreM.html#Lean.Core.Context.diag">diag</a> := true</code>, different parts of the system collect diagnostics.
Use the <code>set_option <a href=".././Lean/CoreM.html#Lean.Core.Context.diag">diag</a> true</code> to set it to true.</p></div></li><li id="Lean.Core.Context.cancelTk?" class="structure_field"><div class="structure_field_info">cancelTk? : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span></div><div class="structure_field_doc"><p>If set, used to cancel elaboration from outside when results are not needed anymore.</p></div></li><li id="Lean.Core.Context.suppressElabErrors" class="structure_field"><div class="structure_field_info">suppressElabErrors : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>If set (when <code>showPartialSyntaxErrors</code> is not set and parsing failed), suppresses most elaboration
errors; see also <code>logMessage</code> below.</p></div></li><li id="Lean.Core.Context.inheritedTraceOptions" class="structure_field"><div class="structure_field_info">inheritedTraceOptions : <span class="fn"><a href=".././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div><div class="structure_field_doc"><p>Cache of <code><a href=".././Lean/Util/Trace.html#Lean.inheritedTraceOptions">Lean.inheritedTraceOptions</a></code>.</p></div></li></ul><details id="instances-for-list-Lean.Core.Context" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instNonemptyContext"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L142-L142">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instNonemptyContext"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instNonemptyContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/CoreM.html#Lean.Core.Context">Context</a></span></div></div></div></div><div class="decl" id="Lean.Core.CoreM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L144-L152">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.CoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>CoreM is a monad for manipulating the Lean environment.
It is the base monad for <code>MetaM</code>.
The main features it provides are:</p><ul>
<li>name generator state</li>
<li>environment state</li>
<li>Lean options context</li>
<li>the current open namespace</li>
</ul><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/CoreM.html#Lean.Core.Context">Lean.Core.Context</a> <span class="fn">(<a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href=".././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href=".././Lean/CoreM.html#Lean.Core.State">Lean.Core.State</a> <span class="fn">(<a href=".././Init/System/IO.html#EIO">EIO</a> <a href=".././Lean/Exception.html#Lean.Exception">Lean.Exception</a>)</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Core.CoreM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instMonadCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L156-L157">source</a></div><div class="attributes">@[always_inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instInhabitedCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L159-L160">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instInhabitedCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instInhabitedCoreM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.instInhabitedCoreM">Lean.Core.instInhabitedCoreM</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <span class="fn">fun (<span class="fn">x</span> : <a href=".././Lean/CoreM.html#Lean.Core.Context">Lean.Core.Context</a>) (<span class="fn">x</span> : <span class="fn"><a href=".././Init/System/ST.html#ST.Ref">ST.Ref</a> <a href=".././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href=".././Lean/CoreM.html#Lean.Core.State">Lean.Core.State</a></span>) =&gt; <span class="fn"><a href=".././Init/Prelude.html#MonadExcept.throw">throw</a> <a href=".././Init/Prelude.html#Inhabited.default">default</a></span></span> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadRefCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L162-L164">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadRefCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadRefCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Lean.MonadRef">MonadRef</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadEnvCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L166-L168">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadEnvCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadEnvCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">MonadEnv</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadOptionsCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L170-L171">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadOptionsCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadOptionsCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.MonadOptions">MonadOptions</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.instMonadOptionsCoreM">Lean.Core.instMonadOptionsCoreM</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Lean/Data/Options.html#Lean.MonadOptions.mk">{</a>     <span class="fn">getOptions</span> := <span class="fn">do
      let <span class="fn">__do_lift</span> ← <a href=".././Init/Prelude.html#MonadReader.read">read</a>
      <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.<a href=".././Lean/CoreM.html#Lean.Core.Context.options">options</a></span></span></span> <a href=".././Lean/Data/Options.html#Lean.MonadOptions.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadWithOptionsCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L173-L185">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadWithOptionsCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadWithOptionsCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.MonadWithOptions">MonadWithOptions</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instAddMessageContextCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L193-L194">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instAddMessageContextCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instAddMessageContextCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Message.html#Lean.AddMessageContext">AddMessageContext</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.instAddMessageContextCoreM">Lean.Core.instAddMessageContextCoreM</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Message.html#Lean.AddMessageContext.mk">{</a> <span class="fn">addMessageContext</span> := <a href=".././Lean/Message.html#Lean.addMessageContextPartial">Lean.addMessageContextPartial</a> <a href=".././Lean/Message.html#Lean.AddMessageContext.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadNameGeneratorCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L196-L198">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadNameGeneratorCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadNameGeneratorCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Meta.html#Lean.MonadNameGenerator">MonadNameGenerator</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadRecDepthCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L200-L203">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadRecDepthCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadRecDepthCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Exception.html#Lean.MonadRecDepth">MonadRecDepth</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadResolveNameCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L205-L207">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadResolveNameCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadResolveNameCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/ResolveName.html#Lean.MonadResolveName">MonadResolveName</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.withFreshMacroScope"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L209-L211">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.withFreshMacroScope"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withFreshMacroScope</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.withFreshMacroScope" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instMonadQuotationCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L213-L216">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadQuotationCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadQuotationCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Lean.MonadQuotation">MonadQuotation</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadInfoTreeCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L218-L220">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadInfoTreeCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadInfoTreeCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Elab/InfoTree/Types.html#Lean.Elab.MonadInfoTree">Elab.MonadInfoTree</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.modifyCache"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L222-L224">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.modifyCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">modifyCache</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.Cache">Cache</a> → <a href=".././Lean/CoreM.html#Lean.Core.Cache">Cache</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.modifyCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.modifyInstLevelTypeCache"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L226-L227">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.modifyInstLevelTypeCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">modifyInstLevelTypeCache</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">InstantiateLevelCache</a> → <a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">InstantiateLevelCache</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.modifyInstLevelTypeCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.modifyInstLevelValueCache"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L229-L230">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.modifyInstLevelValueCache"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">modifyInstLevelValueCache</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">InstantiateLevelCache</a> → <a href=".././Lean/CoreM.html#Lean.Core.InstantiateLevelCache">InstantiateLevelCache</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.modifyInstLevelValueCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instantiateTypeLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L232-L238">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instantiateTypeLevelParams</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Declaration.html#Lean.ConstantVal">ConstantVal</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">us</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.instantiateTypeLevelParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instantiateValueLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L240-L248">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instantiateValueLevelParams"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instantiateValueLevelParams</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">us</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.instantiateValueLevelParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.liftIOCore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L250-L252">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.liftIOCore"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">liftIOCore</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.liftIOCore">Lean.Core.liftIOCore</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">ref</span> ← <a href=".././Init/Prelude.html#Lean.MonadRef.getRef">Lean.getRef</a>
  <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a>
      <span class="fn">(<a href=".././Init/System/IO.html#IO.toEIO">IO.toEIO</a>
        <span class="fn">(fun (<span class="fn">err</span> : <a href=".././Init/System/IOError.html#IO.Error">IO.Error</a>) =&gt; <span class="fn"><a href=".././Lean/Exception.html#Lean.Exception.error">Lean.Exception.error</a> <span class="fn">ref</span> <span class="fn">((<a href=".././Lean/Message.html#Lean.MessageData.ofFormat">Lean.MessageData.ofFormat</a> <a href=".././Init/Prelude.html#Function.comp">∘</a> <a href=".././Init/Data/Format/Basic.html#Std.ToFormat.format">Std.format</a>) <span class="fn">(<a href=".././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">err</span>)</span>)</span></span>)</span> <span class="fn">x</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.liftIOCore" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instMonadLiftIOCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L254-L255">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadLiftIOCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadLiftIOCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#MonadLift">MonadLift</a> <a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.instMonadLiftIOCoreM">Lean.Core.instMonadLiftIOCoreM</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#MonadLift.mk">{</a> <span class="fn">monadLift</span> := <span class="fn">fun {<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>} =&gt; <a href=".././Lean/CoreM.html#Lean.Core.liftIOCore">Lean.Core.liftIOCore</a></span> <a href=".././Init/Prelude.html#MonadLift.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Core.instMonadTraceCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L257-L260">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadTraceCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadTraceCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Util/Trace.html#Lean.MonadTrace">MonadTrace</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.SavedState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L262-L265">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.SavedState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">SavedState</span></a></span><span class="decl_extends">extends</span> <a href=".././Lean/CoreM.html#Lean.Core.State">Lean.Core.State</a><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Core.SavedState.mk"><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.env">env</a> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.nextMacroScope">nextMacroScope</a> : <a href=".././Init/Prelude.html#Lean.MacroScope">MacroScope</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.ngen">ngen</a> : <a href=".././Init/MetaTypes.html#Lean.NameGenerator">NameGenerator</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.traceState">traceState</a> : <a href=".././Lean/Util/Trace.html#Lean.TraceState">TraceState</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.cache">cache</a> : <a href=".././Lean/CoreM.html#Lean.Core.Cache">Cache</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.messages">messages</a> : <a href=".././Lean/Message.html#Lean.MessageLog">MessageLog</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.infoState">infoState</a> : <a href=".././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoState">Elab.InfoState</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href=".././Lean/CoreM.html#Lean.Core.State.snapshotTasks">snapshotTasks</a> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Language.SnapshotTask</a> <a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Language.SnapshotTree</a>)</span></span></div></li><li id="Lean.Core.SavedState.passedHeartbeats" class="structure_field"><div class="structure_field_info">passedHeartbeats : <a href=".././Init/Prelude.html#Nat">Nat</a></div><div class="structure_field_doc"><p>Number of heartbeats passed inside <code><a href=".././Lean/CoreM.html#Lean.Core.withRestoreOrSaveFull">withRestoreOrSaveFull</a></code>, not used otherwise.</p></div></li></ul><details id="instances-for-list-Lean.Core.SavedState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instNonemptySavedState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L265-L265">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instNonemptySavedState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instNonemptySavedState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/CoreM.html#Lean.Core.SavedState">SavedState</a></span></div></div></div></div><div class="decl" id="Lean.Core.saveState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L267-L269">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.saveState"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">saveState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/CoreM.html#Lean.Core.SavedState">SavedState</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.saveState">Lean.Core.saveState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">s</span> ← <a href=".././Init/Prelude.html#MonadState.get">get</a>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Lean/CoreM.html#Lean.Core.SavedState.mk">{</a> <span class="fn">toState</span> := <span class="fn">s</span>, <span class="fn">passedHeartbeats</span> := <span class="fn">0</span> <a href=".././Lean/CoreM.html#Lean.Core.SavedState.mk">}</a></span></span></li></ul></details><details id="instances-for-list-Lean.Core.saveState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.withRestoreOrSaveFull"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L271-L296">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.withRestoreOrSaveFull"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withRestoreOrSaveFull</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">reusableResult?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> (<span class="fn">α</span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/CoreM.html#Lean.Core.SavedState">SavedState</a>)</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> (<span class="fn">α</span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/CoreM.html#Lean.Core.SavedState">SavedState</a>)</span></div></div><p>Incremental reuse primitive: if <code>reusableResult?</code> is <code>none</code>, runs <code>act</code> and returns its result
together with the saved monadic state after <code>act</code> including the heartbeats used by it. If
<code>reusableResult?</code> on the other hand is <code>some (a, state)</code>, restores full <code>state</code> including heartbeats
used and returns <code>(a, state)</code>.</p><p>The intention is for steps that support incremental reuse to initially pass <code>none</code> as
<code>reusableResult?</code> and store the result and state in a snapshot. In a further run, if reuse is
possible, <code>reusableResult?</code> should be set to the previous result and state, ensuring that the state
after running <code><a href=".././Lean/CoreM.html#Lean.Core.withRestoreOrSaveFull">withRestoreOrSaveFull</a></code> is identical in both runs. Note however that necessarily this
is only an approximation in the case of heartbeats as heartbeats used by <code><a href=".././Lean/CoreM.html#Lean.Core.withRestoreOrSaveFull">withRestoreOrSaveFull</a></code>
itself after calling <code>act</code> as well as by reuse-handling code such as the one supplying
<code>reusableResult?</code> are not accounted for.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.withRestoreOrSaveFull">Lean.Core.withRestoreOrSaveFull</a> <span class="fn">(<a href=".././Init/Prelude.html#Option.some">some</a> <a href=".././Init/Prelude.html#Prod.mk">(</a><span class="fn">val</span><a href=".././Init/Prelude.html#Prod.mk">,</a> <span class="fn">state</span><a href=".././Init/Prelude.html#Prod.mk">)</a>)</span> <span class="fn">act</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  <span class="fn"><a href=".././Init/Prelude.html#MonadStateOf.set">set</a> <span class="fn"><span class="fn">state</span>.<a href=".././Lean/CoreM.html#Lean.Core.SavedState.toState">toState</a></span></span>
  <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href=".././Init/System/IO.html#IO.addHeartbeats">IO.addHeartbeats</a> <span class="fn"><span class="fn">state</span>.<a href=".././Lean/CoreM.html#Lean.Core.SavedState.passedHeartbeats">passedHeartbeats</a></span>)</span></span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <a href=".././Init/Prelude.html#Prod.mk">(</a><span class="fn">val</span><a href=".././Init/Prelude.html#Prod.mk">,</a> <span class="fn">state</span><a href=".././Init/Prelude.html#Prod.mk">)</a></span></span></li></ul></details><details id="instances-for-list-Lean.Core.withRestoreOrSaveFull" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.SavedState.restore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L298-L300">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.SavedState.restore"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">SavedState</span>.<span class="name">restore</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">b</span> : <a href=".././Lean/CoreM.html#Lean.Core.SavedState">SavedState</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Restore backtrackable parts of the state.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.SavedState.restore" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.mkFreshUserName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L306-L318">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.mkFreshUserName"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">mkFreshUserName</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div></div><p>Creates a name from <code>n</code> that is guaranteed to be unique.
This is intended to be used for creating inaccessible user names for free variables and constants.</p><p>It works by adding a fresh macro scope to <code>n</code>.
Applying <code><a href=".././Init/Prelude.html#Lean.Name.eraseMacroScopes">Lean.Name.eraseMacroScopes</a></code> to the resulting name yields <code>n</code>.</p><p>See also <code><a href=".././Lean/LocalContext.html#Lean.LocalContext.getUnusedName">Lean.LocalContext.getUnusedName</a></code> (for creating a new accessible user name that is
unused in the local context) and <code><a href=".././Lean/Meta/Tactic/Intro.html#Lean.Meta.mkFreshBinderNameForTactic">Lean.Meta.mkFreshBinderNameForTactic</a></code> (for creating names
that are conditionally inaccessible, depending on the current value of the <code>tactic.hygiene</code> option).</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.mkFreshUserName">Lean.mkFreshUserName</a> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/CoreM.html#_private.Lean.CoreM.0.Lean.Core.mkFreshNameImp">Lean.Core.mkFreshNameImp✝</a> <span class="fn">n</span></span></li></ul></details><details id="instances-for-list-Lean.Core.mkFreshUserName" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.CoreM.run"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L320-L321">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.CoreM.run"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span>.<span class="name">run</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href=".././Lean/CoreM.html#Lean.Core.Context">Context</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href=".././Lean/CoreM.html#Lean.Core.State">State</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#EIO">EIO</a> <a href=".././Lean/Exception.html#Lean.Exception">Exception</a> (<span class="fn">α</span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/CoreM.html#Lean.Core.State">State</a>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/CoreM.html#Lean.Core.CoreM.run">run</a></span> <span class="fn">ctx</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">(<a href=".././Lean/CoreM.html#_private.Lean.CoreM.0.Lean.Core.withConsistentCtx">Lean.Core.withConsistentCtx✝</a> <span class="fn">x</span> <span class="fn">ctx</span>)</span>.<a href=".././Init/Control/StateRef.html#StateRefT'.run">run</a></span> <span class="fn">s</span></span></li></ul></details><details id="instances-for-list-Lean.Core.CoreM.run" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.CoreM.run'"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L323-L324">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.CoreM.run'"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span>.<span class="name">run'</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href=".././Lean/CoreM.html#Lean.Core.Context">Context</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href=".././Lean/CoreM.html#Lean.Core.State">State</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#EIO">EIO</a> <a href=".././Lean/Exception.html#Lean.Exception">Exception</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/CoreM.html#Lean.Core.CoreM.run'">run'</a></span> <span class="fn">ctx</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Prod.fst">Prod.fst</a> <a href=".././Init/Prelude.html#Functor.map">&lt;$&gt;</a> <span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/CoreM.html#Lean.Core.CoreM.run">run</a></span> <span class="fn">ctx</span> <span class="fn">s</span></span></li></ul></details><details id="instances-for-list-Lean.Core.CoreM.run'" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.CoreM.toIO"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L326-L330">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.CoreM.toIO"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">CoreM</span>.<span class="name">toIO</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href=".././Lean/CoreM.html#Lean.Core.Context">Context</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href=".././Lean/CoreM.html#Lean.Core.State">State</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn">α</span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/CoreM.html#Lean.Core.State">State</a>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.CoreM.toIO" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.withIncRecDepth"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L333-L334">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.withIncRecDepth"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withIncRecDepth</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Control/Basic.html#MonadControlT">MonadControlT</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.withIncRecDepth">Lean.Core.withIncRecDepth</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Control/Basic.html#controlAt">controlAt</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">fun (<span class="fn">runInBase</span> : <span class="fn">{<span class="fn">β</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><span class="fn">m</span> <span class="fn">β</span></span> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">(<a href=".././Init/Control/Basic.html#MonadControlT.stM">stM</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">m</span> <span class="fn">β</span>)</span></span></span></span>) =&gt;
    <span class="fn"><a href=".././Lean/Exception.html#Lean.withIncRecDepth">Lean.withIncRecDepth</a> <span class="fn">(<span class="fn">runInBase</span> <span class="fn">x</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.withIncRecDepth" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.checkInterrupted"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L336-L345">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.checkInterrupted"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkInterrupted</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Throws an internal interrupt exception if cancellation has been requested. The exception is not
caught by <code>try catch</code> but is intended to be caught by <code>Command.withLoggingExceptions</code> at the top
level of elaboration. In particular, we want to skip producing further incremental snapshots after
the exception has been thrown.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.checkInterrupted" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.debug.moduleNameAtTimeout"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L347-L351">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.debug.moduleNameAtTimeout"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">debug</span>.<span class="name">moduleNameAtTimeout</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.Core.throwMaxHeartbeat"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L353-L359">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.throwMaxHeartbeat"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">throwMaxHeartbeat</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">moduleName </span><span class="fn">optionName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">max</span> : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.throwMaxHeartbeat" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.checkMaxHeartbeatsCore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L361-L365">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.checkMaxHeartbeatsCore"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkMaxHeartbeatsCore</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">moduleName</span> : <a href=".././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">optionName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">max</span> : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.checkMaxHeartbeatsCore" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.checkMaxHeartbeats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L367-L368">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.checkMaxHeartbeats"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkMaxHeartbeats</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">moduleName</span> : <a href=".././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.checkMaxHeartbeats">Lean.Core.checkMaxHeartbeats</a> <span class="fn">moduleName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <a href=".././Init/Prelude.html#MonadReader.read">read</a>
  <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.checkMaxHeartbeatsCore">Lean.Core.checkMaxHeartbeatsCore</a> <span class="fn">moduleName</span> <span class="fn">`maxHeartbeats</span> <span class="fn"><span class="fn">__do_lift</span>.<a href=".././Lean/CoreM.html#Lean.Core.Context.maxHeartbeats">maxHeartbeats</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.checkMaxHeartbeats" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.checkSystem"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L370-L373">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.checkSystem"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">checkSystem</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">moduleName</span> : <a href=".././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.checkSystem">Lean.checkSystem</a> <span class="fn">moduleName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  <a href=".././Lean/CoreM.html#Lean.Core.checkInterrupted">Lean.Core.checkInterrupted</a>
  <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.checkMaxHeartbeats">Lean.Core.checkMaxHeartbeats</a> <span class="fn">moduleName</span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.checkSystem" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.withCurrHeartbeats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L379-L380">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.withCurrHeartbeats"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">withCurrHeartbeats</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Control/Basic.html#MonadControlT">MonadControlT</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.withCurrHeartbeats">Lean.withCurrHeartbeats</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Control/Basic.html#controlAt">controlAt</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">fun (<span class="fn">runInBase</span> : <span class="fn">{<span class="fn">β</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><span class="fn">m</span> <span class="fn">β</span></span> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">(<a href=".././Init/Control/Basic.html#MonadControlT.stM">stM</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">m</span> <span class="fn">β</span>)</span></span></span></span>) =&gt;
    <span class="fn"><a href=".././Lean/CoreM.html#_private.Lean.CoreM.0.Lean.Core.withCurrHeartbeatsImp">Lean.Core.withCurrHeartbeatsImp✝</a> <span class="fn">(<span class="fn">runInBase</span> <span class="fn">x</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.withCurrHeartbeats" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.setMessageLog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L382-L383">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.setMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">setMessageLog</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">messages</span> : <a href=".././Lean/Message.html#Lean.MessageLog">MessageLog</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.setMessageLog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.resetMessageLog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L385-L386">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.resetMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">resetMessageLog</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.resetMessageLog">Lean.Core.resetMessageLog</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.setMessageLog">Lean.Core.setMessageLog</a> <a href=".././Lean/Message.html#Lean.MessageLog.mk">{</a> <a href=".././Lean/Message.html#Lean.MessageLog.mk">}</a></span></li></ul></details><details id="instances-for-list-Lean.Core.resetMessageLog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.getMessageLog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L388-L389">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.getMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getMessageLog</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/Message.html#Lean.MessageLog">MessageLog</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.Core.getMessageLog">Lean.Core.getMessageLog</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <a href=".././Init/Prelude.html#MonadState.get">get</a>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.<a href=".././Lean/CoreM.html#Lean.Core.State.messages">messages</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.getMessageLog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.getAndEmptyMessageLog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L391-L396">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.getAndEmptyMessageLog"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getAndEmptyMessageLog</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/Message.html#Lean.MessageLog">MessageLog</a></span></div></div><p>Returns the current log and then resets its messages while adjusting <code>MessageLog.hadErrors</code>. Used
for incremental reporting during elaboration of a single command.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.getAndEmptyMessageLog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.getAndEmptySnapshotTasks"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L398-L406">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.getAndEmptySnapshotTasks"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">getAndEmptySnapshotTasks</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Language.SnapshotTask</a> <a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Language.SnapshotTree</a>)</span>)</span></span></div></div><p>Returns the current set of tasks added by <code><a href=".././Lean/CoreM.html#Lean.Core.logSnapshotTask">logSnapshotTask</a></code> and then resets it. When
saving/restoring state of an action that may have logged such tasks during incremental reuse, this
function must be used to store them in the corresponding snapshot tree; otherwise, they will leak
outside and may be cancelled by a later step, potentially leading to inconsistent state being
reused.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.getAndEmptySnapshotTasks" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.instMonadLogCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L408-L422">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.instMonadLogCoreM"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">instMonadLogCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Log.html#Lean.MonadLog">MonadLog</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Core.logSnapshotTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L424-L433">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.logSnapshotTask"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">logSnapshotTask</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">task</span> : <span class="fn"><a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTask">Language.SnapshotTask</a> <a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Language.SnapshotTree</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Includes a given task (such as from <code><a href=".././Lean/CoreM.html#Lean.Core.wrapAsyncAsSnapshot">wrapAsyncAsSnapshot</a></code>) in the overall snapshot tree for this
command's elaboration, making its result available to reporting and the language server. The
reporter will not know about this snapshot tree node until the main elaboration thread for this
command has finished so this function is not useful for incremental reporting within a longer
elaboration thread but only for tasks that outlive it such as background kernel checking or proof
elaboration.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.logSnapshotTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.wrapAsync"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L435-L447">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.wrapAsync"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">wrapAsync</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">β </span><span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">β</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">(<span class="fn">α</span> → <span class="fn"><a href=".././Init/System/IO.html#EIO">EIO</a> <a href=".././Lean/Exception.html#Lean.Exception">Exception</a> <span class="fn">β</span></span>)</span></span></div></div><p>Wraps the given action for use in <code><a href=".././Init/System/IO.html#EIO.asTask">EIO.asTask</a></code> etc., discarding its final monadic state.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.wrapAsync" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.stderrAsMessages"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L449-L454">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.stderrAsMessages"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">stderrAsMessages</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Option for capturing output to stderr during elaboration.</p></div></div><div class="decl" id="Lean.Core.mkSnapshot"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L456-L474">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.mkSnapshot"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">mkSnapshot</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">output</span> : <a href=".././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href=".././Lean/CoreM.html#Lean.Core.Context">Context</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">st</span> : <a href=".././Lean/CoreM.html#Lean.Core.State">State</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">desc</span> : <a href=".././Init/Prelude.html#String">String</a> := by exact decl_name%.toString)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Language.SnapshotTree</a></span></div></div><p>Creates snapshot reporting given <code>withIsolatedStreams</code> output and diagnostics and traces from the
given state.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.mkSnapshot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.wrapAsyncAsSnapshot"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L477-L509">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.wrapAsyncAsSnapshot"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">wrapAsyncAsSnapshot</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">desc</span> : <a href=".././Init/Prelude.html#String">String</a> := by exact decl_name%.toString)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">(<span class="fn">α</span> → <span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Language.SnapshotTree</a></span>)</span></span></div></div><p>Wraps the given action for use in <code><a href=".././Init/System/IO.html#BaseIO.asTask">BaseIO.asTask</a></code> etc., discarding its final state except for
<code><a href=".././Lean/CoreM.html#Lean.Core.logSnapshotTask">logSnapshotTask</a></code> tasks, which are reported as part of the returned tree. The given cancellation
token, if any, should be stored in a <code>SnapshotTask</code> for the server to trigger it when the result is
no longer needed.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.wrapAsyncAsSnapshot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.withAtLeastMaxRecDepth"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L515-L516">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.withAtLeastMaxRecDepth"><span class="name">Lean</span>.<span class="name">withAtLeastMaxRecDepth</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#MonadFunctorT">MonadFunctorT</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">max</span> : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span> → <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.withAtLeastMaxRecDepth" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.catchInternalId"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L518-L523">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.catchInternalId"><span class="name">Lean</span>.<span class="name">catchInternalId</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> u_1 → <a href=".././foundational_types.html">Type</a> u_2</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#MonadExcept">MonadExcept</a> <a href=".././Lean/Exception.html#Lean.Exception">Exception</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href=".././Lean/InternalExceptionId.html#Lean.InternalExceptionId">InternalExceptionId</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">h</span> : <span class="fn"><a href=".././Lean/Exception.html#Lean.Exception">Exception</a> → <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.catchInternalId" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.catchInternalIds"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L525-L530">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.catchInternalIds"><span class="name">Lean</span>.<span class="name">catchInternalIds</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> u_1 → <a href=".././foundational_types.html">Type</a> u_2</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#MonadExcept">MonadExcept</a> <a href=".././Lean/Exception.html#Lean.Exception">Exception</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ids</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/InternalExceptionId.html#Lean.InternalExceptionId">InternalExceptionId</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">h</span> : <span class="fn"><a href=".././Lean/Exception.html#Lean.Exception">Exception</a> → <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.catchInternalIds" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Exception.isMaxHeartbeat"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L532-L537">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Exception.isMaxHeartbeat"><span class="name">Lean</span>.<span class="name">Exception</span>.<span class="name">isMaxHeartbeat</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ex</span> : <a href=".././Lean/Exception.html#Lean.Exception">Exception</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Return true if <code>ex</code> was generated by <code><a href=".././Lean/CoreM.html#Lean.Core.throwMaxHeartbeat">throwMaxHeartbeat</a></code>.
This function is a bit hackish. The heartbeat exception should probably be an internal exception.
We used a similar hack at <code>Exception.isMaxRecDepth</code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">(<a href=".././Lean/Exception.html#Lean.Exception.error">Lean.Exception.error</a> <span class="fn">ref</span> <span class="fn">(<a href=".././Lean/Message.html#Lean.MessageData.tagged">Lean.MessageData.tagged</a> <span class="fn">`runtime.maxHeartbeats</span> <span class="fn">a</span>)</span>)</span>.<a href=".././Lean/CoreM.html#Lean.Exception.isMaxHeartbeat">isMaxHeartbeat</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a></li><li class="equation"><span class="fn"><span class="fn">ex</span>.<a href=".././Lean/CoreM.html#Lean.Exception.isMaxHeartbeat">isMaxHeartbeat</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.false">false</a></li></ul></details><details id="instances-for-list-Lean.Exception.isMaxHeartbeat" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkArrow"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L539-L541">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.mkArrow"><span class="name">Lean</span>.<span class="name">mkArrow</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">d </span><span class="fn">b</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><p>Creates the expression <code>d → b</code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.mkArrow">Lean.mkArrow</a> <span class="fn">d</span> <span class="fn">b</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.mkFreshUserName">Lean.mkFreshUserName</a> <span class="fn">`x</span></span>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">(<a href=".././Lean/Expr.html#Lean.mkForall">Lean.mkForall</a> <span class="fn">__do_lift</span> <a href=".././Lean/Expr.html#Lean.BinderInfo.default">Lean.BinderInfo.default</a> <span class="fn">d</span> <span class="fn">b</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.mkArrow" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkArrowN"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L543-L544">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.mkArrowN"><span class="name">Lean</span>.<span class="name">mkArrowN</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ds</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><p>Iterated <code><a href=".././Lean/CoreM.html#Lean.mkArrow">mkArrow</a></code>, creates the expression <code>a₁ → a₂ → … → aₙ → b</code>. Also see <code>arrowDomainsN</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.mkArrowN">Lean.mkArrowN</a> <span class="fn">ds</span> <span class="fn">e</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.foldrM">Array.foldrM</a> <a href=".././Lean/CoreM.html#Lean.mkArrow">Lean.mkArrow</a> <span class="fn">e</span> <span class="fn">ds</span></span></li></ul></details><details id="instances-for-list-Lean.mkArrowN" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.compiler.enableNew"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L563-L567">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.compiler.enableNew"><span class="name">Lean</span>.<span class="name">compiler</span>.<span class="name">enableNew</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.traceBlock"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L569-L577">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.traceBlock"><span class="name">Lean</span>.<span class="name">traceBlock</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">tag</span> : <a href=".././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <span class="fn"><a href=".././Init/Core.html#Task">Task</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></div></div><p>If <code>t</code> has not finished yet, waits for it under an <code>Elab.block</code> trace node. Returns <code>t</code>'s result.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.traceBlock" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.compileDeclsNew"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L580-L581">source</a></div><div class="attributes">@[extern  lean_lcnf_compile_decls]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.compileDeclsNew"><span class="name">Lean</span>.<span class="name">compileDeclsNew</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">declNames</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.compileDeclsOld"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L583-L584">source</a></div><div class="attributes">@[extern  lean_compile_decls]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.compileDeclsOld"><span class="name">Lean</span>.<span class="name">compileDeclsOld</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opt</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">decls</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Kernel.Exception</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div></div></div><div class="decl" id="Lean.compileDecls"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L587-L628">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.compileDecls"><span class="name">Lean</span>.<span class="name">compileDecls</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">decls</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ref?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a></span> := <a href=".././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">logErrors</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.compileDecls" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.compileDecls.doCompile"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L608-L628">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.compileDecls.doCompile"><span class="name">Lean</span>.<span class="name">compileDecls</span>.<span class="name">doCompile</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">decls</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ref?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a></span> := <a href=".././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">logErrors</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#PUnit">PUnit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.compileDecls.doCompile" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.compileDecl"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L630-L631">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.compileDecl"><span class="name">Lean</span>.<span class="name">compileDecl</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">decl</span> : <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">logErrors</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.compileDecl">Lean.compileDecl</a> <span class="fn">decl</span> <span class="fn">logErrors</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/CoreM.html#Lean.compileDecls">Lean.compileDecls</a> <span class="fn">(<a href=".././Lean/Compiler/Old.html#Lean.Compiler.getDeclNamesForCodeGen">Lean.Compiler.getDeclNamesForCodeGen</a> <span class="fn">decl</span>)</span> <span class="fn">(<a href=".././Init/Prelude.html#Option.some">some</a> <span class="fn">decl</span>)</span> <span class="fn">logErrors</span></span></li></ul></details><details id="instances-for-list-Lean.compileDecl" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.getDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L633-L634">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.getDiag"><span class="name">Lean</span>.<span class="name">getDiag</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.getDiag">Lean.getDiag</a> <span class="fn">opts</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option.get">Lean.Option.get</a> <span class="fn">opts</span> <a href=".././Lean/CoreM.html#Lean.diagnostics">Lean.diagnostics</a></span></li></ul></details><details id="instances-for-list-Lean.getDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.isDiagnosticsEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L636-L638">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">isDiagnosticsEnabled</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Return <code>true</code> if diagnostic information collection is enabled.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.isDiagnosticsEnabled">Lean.isDiagnosticsEnabled</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <a href=".././Init/Prelude.html#MonadReader.read">read</a>
  <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">__do_lift</span>.<a href=".././Lean/CoreM.html#Lean.Core.Context.diag">diag</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.isDiagnosticsEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportM.runCoreM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L640-L643">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.ImportM.runCoreM"><span class="name">Lean</span>.<span class="name">ImportM</span>.<span class="name">runCoreM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">ImportM</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.ImportM.runCoreM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Exception.isRuntime"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L645-L647">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Exception.isRuntime"><span class="name">Lean</span>.<span class="name">Exception</span>.<span class="name">isRuntime</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ex</span> : <a href=".././Lean/Exception.html#Lean.Exception">Exception</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Return <code>true</code> if the exception was generated by one of our resource limits.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">ex</span>.<a href=".././Lean/CoreM.html#Lean.Exception.isRuntime">isRuntime</a></span> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><span class="fn">ex</span>.<a href=".././Lean/CoreM.html#Lean.Exception.isMaxHeartbeat">isMaxHeartbeat</a></span> <a href=".././Init/Prelude.html#Bool.or">||</a> <span class="fn"><span class="fn">ex</span>.<a href=".././Lean/Exception.html#Lean.Exception.isMaxRecDepth">isMaxRecDepth</a></span>)</li></ul></details><details id="instances-for-list-Lean.Exception.isRuntime" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.tryCatch"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L649-L662">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.tryCatch"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">tryCatch</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">h</span> : <span class="fn"><a href=".././Lean/Exception.html#Lean.Exception">Exception</a> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></div></div><p>Custom <code>try-catch</code> for all monads based on <code><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></code>. We usually don't want to catch &quot;runtime
exceptions&quot; these monads, but on <code>CommandElabM</code> or, in specific cases, using <code><a href=".././Lean/CoreM.html#Lean.Core.tryCatchRuntimeEx">tryCatchRuntimeEx</a></code>.
See issues #2775 and #2744 as well as <code>MonadAlwaysExcept</code>. Also, we never want to catch interrupt
exceptions inside the elaborator.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.tryCatch">Lean.Core.tryCatch</a> <span class="fn">x</span> <span class="fn">h</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Prelude.html#MonadExcept.tryCatch">tryCatch</a> <span class="fn">x</span> <span class="fn">fun (<span class="fn">ex</span> : <a href=".././Lean/Exception.html#Lean.Exception">Lean.Exception</a>) =&gt; <a href=".././Init/Prelude.html#ite">if</a> (<span class="fn"><span class="fn">ex</span>.<a href=".././Lean/Exception.html#Lean.Exception.isInterrupt">isInterrupt</a></span> <a href=".././Init/Prelude.html#Bool.or">||</a> <span class="fn"><span class="fn">ex</span>.<a href=".././Lean/CoreM.html#Lean.Exception.isRuntime">isRuntime</a></span>) <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a> <a href=".././Init/Prelude.html#ite">then</a> <span class="fn"><a href=".././Init/Prelude.html#MonadExcept.throw">throw</a> <span class="fn">ex</span></span> <a href=".././Init/Prelude.html#ite">else</a> <span class="fn"><span class="fn">h</span> <span class="fn">ex</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Core.tryCatch" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Core.tryCatchRuntimeEx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L664-L675">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.Core.tryCatchRuntimeEx"><span class="name">Lean</span>.<span class="name">Core</span>.<span class="name">tryCatchRuntimeEx</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">h</span> : <span class="fn"><a href=".././Lean/Exception.html#Lean.Exception">Exception</a> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></div></div><p>A variant of <code><a href=".././Lean/CoreM.html#Lean.Core.tryCatch">tryCatch</a></code> that also catches runtime exception (see also <code><a href=".././Lean/CoreM.html#Lean.Core.tryCatch">tryCatch</a></code> documentation).
Like <code><a href=".././Lean/CoreM.html#Lean.Core.tryCatch">tryCatch</a></code>, this function does not catch interrupt exceptions, which are not considered runtime
exceptions.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Core.tryCatchRuntimeEx" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instMonadExceptOfExceptionCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L677-L679">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.instMonadExceptOfExceptionCoreM"><span class="name">Lean</span>.<span class="name">instMonadExceptOfExceptionCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#MonadExceptOf">MonadExceptOf</a> <a href=".././Lean/Exception.html#Lean.Exception">Exception</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.instMonadExceptOfExceptionCoreM">Lean.instMonadExceptOfExceptionCoreM</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Init/Prelude.html#MonadExceptOf.mk">{</a> <span class="fn">throw</span> := <span class="fn">fun {<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>} =&gt; <a href=".././Init/Prelude.html#MonadExcept.throw">throw</a></span>, <span class="fn">tryCatch</span> := <span class="fn">fun {<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>} =&gt; <a href=".././Lean/CoreM.html#Lean.Core.tryCatch">Lean.Core.tryCatch</a></span> <a href=".././Init/Prelude.html#MonadExceptOf.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.MonadRuntimeException"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L681-L682">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.MonadRuntimeException"><span class="name">Lean</span>.<span class="name">MonadRuntimeException</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a> 1</div></div><ul class="structure_fields" id="Lean.MonadRuntimeException.mk"><li id="Lean.MonadRuntimeException.tryCatchRuntimeEx" class="structure_field"><div class="structure_field_info">tryCatchRuntimeEx<span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">body</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">handler</span> : <span class="fn"><a href=".././Lean/Exception.html#Lean.Exception">Exception</a> → <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></span>)</span></span>
 : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></li></ul><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.MonadRuntimeException" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.instMonadRuntimeExceptionCoreM"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L686-L687">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.instMonadRuntimeExceptionCoreM"><span class="name">Lean</span>.<span class="name">instMonadRuntimeExceptionCoreM</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.MonadRuntimeException">MonadRuntimeException</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/CoreM.html#Lean.instMonadRuntimeExceptionCoreM">Lean.instMonadRuntimeExceptionCoreM</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/CoreM.html#Lean.MonadRuntimeException.mk">{</a> <span class="fn">tryCatchRuntimeEx</span> := <span class="fn">fun {<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>} =&gt; <a href=".././Lean/CoreM.html#Lean.Core.tryCatchRuntimeEx">Lean.Core.tryCatchRuntimeEx</a></span> <a href=".././Lean/CoreM.html#Lean.MonadRuntimeException.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instMonadRuntimeExceptionReaderT"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L689-L690">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.instMonadRuntimeExceptionReaderT"><span class="name">Lean</span>.<span class="name">instMonadRuntimeExceptionReaderT</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">ρ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/CoreM.html#Lean.MonadRuntimeException">MonadRuntimeException</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.MonadRuntimeException">MonadRuntimeException</a> <span class="fn">(<a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <span class="fn">ρ</span> <span class="fn">m</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.instMonadRuntimeExceptionStateRefT'"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L692-L693">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.instMonadRuntimeExceptionStateRefT'"><span class="name">Lean</span>.<span class="name">instMonadRuntimeExceptionStateRefT'</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">ω </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/CoreM.html#Lean.MonadRuntimeException">MonadRuntimeException</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.MonadRuntimeException">MonadRuntimeException</a> <span class="fn">(<a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <span class="fn">ω</span> <span class="fn">σ</span> <span class="fn">m</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.mapCoreM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L695-L696">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.mapCoreM"><span class="name">Lean</span>.<span class="name">mapCoreM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a> u_1</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Control/Basic.html#MonadControlT">MonadControlT</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <span class="fn">α</span></span></span></span>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.mapCoreM">Lean.mapCoreM</a> <span class="fn">f</span> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Control/Basic.html#controlAt">controlAt</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">fun (<span class="fn">runInBase</span> : <span class="fn">{<span class="fn">β</span> : <a href=".././foundational_types.html">Type</a>} → <span class="fn"><span class="fn"><span class="fn">m</span> <span class="fn">β</span></span> → <span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">(<a href=".././Init/Control/Basic.html#MonadControlT.stM">stM</a> <a href=".././Lean/CoreM.html#Lean.Core.CoreM">Lean.CoreM</a> <span class="fn">m</span> <span class="fn">β</span>)</span></span></span></span>) =&gt; <span class="fn"><span class="fn">f</span> <span class="fn">(<span class="fn">runInBase</span> <span class="fn">x</span>)</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.mapCoreM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.logMessageKind"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L698-L708">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.logMessageKind"><span class="name">Lean</span>.<span class="name">logMessageKind</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">kind</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Returns <code>true</code> if the given message kind has not been reported in the message log,
and then mark it as logged. Otherwise, returns <code>false</code>.
We use this API to ensure we don't log the same kind of warning multiple times.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.logMessageKind" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.enableRealizationsForConst"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/CoreM.lean#L710-L713">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/CoreM.html#Lean.enableRealizationsForConst"><span class="name">Lean</span>.<span class="name">enableRealizationsForConst</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Allows <code>realizeConst</code> calls for the given declaration in all derived environment branches.
Realizations will run using the given environment and options to ensure deterministic results. Note
that while we check that the function isn't called before the declaration is actually added to the
environment, we cannot automatically check that it isn't otherwise called too early in the sense
that helper declarations and environment extension state that may be relevant to realizations may
not have been added yet. We do check that we are not calling it from a different branch than <code>c</code> was
added on, which would be definitely too late. Thus, this function should generally be called in
elaborators calling <code>addDecl</code> (when that declaration is a plausible target for realization) at the
latest possible point, i.e. at the very end of the elaborator or just before a first realization may
be triggered if any.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/CoreM.html#Lean.enableRealizationsForConst">Lean.enableRealizationsForConst</a> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <a href=".././Lean/Environment.html#Lean.MonadEnv.getEnv">Lean.getEnv</a>
  let <span class="fn">__do_lift_1</span> ← <a href=".././Lean/Data/Options.html#Lean.MonadOptions.getOptions">Lean.getOptions</a>
  let <span class="fn">env</span> ← <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn"><span class="fn">__do_lift</span>.<a href=".././Lean/Environment.html#Lean.Environment.enableRealizationsForConst">enableRealizationsForConst</a></span> <span class="fn">__do_lift_1</span> <span class="fn">n</span>)</span></span>
  <span class="fn"><a href=".././Lean/MonadEnv.html#Lean.setEnv">Lean.setEnv</a> <span class="fn">env</span></span></span></li></ul></details><details id="instances-for-list-Lean.enableRealizationsForConst" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src=".././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>