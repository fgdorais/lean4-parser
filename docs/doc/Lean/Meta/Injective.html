<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Meta.Injective</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Meta.Injective";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Injective</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/Meta/Transform.html">Lean.Meta.Transform</a></li><li><a href="../.././Lean/Meta/Tactic/Apply.html">Lean.Meta.Tactic.Apply</a></li><li><a href="../.././Lean/Meta/Tactic/Assumption.html">Lean.Meta.Tactic.Assumption</a></li><li><a href="../.././Lean/Meta/Tactic/Cases.html">Lean.Meta.Tactic.Cases</a></li><li><a href="../.././Lean/Meta/Tactic/Injection.html">Lean.Meta.Tactic.Injection</a></li><li><a href="../.././Lean/Meta/Tactic/Refl.html">Lean.Meta.Tactic.Refl</a></li><li><a href="../.././Lean/Meta/Tactic/Subst.html">Lean.Meta.Tactic.Subst</a></li><li><a href="../.././Lean/Meta/Tactic/Simp/Types.html">Lean.Meta.Tactic.Simp.Types</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Meta.Injective" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.elimOptParam"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">elimOptParam</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.occursOrInType"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">occursOrInType</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.occursOrInType.go"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">occursOrInType</span>.<span class="name">go</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.mkInjectiveTheoremNameFor"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">mkInjectiveTheoremNameFor</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.mkInjectiveEqTheoremNameFor"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">mkInjectiveEqTheoremNameFor</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.genInjectivity"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">genInjectivity</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.mkInjectiveTheorems"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">mkInjectiveTheorems</span></a></div></nav><main>
<div class="decl" id="Lean.Meta.elimOptParam"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L27-L32">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.elimOptParam"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">elimOptParam</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">type</span> : <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/CoreM.html#Lean.Core.CoreM">CoreM</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Meta.elimOptParam" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.occursOrInType"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L35-L61">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.occursOrInType"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">occursOrInType</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href="../.././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e </span><span class="fn">t</span> : <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Returns true if <code>e</code> occurs either in <code>t</code>, or in the type of a sub-expression of <code>t</code>.
Consider the following example:</p><pre><code class="language-lean">inductive Tyₛ : Type (u+1)
| SPi : (T : Type u) -&gt; (T -&gt; Tyₛ) -&gt; Tyₛ

inductive Tmₛ.{u} :  Tyₛ.{u} -&gt; Type (u+1)
| app : Tmₛ (.SPi T A) -&gt; (arg : T) -&gt; Tmₛ (A arg)```
</code></pre><p>When looking for fixed arguments in <code>Tmₛ.app</code>, if we only consider occurrences in the term <code>Tmₛ (A arg)</code>,
<code>T</code> is considered non-fixed despite the fact that <code>A : T -&gt; Tyₛ</code>.
This leads to an ill-typed injectivity theorem signature:</p><pre><code class="language-lean">theorem Tmₛ.app.inj {T : Type u} {A : T → Tyₛ} {a : Tmₛ (Tyₛ.SPi T A)} {arg : T} {T_1 : Type u} {a_1 : Tmₛ (Tyₛ.SPi T_1 A)} :
Tmₛ.app a arg = Tmₛ.app a_1 arg →
  T = T_1 ∧ <a href="../.././Init/Prelude.html#HEq">HEq</a> a a_1 := fun x =&gt; Tmₛ.noConfusion x fun T_eq A_eq a_eq arg_eq =&gt; <a href="../.././Init/Prelude.html#eq_of_heq">eq_of_heq</a> a_eq
</code></pre><p>Instead of checking the type of every subterm, we only need to check the type of free variables, since free variables introduced in
the constructor may only appear in the type of other free variables introduced after them.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/Injective.html#Lean.Meta.occursOrInType">Lean.Meta.occursOrInType</a> <span class="fn">lctx</span> <span class="fn">e</span> <span class="fn">t</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<a href="../.././Lean/Util/FindExpr.html#Lean.Expr.find?">Lean.Expr.find?</a> <span class="fn">(<a href="../.././Lean/Meta/Injective.html#Lean.Meta.occursOrInType.go">Lean.Meta.occursOrInType.go</a> <span class="fn">lctx</span> <span class="fn">e</span>)</span> <span class="fn">t</span>)</span>.<a href="../.././Init/Data/Option/Basic.html#Option.isSome">isSome</a></span></li></ul></details><details id="instances-for-list-Lean.Meta.occursOrInType" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.occursOrInType.go"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L58-L61">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.occursOrInType.go"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">occursOrInType</span>.<span class="name">go</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href="../.././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e </span><span class="fn">s</span> : <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><a href="../.././Lean/Meta/Injective.html#Lean.Meta.occursOrInType.go">Lean.Meta.occursOrInType.go</a> <span class="fn">lctx</span> <span class="fn">e</span> <span class="fn">s</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Control/Id.html#Id.run">Id.run</a> (<span class="fn">s</span> <a href="../.././Init/Prelude.html#BEq.beq">==</a> <span class="fn">e</span>)</span></li></ul></details><details id="instances-for-list-Lean.Meta.occursOrInType.go" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.mkInjectiveTheoremNameFor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L128-L129">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.mkInjectiveTheoremNameFor"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">mkInjectiveTheoremNameFor</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctorName</span> : <a href="../.././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Lean.Name">Name</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/Injective.html#Lean.Meta.mkInjectiveTheoremNameFor">Lean.Meta.mkInjectiveTheoremNameFor</a> <span class="fn">ctorName</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">ctorName</span> <a href="../.././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn">`inj</span></li></ul></details><details id="instances-for-list-Lean.Meta.mkInjectiveTheoremNameFor" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.mkInjectiveEqTheoremNameFor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L143-L144">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.mkInjectiveEqTheoremNameFor"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">mkInjectiveEqTheoremNameFor</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctorName</span> : <a href="../.././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Lean.Name">Name</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Meta/Injective.html#Lean.Meta.mkInjectiveEqTheoremNameFor">Lean.Meta.mkInjectiveEqTheoremNameFor</a> <span class="fn">ctorName</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">ctorName</span> <a href="../.././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn">`injEq</span></li></ul></details><details id="instances-for-list-Lean.Meta.mkInjectiveEqTheoremNameFor" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.genInjectivity"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L175-L178">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.genInjectivity"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">genInjectivity</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.Meta.mkInjectiveTheorems"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Meta/Injective.lean#L180-L195">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Meta/Injective.html#Lean.Meta.mkInjectiveTheorems"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">mkInjectiveTheorems</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href="../.././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Meta/Basic.html#Lean.Meta.MetaM">MetaM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Meta.mkInjectiveTheorems" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>