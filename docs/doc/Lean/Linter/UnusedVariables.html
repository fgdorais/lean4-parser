<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Linter.UnusedVariables</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Linter.UnusedVariables";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/Elab/Command.html">Lean.Elab.Command</a></li><li><a href="../.././Lean/Linter/Util.html">Lean.Linter.Util</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Linter.UnusedVariables" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.linter.unusedVariables"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.linter.unusedVariables.funArgs"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span>.<span class="name">funArgs</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.linter.unusedVariables.patternVars"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span>.<span class="name">patternVars</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.linter.unusedVariables.analyzeTactics"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span>.<span class="name">analyzeTactics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.getLinterUnusedVariables"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getLinterUnusedVariables</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.getLinterUnusedVariablesFunArgs"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getLinterUnusedVariablesFunArgs</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.getLinterUnusedVariablesPatternVars"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getLinterUnusedVariablesPatternVars</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.IgnoreFunction"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">IgnoreFunction</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.mkIgnoreFnImpl"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">mkIgnoreFnImpl</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.mkIgnoreFn"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">mkIgnoreFn</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.builtinUnusedVariablesIgnoreFnsRef"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">builtinUnusedVariablesIgnoreFnsRef</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.addBuiltinUnusedVariablesIgnoreFn"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">addBuiltinUnusedVariablesIgnoreFn</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.unusedVariablesIgnoreFnsExt"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">unusedVariablesIgnoreFnsExt</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.getUnusedVariablesIgnoreFns"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getUnusedVariablesIgnoreFns</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.insertObjImpl"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">insertObjImpl</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.insertObj"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">insertObj</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.visitAssignments"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.visitAssignments.visitNode"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span>.<span class="name">visitNode</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.visitAssignments.visitEntry"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span>.<span class="name">visitEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.visitAssignments.visitExpr"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span>.<span class="name">visitExpr</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.followAliases"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">followAliases</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.FVarDefinition"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">FVarDefinition</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.References"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">References</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.collectReferences"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">collectReferences</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.collectReferences.go"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">collectReferences</span>.<span class="name">go</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.collectReferences.skipDeclIdIfPresent"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">collectReferences</span>.<span class="name">skipDeclIdIfPresent</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Linter.UnusedVariables.unusedVariables"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">unusedVariables</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MessageData.isUnusedVariableWarning"><span class="name">Lean</span>.<span class="name">MessageData</span>.<span class="name">isUnusedVariableWarning</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="Unused-variable-Linter">Unused variable Linter <a class="hover-link" href="#Unused-variable-Linter">#</a></h1><p>This file implements the unused variable linter, which runs automatically on all
commands and reports any local variables that are never referred to, using
information from the info tree.</p><p>It is not immediately obvious but this is a surprisingly expensive check without
some optimizations.  The main complication is that it can be difficult to
determine what constitutes a &quot;use&quot; apart from direct references to a variable
that we can easily find in the info tree.  For example, we would like this to be
considered a use of <code>x</code>:</p><pre><code>def foo (x : Nat) : <a href="../.././Init/Prelude.html#Nat">Nat</a> := by assumption
</code></pre><p>The final proof term is <code>fun x =&gt; x</code> so clearly <code>x</code> was used, but we can't make
use of this because the final proof term is after we have abstracted over the
original <code>fvar</code> for <code>x</code>. Instead, we make sure to store the proof term before
abstraction but after instantiation of mvars in the info tree and retrieve it in
the linter. Using the instantiated term is very important as redoing that step
in the linter can be prohibitively expensive. The downside of special-casing the
definition body in this way is that while it works for parameters, it does not
work for local variables in the body, so we ignore them by default if any tactic
infos are present (<code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.analyzeTactics">linter.unusedVariables.analyzeTactics</a></code>).</p><p>If we do turn on this option and look further into the tactic state, we can see
the <code>fvar</code> show up in the instantiation to the original goal metavariable
<code>?m : <a href="../.././Init/Prelude.html#Nat">Nat</a> := x</code>, but it is not always the case that we can follow metavariable
instantiations to determine what happened after the fact, because tactics might
skip the goal metavariable and instantiate some other metavariable created prior
to it instead.  Instead, we use a (much more expensive) overapproximation, which
is just to look through the entire metavariable context looking for occurrences
of <code>x</code>. We use caching to ensure that this is still linear in the size of the
info tree, even though there are many metavariable contexts in all the
intermediate stages of elaboration; these are highly similar and make use of
<code>PersistentHashMap</code> so there is a lot of subterm sharing we can take advantage
of.</p><h2 class="markdown-heading" id="The-unused-variables-ignore-fn-attribute">The <code>@[unused_variables_ignore_fn]</code> attribute <a class="hover-link" href="#The-unused-variables-ignore-fn-attribute">#</a></h2><p>Some occurrences of variables are deliberately unused, or at least we don't want
to lint on unused variables in these positions. For example:</p><pre><code>def foo (x : Nat) : (y : Nat) → <a href="../.././Init/Prelude.html#Nat">Nat</a> := fun _ =&gt; x
                  -- ^ don't lint this unused variable because it is public API
</code></pre><p>They are generally a syntactic criterion, so we allow adding custom
<code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code>s so that external syntax can also opt in to lint suppression,
like so:</p><pre><code>macro (name := foobarKind) &quot;foobar &quot; name:ident : command =&gt; `(def foo ($name : Nat) := 0)

foobar n -- linted because n is unused in the macro expansion

@[unused_variables_ignore_fn]
def ignoreFoobar : <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">Lean.Linter.IgnoreFunction</a> := fun _ stack _ =&gt; stack.matches [``foobarKind]

foobar n -- not linted
</code></pre></div><div class="decl" id="Lean.Linter.linter.unusedVariables"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L79-L83">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Enables or disables all unused variable linter warnings</p></div></div><div class="decl" id="Lean.Linter.linter.unusedVariables.funArgs"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L84-L88">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.funArgs"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span>.<span class="name">funArgs</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Enables or disables unused variable linter warnings in function arguments</p></div></div><div class="decl" id="Lean.Linter.linter.unusedVariables.patternVars"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L89-L93">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.patternVars"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span>.<span class="name">patternVars</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Enables or disables unused variable linter warnings in patterns</p></div></div><div class="decl" id="Lean.Linter.linter.unusedVariables.analyzeTactics"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L94-L104">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.analyzeTactics"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">linter</span>.<span class="name">unusedVariables</span>.<span class="name">analyzeTactics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Enables linting variables defined in tactic blocks, may be expensive for complex proofs</p></div></div><div class="decl" id="Lean.Linter.getLinterUnusedVariables"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L106-L108">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariables"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getLinterUnusedVariables</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">o</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Gets the status of <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables">linter.unusedVariables</a></code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariables">Lean.Linter.getLinterUnusedVariables</a> <span class="fn">o</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Linter/Basic.html#Lean.Linter.getLinterValue">Lean.Linter.getLinterValue</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables">Lean.Linter.linter.unusedVariables</a> <span class="fn">o</span></span></li></ul></details><details id="instances-for-list-Lean.Linter.getLinterUnusedVariables" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.getLinterUnusedVariablesFunArgs"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L110-L112">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariablesFunArgs"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getLinterUnusedVariablesFunArgs</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">o</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Gets the status of <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.funArgs">linter.unusedVariables.funArgs</a></code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariablesFunArgs">Lean.Linter.getLinterUnusedVariablesFunArgs</a> <span class="fn">o</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Data/KVMap.html#Lean.KVMap.get">Lean.KVMap.get</a> <span class="fn">o</span> <span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.funArgs">Lean.Linter.linter.unusedVariables.funArgs</a>.<a href="../.././Lean/Data/Options.html#Lean.Option.name">name</a></span> <span class="fn">(<a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariables">Lean.Linter.getLinterUnusedVariables</a> <span class="fn">o</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Linter.getLinterUnusedVariablesFunArgs" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.getLinterUnusedVariablesPatternVars"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L114-L116">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariablesPatternVars"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getLinterUnusedVariablesPatternVars</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">o</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Gets the status of <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.patternVars">linter.unusedVariables.patternVars</a></code></p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariablesPatternVars">Lean.Linter.getLinterUnusedVariablesPatternVars</a> <span class="fn">o</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Data/KVMap.html#Lean.KVMap.get">Lean.KVMap.get</a> <span class="fn">o</span> <span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables.patternVars">Lean.Linter.linter.unusedVariables.patternVars</a>.<a href="../.././Lean/Data/Options.html#Lean.Option.name">name</a></span> <span class="fn">(<a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getLinterUnusedVariables">Lean.Linter.getLinterUnusedVariables</a> <span class="fn">o</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Linter.getLinterUnusedVariablesPatternVars" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.IgnoreFunction"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L118-L129">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">IgnoreFunction</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>An <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code> receives:</p><ul>
<li>a <code>Syntax.ident</code> for the unused variable</li>
<li>a <code>Syntax.Stack</code> with the location of this piece of syntax in the command</li>
<li>The <code>Options</code> set locally to this syntax</li>
</ul><p>and should return <code>true</code> to indicate that the lint should be suppressed,
or <code>false</code> to proceed with linting as usual (other <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code>s may still
say it is ignored). A variable is only linted if it is unused and no
<code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code> returns <code>true</code> on this syntax.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">Lean.Linter.IgnoreFunction</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">(<a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a> → <span class="fn"><a href="../.././Lean/Syntax.html#Lean.Syntax.Stack">Lean.Syntax.Stack</a> → <span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Options">Lean.Options</a> → <a href="../.././Init/Prelude.html#Bool">Bool</a></span></span>)</span></li></ul></details><details id="instances-for-list-Lean.Linter.IgnoreFunction" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.mkIgnoreFnImpl"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L131-L139">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.mkIgnoreFnImpl"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">mkIgnoreFnImpl</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">constName</span> : <a href="../.././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Environment.html#Lean.ImportM">ImportM</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></span></div></div><p>Interpret an <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code> from the environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Linter.mkIgnoreFnImpl" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.mkIgnoreFn"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L141-L142">source</a></div><div class="attributes">@[implemented_by Lean.Linter.mkIgnoreFnImpl]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.mkIgnoreFn"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">mkIgnoreFn</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">constName</span> : <a href="../.././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Environment.html#Lean.ImportM">ImportM</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></span></div></div><p>Interpret an <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code> from the environment.</p></div></div><div class="decl" id="Lean.Linter.builtinUnusedVariablesIgnoreFnsRef"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L144-L145">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.builtinUnusedVariablesIgnoreFnsRef"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">builtinUnusedVariablesIgnoreFnsRef</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a>)</span></span></div></div><p>The list of builtin <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code>s.</p></div></div><div class="decl" id="Lean.Linter.addBuiltinUnusedVariablesIgnoreFn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L147-L150">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.addBuiltinUnusedVariablesIgnoreFn"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">addBuiltinUnusedVariablesIgnoreFn</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">h</span> : <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Adds a new builtin <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code>.
This function should only be used from within the <code><a href="../.././Lean.html">Lean</a></code> package.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.addBuiltinUnusedVariablesIgnoreFn">Lean.Linter.addBuiltinUnusedVariablesIgnoreFn</a> <span class="fn">h</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/System/ST.html#ST.Ref.modify">ST.Ref.modify</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.builtinUnusedVariablesIgnoreFnsRef">Lean.Linter.builtinUnusedVariablesIgnoreFnsRef</a> <span class="fn">fun (<span class="fn">x</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">Lean.Linter.IgnoreFunction</a></span>) =&gt; <span class="fn"><span class="fn"><span class="fn">x</span>.<a href="../.././Init/Prelude.html#Array.push">push</a></span> <span class="fn">h</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Linter.addBuiltinUnusedVariablesIgnoreFn" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.unusedVariablesIgnoreFnsExt"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L152-L163">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.unusedVariablesIgnoreFnsExt"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">unusedVariablesIgnoreFnsExt</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <a href="../.././Init/Prelude.html#Lean.Name">Name</a> (<a href="../.././Init/Prelude.html#Lean.Name">Name</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a>) (<span class="fn"><a href="../.././Init/Prelude.html#List">List</a> <a href="../.././Init/Prelude.html#Lean.Name">Name</a></span> <a href="../.././Init/Prelude.html#Prod">×</a> <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></span>)</span></div></div><p>An extension which keeps track of registered <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code>s.</p></div></div><div class="decl" id="Lean.Linter.getUnusedVariablesIgnoreFns"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L283-L285">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getUnusedVariablesIgnoreFns"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">getUnusedVariablesIgnoreFns</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Elab/Command.html#Lean.Elab.Command.CommandElabM">Elab.Command.CommandElabM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a>)</span></span></div></div><p>Get the current list of <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.IgnoreFunction">IgnoreFunction</a></code>s.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.getUnusedVariablesIgnoreFns">Lean.Linter.getUnusedVariablesIgnoreFns</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <a href="../.././Lean/Environment.html#Lean.MonadEnv.getEnv">Lean.getEnv</a>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn"><span class="fn">(<span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.unusedVariablesIgnoreFnsExt">Lean.Linter.unusedVariablesIgnoreFnsExt</a>.<a href="../.././Lean/Environment.html#Lean.PersistentEnvExtension.getState">getState</a></span> <span class="fn">__do_lift</span>)</span>.<a href="../.././Init/Prelude.html#Prod.snd">snd</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.Linter.getUnusedVariablesIgnoreFns" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.insertObjImpl"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L289-L298">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.insertObjImpl"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">insertObjImpl</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">set</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Init/Prelude.html#USize">USize</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a</span> : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Collect into a heterogeneous collection of objects with external storage. This uses
pointer identity and does not store the objects, so it is important not to store the last
pointer to an object in the map, or it can be freed and reused, resulting in incorrect behavior.</p><p>Returns <code>true</code> if the object was not already in the set.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Linter.UnusedVariables.insertObjImpl" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.insertObj"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L300-L301">source</a></div><div class="attributes">@[implemented_by Lean.Linter.UnusedVariables.insertObjImpl]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.insertObj"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">insertObj</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">set</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Init/Prelude.html#USize">USize</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a</span> : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Collect into a heterogeneous collection of objects with external storage. This uses
pointer identity and does not store the objects, so it is important not to store the last
pointer to an object in the map, or it can be freed and reused, resulting in incorrect behavior.</p><p>Returns <code>true</code> if the object was not already in the set.</p></div></div><div class="decl" id="Lean.Linter.UnusedVariables.visitAssignments"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L303-L335">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.visitAssignments"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">set</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Init/Prelude.html#USize">USize</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">fvarUses</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">assignments</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">PersistentHashMap</a> <a href="../.././Lean/Expr.html#Lean.MVarId">MVarId</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Collects into <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References.fvarUses">fvarUses</a></code> all <code>fvar</code>s occurring in the <code>Expr</code>s in <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References.assignments">assignments</a></code>.
This implementation respects subterm sharing in both the <code>PersistentHashMap</code> and the <code>Expr</code>
to ensure that pointer-equal subobjects are not visited multiple times, which is important
in practice because these expressions are very frequently highly shared.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Linter.UnusedVariables.visitAssignments" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.visitAssignments.visitNode"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L317-L321">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.visitAssignments.visitNode"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span>.<span class="name">visitNode</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">set</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Init/Prelude.html#USize">USize</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">fvarUses</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">node</span> : <span class="fn"><a href="../.././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.Node">PersistentHashMap.Node</a> <a href="../.././Lean/Expr.html#Lean.MVarId">MVarId</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Util/MonadCache.html#Lean.MonadCacheT">MonadCacheT</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a> <a href="../.././Init/Prelude.html#Unit">Unit</a> <a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Visit a <code>PersistentHashMap.Node</code>, collecting all fvars in it into <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References.fvarUses">fvarUses</a></code></p></div></div><div class="decl" id="Lean.Linter.UnusedVariables.visitAssignments.visitEntry"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L323-L328">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.visitAssignments.visitEntry"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span>.<span class="name">visitEntry</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">set</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Init/Prelude.html#USize">USize</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">fvarUses</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <span class="fn"><a href="../.././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.Entry">PersistentHashMap.Entry</a> <a href="../.././Lean/Expr.html#Lean.MVarId">MVarId</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a> <span class="fn">(<a href="../.././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap.Node">PersistentHashMap.Node</a> <a href="../.././Lean/Expr.html#Lean.MVarId">MVarId</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Util/MonadCache.html#Lean.MonadCacheT">MonadCacheT</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a> <a href="../.././Init/Prelude.html#Unit">Unit</a> <a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Visit a <code>PersistentHashMap.Entry</code>, collecting all fvars in it into <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References.fvarUses">fvarUses</a></code></p></div></div><div class="decl" id="Lean.Linter.UnusedVariables.visitAssignments.visitExpr"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L330-L335">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.visitAssignments.visitExpr"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">visitAssignments</span>.<span class="name">visitExpr</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">set</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Init/Prelude.html#USize">USize</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">fvarUses</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Util/MonadCache.html#Lean.MonadCacheT">MonadCacheT</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a> <a href="../.././Init/Prelude.html#Unit">Unit</a> <a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Visit an <code>Expr</code>, collecting all fvars in it into <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References.fvarUses">fvarUses</a></code></p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Linter.UnusedVariables.visitAssignments.visitExpr" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.followAliases"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L337-L343">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.followAliases"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">followAliases</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">aliases</span> : <span class="fn"><a href="../.././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a></div></div><p>Given <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.FVarDefinition.aliases">aliases</a></code> as a map from an alias to what it aliases, we get the original
term by recursion. This has no cycle detection, so if <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.FVarDefinition.aliases">aliases</a></code> contains a loop
then this function will recurse infinitely.</p></div></div><div class="decl" id="Lean.Linter.UnusedVariables.FVarDefinition"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L345-L357">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.FVarDefinition"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">FVarDefinition</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Information regarding an <code>FVarId</code> definition.</p><ul class="structure_fields" id="Lean.Linter.UnusedVariables.FVarDefinition.mk"><li id="Lean.Linter.UnusedVariables.FVarDefinition.userName" class="structure_field"><div class="structure_field_info">userName : <a href="../.././Init/Prelude.html#Lean.Name">Name</a></div><div class="structure_field_doc"><p>The user-provided name of the <code>FVarId</code></p></div></li><li id="Lean.Linter.UnusedVariables.FVarDefinition.stx" class="structure_field"><div class="structure_field_info">stx : <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></div><div class="structure_field_doc"><p>A (usually <code>.ident</code>) syntax for the defined variable</p></div></li><li id="Lean.Linter.UnusedVariables.FVarDefinition.opts" class="structure_field"><div class="structure_field_info">opts : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a></div><div class="structure_field_doc"><p>The options set locally to this part of the syntax (used by <code>IgnoreFn</code>)</p></div></li><li id="Lean.Linter.UnusedVariables.FVarDefinition.aliases" class="structure_field"><div class="structure_field_info">aliases : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a></span></div><div class="structure_field_doc"><p>The list of all <code>FVarId</code>s that are considered as being defined at this position.
This can have more than one element if multiple variables are declared by the same
syntax, such as the <code>h</code> in <code>if h : c then ... else ...</code>. We only report an unused variable
at this span if all variables in <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.FVarDefinition.aliases">aliases</a></code> are unused.</p></div></li></ul><details id="instances-for-list-Lean.Linter.UnusedVariables.FVarDefinition" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.References"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L359-L380">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">References</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>The main data structure used to collect information from the info tree regarding unused
variables.</p><ul class="structure_fields" id="Lean.Linter.UnusedVariables.References.mk"><li id="Lean.Linter.UnusedVariables.References.constDecls" class="structure_field"><div class="structure_field_info">constDecls : <span class="fn"><a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a></span></div><div class="structure_field_doc"><p>The set of all (ranges corresponding to) global definitions that are made in the syntax.
For example in <code>mutual def foo := ...  def bar := ... where baz := ... end</code> this would be
the spans for <code>foo</code>, <code>bar</code>, and <code>baz</code>. Global definitions are always treated as used.
(It would be nice to be able to detect unused global definitions but this requires more
information than the linter framework can provide.)</p></div></li><li id="Lean.Linter.UnusedVariables.References.fvarDefs" class="structure_field"><div class="structure_field_info">fvarDefs : <span class="fn"><a href="../.././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href="../.././Lean/Syntax.html#String.Range">String.Range</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.FVarDefinition">FVarDefinition</a></span></div><div class="structure_field_doc"><p>The collection of all local declarations, organized by the span of the declaration.
We collapse all declarations declared at the same position into a single record using
<code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.FVarDefinition.aliases">FVarDefinition.aliases</a></code>.</p></div></li><li id="Lean.Linter.UnusedVariables.References.fvarUses" class="structure_field"><div class="structure_field_info">fvarUses : <span class="fn"><a href="../.././Std/Data/HashSet/Basic.html#Std.HashSet">Std.HashSet</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a></span></div><div class="structure_field_doc"><p>The set of <code>FVarId</code>s that are used directly. These may or may not be aliases.</p></div></li><li id="Lean.Linter.UnusedVariables.References.fvarAliases" class="structure_field"><div class="structure_field_info">fvarAliases : <span class="fn"><a href="../.././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a> <a href="../.././Lean/Expr.html#Lean.FVarId">FVarId</a></span></div><div class="structure_field_doc"><p>A mapping from alias to original FVarId. We don't guarantee that the value is not itself
an alias, but we use <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.followAliases">followAliases</a></code> when adding new elements to try to avoid long chains.</p></div></li><li id="Lean.Linter.UnusedVariables.References.assignments" class="structure_field"><div class="structure_field_info">assignments : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Lean/Data/PersistentHashMap.html#Lean.PersistentHashMap">PersistentHashMap</a> <a href="../.././Lean/Expr.html#Lean.MVarId">MVarId</a> <a href="../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span></div><div class="structure_field_doc"><p>Collection of all <code>MetavarContext</code>s following the execution of a tactic. We trawl these
if needed to find additional <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References.fvarUses">fvarUses</a></code>.</p></div></li></ul><details id="instances-for-list-Lean.Linter.UnusedVariables.References" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.collectReferences"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L382-L463">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.collectReferences"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">collectReferences</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">infoTrees</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Elab.InfoTree</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cmdStxRange</span> : <a href="../.././Lean/Syntax.html#String.Range">String.Range</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References">References</a> <a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Collect information from the <code>infoTrees</code> into <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References">References</a></code>.
See <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References">References</a></code> for more information about the return value.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.collectReferences">Lean.Linter.UnusedVariables.collectReferences</a> <span class="fn">infoTrees</span> <span class="fn">cmdStxRange</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn">(<a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.collectReferences.go">Lean.Linter.UnusedVariables.collectReferences.go</a> <span class="fn">cmdStxRange</span> <span class="fn">infoTrees</span> <a href="../.././Init/Prelude.html#Option.none">none</a>)</span>.<a href="../.././Init/Prelude.html#ReaderT.run">run</a></span> <a href="../.././Init/Prelude.html#Bool.false">false</a></span></li></ul></details><details id="instances-for-list-Lean.Linter.UnusedVariables.collectReferences" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.collectReferences.go"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L387-L456">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.collectReferences.go"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">collectReferences</span>.<span class="name">go</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">cmdStxRange</span> : <a href="../.././Lean/Syntax.html#String.Range">String.Range</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">infoTrees</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Elab.InfoTree</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.ContextInfo">Elab.ContextInfo</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Init/Prelude.html#Bool">Bool</a> <span class="fn">(<a href="../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.References">References</a> <a href="../.././Init/System/IO.html#IO">IO</a>)</span> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.Linter.UnusedVariables.collectReferences.skipDeclIdIfPresent"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L459-L463">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.collectReferences.skipDeclIdIfPresent"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">collectReferences</span>.<span class="name">skipDeclIdIfPresent</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">stx</span> : <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></div></div><p>Since declarations attach the declaration info to the <code>declId</code>,
we skip that to get to the <code>.ident</code> if possible.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.collectReferences.skipDeclIdIfPresent">Lean.Linter.UnusedVariables.collectReferences.skipDeclIdIfPresent</a> <span class="fn">stx</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Init/Prelude.html#ite">if</a> <span class="fn"><span class="fn"><span class="fn">stx</span>.<a href="../.././Init/Prelude.html#Lean.Syntax.isOfKind">isOfKind</a></span> <span class="fn">`Lean.Parser.Command.declId</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Bool.true">true</a> <a href="../.././Init/Prelude.html#ite">then</a> <span class="fn">stx</span><a href="../.././Init/GetElem.html#GetElem.getElem">[</a><span class="fn">0</span><a href="../.././Init/GetElem.html#GetElem.getElem">]</a> <a href="../.././Init/Prelude.html#ite">else</a> <span class="fn">stx</span></li></ul></details><details id="instances-for-list-Lean.Linter.UnusedVariables.collectReferences.skipDeclIdIfPresent" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Linter.UnusedVariables.unusedVariables"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L471-L564">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.UnusedVariables.unusedVariables"><span class="name">Lean</span>.<span class="name">Linter</span>.<span class="name">UnusedVariables</span>.<span class="name">unusedVariables</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Elab/Command.html#Lean.Elab.Command.Linter">Linter</a></div></div><p>Reports unused variable warnings on each command. Use <code><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables">linter.unusedVariables</a></code> to disable.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Linter.UnusedVariables.unusedVariables" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.MessageData.isUnusedVariableWarning"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Linter/UnusedVariables.lean#L571-L574">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Linter/UnusedVariables.html#Lean.MessageData.isUnusedVariableWarning"><span class="name">Lean</span>.<span class="name">MessageData</span>.<span class="name">isUnusedVariableWarning</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">msg</span> : <a href="../.././Lean/Message.html#Lean.MessageData">MessageData</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Init/Prelude.html#Bool">Bool</a></div></div><p>Returns true if this is a message produced by the unused variable linter.
This is used to give these messages an additional &quot;faded&quot; style in the editor.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">msg</span>.<a href="../.././Lean/Linter/UnusedVariables.html#Lean.MessageData.isUnusedVariableWarning">isUnusedVariableWarning</a></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Message.html#Lean.MessageData.hasTag">Lean.MessageData.hasTag</a> <span class="fn">(fun (<span class="fn">x</span> : <a href="../.././Init/Prelude.html#Lean.Name">Lean.Name</a>) =&gt; <span class="fn">x</span> <a href="../.././Init/Prelude.html#BEq.beq">==</a> <span class="fn"><a href="../.././Lean/Linter/UnusedVariables.html#Lean.Linter.linter.unusedVariables">Lean.Linter.linter.unusedVariables</a>.<a href="../.././Lean/Data/Options.html#Lean.Option.name">name</a></span>)</span> <span class="fn">msg</span></span></li></ul></details><details id="instances-for-list-Lean.MessageData.isUnusedVariableWarning" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>