<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="icon" href=".././favicon.svg"></link><link rel="mask-icon" href=".././favicon.svg" color="#000000"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Environment</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.Environment";</script><script type="module" src=".././jump-src.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././expand-nav.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Environment</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Init/Dynamic.html">Init.Dynamic</a></li><li><a href=".././Lean/Declaration.html">Lean.Declaration</a></li><li><a href=".././Lean/ImportingFlag.html">Lean.ImportingFlag</a></li><li><a href=".././Lean/LoadDynlib.html">Lean.LoadDynlib</a></li><li><a href=".././Lean/LocalContext.html">Lean.LocalContext</a></li><li><a href=".././Lean/PrivateName.html">Lean.PrivateName</a></li><li><a href=".././Init/Control/StateRef.html">Init.Control.StateRef</a></li><li><a href=".././Init/Data/Stream.html">Init.Data.Stream</a></li><li><a href=".././Init/System/Promise.html">Init.System.Promise</a></li><li><a href=".././Lean/Data/NameTrie.html">Lean.Data.NameTrie</a></li><li><a href=".././Lean/Data/SMap.html">Lean.Data.SMap</a></li><li><a href=".././Lean/Util/FindExpr.html">Lean.Util.FindExpr</a></li><li><a href=".././Lean/Util/FoldConsts.html">Lean.Util.FoldConsts</a></li><li><a href=".././Lean/Util/InstantiateLevelParams.html">Lean.Util.InstantiateLevelParams</a></li><li><a href=".././Lean/Util/Path.html">Lean.Util.Path</a></li><li><a href=".././Lean/Util/Profile.html">Lean.Util.Profile</a></li><li><a href=".././Init/Data/Array/BinSearch.html">Init.Data.Array.BinSearch</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Environment" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.debug.skipKernelTC"><span class="name">Lean</span>.<span class="name">debug</span>.<span class="name">skipKernelTC</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionStateSpec"><span class="name">Lean</span>.<span class="name">EnvExtensionStateSpec</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionState"><span class="name">Lean</span>.<span class="name">EnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleIdx"><span class="name">Lean</span>.<span class="name">ModuleIdx</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instModuleIdxBEq"><span class="name">Lean</span>.<span class="name">instModuleIdxBEq</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instModuleIdxToString"><span class="name">Lean</span>.<span class="name">instModuleIdxToString</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleIdx.toNat"><span class="name">Lean</span>.<span class="name">ModuleIdx</span>.<span class="name">toNat</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedModuleIdx"><span class="name">Lean</span>.<span class="name">instInhabitedModuleIdx</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instGetElemArrayModuleIdxLtNatToNatSize"><span class="name">Lean</span>.<span class="name">instGetElemArrayModuleIdxLtNatToNatSize</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instGetElem?ArrayModuleIdxLtNatToNatSize"><span class="name">Lean</span>.<span class="name">instGetElem?ArrayModuleIdxLtNatToNatSize</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstMap"><span class="name">Lean</span>.<span class="name">ConstMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Import"><span class="name">Lean</span>.<span class="name">Import</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instReprImport"><span class="name">Lean</span>.<span class="name">instReprImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedImport"><span class="name">Lean</span>.<span class="name">instInhabitedImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instCoeNameImport"><span class="name">Lean</span>.<span class="name">instCoeNameImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instToStringImport"><span class="name">Lean</span>.<span class="name">instToStringImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion"><span class="name">Lean</span>.<span class="name">CompactedRegion</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion.isMemoryMapped"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">isMemoryMapped</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.CompactedRegion.free"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">free</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionEntrySpec"><span class="name">Lean</span>.<span class="name">EnvExtensionEntrySpec</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtensionEntry"><span class="name">Lean</span>.<span class="name">EnvExtensionEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvExtensionEntry"><span class="name">Lean</span>.<span class="name">instNonemptyEnvExtensionEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ModuleData"><span class="name">Lean</span>.<span class="name">ModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedModuleData"><span class="name">Lean</span>.<span class="name">instInhabitedModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvironmentHeader"><span class="name">Lean</span>.<span class="name">EnvironmentHeader</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvironmentHeader"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironmentHeader</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Diagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instInhabitedDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.instNonemptyEnvironment"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instNonemptyEnvironment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Exception"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Exception</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.instNonemptyException"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instNonemptyException</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.find?"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">find?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.addDeclCore"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">addDeclCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.addDeclWithoutChecking"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">addDeclWithoutChecking</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.Diagnostics.isEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">Diagnostics</span>.<span class="name">isEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.enableDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">enableDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">isDiagnosticsEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.resetDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">resetDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.Diagnostics.recordUnfold"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">Diagnostics</span>.<span class="name">recordUnfold</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.getDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">getDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.Environment.setDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">setDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.KernelException"><span class="name">Lean</span>.<span class="name">KernelException</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantKind"><span class="name">Lean</span>.<span class="name">ConstantKind</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedConstantKind"><span class="name">Lean</span>.<span class="name">instInhabitedConstantKind</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instBEqConstantKind"><span class="name">Lean</span>.<span class="name">instBEqConstantKind</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instReprConstantKind"><span class="name">Lean</span>.<span class="name">instReprConstantKind</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantKind.ofConstantInfo"><span class="name">Lean</span>.<span class="name">ConstantKind</span>.<span class="name">ofConstantInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.AsyncConstantInfo"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedAsyncConstantInfo"><span class="name">Lean</span>.<span class="name">instInhabitedAsyncConstantInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.AsyncConstantInfo.toConstantVal"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">toConstantVal</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.AsyncConstantInfo.toConstantInfo"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">toConstantInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.AsyncConstantInfo.ofConstantInfo"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">ofConstantInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.AsyncConstantInfo.isUnsafe"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">isUnsafe</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyAsyncContext"><span class="name">Lean</span>.<span class="name">instNonemptyAsyncContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedAsyncConsts"><span class="name">Lean</span>.<span class="name">instInhabitedAsyncConsts</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instTypeNameAsyncConsts"><span class="name">Lean</span>.<span class="name">instTypeNameAsyncConsts</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedVisibilityMap"><span class="name">Lean</span>.<span class="name">instInhabitedVisibilityMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyVisibilityMap"><span class="name">Lean</span>.<span class="name">instNonemptyVisibilityMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyRealizationResult"><span class="name">Lean</span>.<span class="name">instNonemptyRealizationResult</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment"><span class="name">Lean</span>.<span class="name">Environment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instNonemptyEnvironment"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.ofKernelEnv"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">ofKernelEnv</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.toKernelEnv"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">toKernelEnv</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.setExporting"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">setExporting</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.asyncPrefix?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">asyncPrefix?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isRealizing"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isRealizing</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.importEnv?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">importEnv?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.unlockAsync"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">unlockAsync</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.asyncMayContain"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">asyncMayContain</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addDeclCore"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addDeclCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.constants"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">constants</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.const2ModIdx"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">const2ModIdx</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addExtraName"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addExtraName</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.findAsync?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">findAsync?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.findTask"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">findTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.findConstVal?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">findConstVal?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.find?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">find?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.enableRealizationsForConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">enableRealizationsForConst</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.dbgFormatAsyncState"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">dbgFormatAsyncState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.dbgFormatCheckedSyncState"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">dbgFormatCheckedSyncState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.PromiseCheckedResult"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">PromiseCheckedResult</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.realizingStack"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">realizingStack</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.promiseChecked"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">promiseChecked</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.PromiseCheckedResult.commitChecked"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">PromiseCheckedResult</span>.<span class="name">commitChecked</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.instNonemptyConstPromiseVal"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">instNonemptyConstPromiseVal</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.AddConstAsyncResult"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.addConstAsync"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addConstAsync</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.AddConstAsyncResult.commitSignature"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span>.<span class="name">commitSignature</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.AddConstAsyncResult.commitConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span>.<span class="name">commitConst</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.AddConstAsyncResult.commitCheckEnv"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span>.<span class="name">commitCheckEnv</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.contains"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">contains</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.containsOnBranch"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">containsOnBranch</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.header"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">header</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.imports"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">imports</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.allImportedModuleNames"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">allImportedModuleNames</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.setMainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">setMainModule</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.mainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">mainModule</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getModuleIdxFor?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdxFor?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isImportedConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isImportedConst</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isConstructor"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isConstructor</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.isSafeDefinition"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isSafeDefinition</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.getModuleIdx?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdx?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantVal.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">ConstantVal</span>.<span class="name">instantiateTypeLevelParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantInfo.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateTypeLevelParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ConstantInfo.instantiateValueLevelParams!"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateValueLevelParams!</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.AsyncMode"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">AsyncMode</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.instInhabitedAsyncMode"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">instInhabitedAsyncMode</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ReplayFn"><span class="name">Lean</span>.<span class="name">ReplayFn</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension"><span class="name">Lean</span>.<span class="name">EnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedEnvExtension"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.ensureExtensionsArraySize"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">ensureExtensionsArraySize</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.ensureExtensionsArraySize.loop"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">ensureExtensionsArraySize</span>.<span class="name">loop</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.mkInitialExtStates"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">mkInitialExtStates</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">modifyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.setState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">setState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.getState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">getState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.EnvExtension.findStateAsync"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">findStateAsync</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerEnvExtension"><span class="name">Lean</span>.<span class="name">registerEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkEmptyEnvironment"><span class="name">Lean</span>.<span class="name">mkEmptyEnvironment</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM.Context"><span class="name">Lean</span>.<span class="name">ImportM</span>.<span class="name">Context</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportM"><span class="name">Lean</span>.<span class="name">ImportM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedPersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtensionState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instInhabitedPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.getModuleEntries"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getModuleEntries</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.addEntry"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">addEntry</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.getState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.setState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">setState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">modifyState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtension.findStateAsync"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">findStateAsync</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.persistentEnvExtensionsRef"><span class="name">Lean</span>.<span class="name">persistentEnvExtensionsRef</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.PersistentEnvExtensionDescr"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionDescr</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerPersistentEnvExtensionUnsafe"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtensionUnsafe</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.registerPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtension</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.saveModuleDataParts"><span class="name">Lean</span>.<span class="name">saveModuleDataParts</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.readModuleDataParts"><span class="name">Lean</span>.<span class="name">readModuleDataParts</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.saveModuleData"><span class="name">Lean</span>.<span class="name">saveModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.readModuleData"><span class="name">Lean</span>.<span class="name">readModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.freeRegions"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">freeRegions</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.OLeanLevel"><span class="name">Lean</span>.<span class="name">OLeanLevel</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instDecidableEqOLeanLevel"><span class="name">Lean</span>.<span class="name">instDecidableEqOLeanLevel</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.OLeanLevel.adjustFileName"><span class="name">Lean</span>.<span class="name">OLeanLevel</span>.<span class="name">adjustFileName</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkModuleData"><span class="name">Lean</span>.<span class="name">mkModuleData</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.writeModule"><span class="name">Lean</span>.<span class="name">writeModule</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkExtNameMap"><span class="name">Lean</span>.<span class="name">mkExtNameMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.updateEnvAttributes"><span class="name">Lean</span>.<span class="name">updateEnvAttributes</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.getNumBuiltinAttributes"><span class="name">Lean</span>.<span class="name">getNumBuiltinAttributes</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportState"><span class="name">Lean</span>.<span class="name">ImportState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.throwAlreadyImported"><span class="name">Lean</span>.<span class="name">throwAlreadyImported</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportStateM"><span class="name">Lean</span>.<span class="name">ImportStateM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.ImportStateM.run"><span class="name">Lean</span>.<span class="name">ImportStateM</span>.<span class="name">run</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.importModulesCore"><span class="name">Lean</span>.<span class="name">importModulesCore</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.importModulesCore.go"><span class="name">Lean</span>.<span class="name">importModulesCore</span>.<span class="name">go</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.finalizeImport"><span class="name">Lean</span>.<span class="name">finalizeImport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.importModules"><span class="name">Lean</span>.<span class="name">importModules</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.withImportModules"><span class="name">Lean</span>.<span class="name">withImportModules</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.enableDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">enableDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDiagnosticsEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.resetDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">resetDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.getDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">getDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.setDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">setDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.displayStats"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">displayStats</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.evalConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConst</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.replayConsts"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">replayConsts</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.replayConsts.replayKernel"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">replayConsts</span>.<span class="name">replayKernel</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.evalConstCheck"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConstCheck</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.hasUnsafe"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">hasUnsafe</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Environment.realizeConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">realizeConst</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDefEq"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEq</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.isDefEqGuarded"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEqGuarded</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.whnf"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">whnf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Kernel.check"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">check</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.MonadEnv"><span class="name">Lean</span>.<span class="name">MonadEnv</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.instMonadEnvOfMonadLift"><span class="name">Lean</span>.<span class="name">instMonadEnvOfMonadLift</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.withExporting"><span class="name">Lean</span>.<span class="name">withExporting</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.withoutExporting"><span class="name">Lean</span>.<span class="name">withoutExporting</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.mkDefinitionValInferrringUnsafe"><span class="name">Lean</span>.<span class="name">mkDefinitionValInferrringUnsafe</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.getMaxHeight"><span class="name">Lean</span>.<span class="name">getMaxHeight</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="Note-Environment-Branches">Note [Environment Branches] <a class="hover-link" href="#Note-Environment-Branches">#</a></h1><p>The kernel environment type <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a></code> enforces a linear order on the addition of
declarations: <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment.addDeclCore">addDeclCore</a></code> takes an environment and returns a new one, assuming type checking
succeeded. On the other hand, the metaprogramming-level <code><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></code> wrapper must allow for
<em>branching</em> environment transformations so that multiple declarations can be elaborated
concurrently while still being able to access information about preceding declarations that have
also been branched out as soon as they are available.</p><p>The basic function to introduce such branches is <code><a href=".././Lean/Environment.html#Lean.Environment.addConstAsync">addConstAsync</a></code>, which takes an environment and
returns a structure containing two environments: one for the &quot;main&quot; branch that can be used in
further branching and eventually contains all the declarations of the file and one for the &quot;async&quot;
branch that can be used concurrently to the main branch to elaborate and add the declaration for
which the branch was introduced. Branches are &quot;joined&quot; back together implicitly via the kernel
environment, which as mentioned cannot be changed concurrently: when the main branch first tries to
access it, evaluation is blocked until the kernel environment on the async branch is complete.
Thus adding two declarations A and B concurrently can be visualized like this:</p><pre><code class="language-text">o addConstAsync A
|\
| \
|  \
o addConstAsync B
|\   \
| \   o elaborate A
|  \  |
|   o elaborate B
|   | |
|   | o addDeclCore A
|   |/
|   o addDeclCore B
|  /
| /
|/
o .olean serialization calls Environment.toKernelEnv
</code></pre><p>While each edge represents a <code><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></code> that has its own view of the state of the module,
the kernel environment really lives only in the right-most path, with all other paths merely holding
an unfulfilled <code><a href=".././Init/Core.html#Task">Task</a></code> representing it and where forcing that task leads to the back-edges joining
paths back together.</p></div><div class="decl" id="Lean.debug.skipKernelTC"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L69-L73">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.debug.skipKernelTC"><span class="name">Lean</span>.<span class="name">debug</span>.<span class="name">skipKernelTC</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.EnvExtensionStateSpec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L75-L76">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec"><span class="name">Lean</span>.<span class="name">EnvExtensionStateSpec</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>) × <span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">α</span></span></span></div></div><p>Opaque environment extension state.</p></div></div><div class="decl" id="Lean.EnvExtensionState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L77-L77">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionState"><span class="name">Lean</span>.<span class="name">EnvExtensionState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a>.<a href=".././Init/Core.html#Sigma.fst">fst</a></span></li></ul></details><details id="instances-for-list-Lean.EnvExtensionState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvExtensionState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L78-L78">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtensionState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedEnvExtensionState">Lean.instInhabitedEnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionStateSpec">Lean.EnvExtensionStateSpec</a>.<a href=".././Init/Core.html#Sigma.snd">snd</a></span></li></ul></details></div></div><div class="decl" id="Lean.ModuleIdx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L80-L81">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleIdx"><span class="name">Lean</span>.<span class="name">ModuleIdx</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Nat">Nat</a></li></ul></details><details id="instances-for-list-Lean.ModuleIdx" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instModuleIdxBEq"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L81-L81">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instModuleIdxBEq"><span class="name">Lean</span>.<span class="name">instModuleIdxBEq</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#BEq">BEq</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instModuleIdxBEq">Lean.instModuleIdxBEq</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#instBEqOfDecidableEq">instBEqOfDecidableEq</a></li></ul></details></div></div><div class="decl" id="Lean.instModuleIdxToString"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L81-L81">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instModuleIdxToString"><span class="name">Lean</span>.<span class="name">instModuleIdxToString</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString">ToString</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instModuleIdxToString">Lean.instModuleIdxToString</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Data/ToString/Basic.html#instToStringNat">instToStringNat</a></li></ul></details></div></div><div class="decl" id="Lean.ModuleIdx.toNat"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L83-L83">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleIdx.toNat"><span class="name">Lean</span>.<span class="name">ModuleIdx</span>.<span class="name">toNat</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">midx</span> : <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Nat">Nat</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">midx</span>.<a href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">toNat</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">midx</span></li></ul></details><details id="instances-for-list-Lean.ModuleIdx.toNat" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedModuleIdx"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L85-L85">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedModuleIdx"><span class="name">Lean</span>.<span class="name">instInhabitedModuleIdx</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedModuleIdx">Lean.instInhabitedModuleIdx</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <span class="fn">0</span> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instGetElemArrayModuleIdxLtNatToNatSize"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L87-L88">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instGetElemArrayModuleIdxLtNatToNatSize"><span class="name">Lean</span>.<span class="name">instGetElemArrayModuleIdxLtNatToNatSize</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/GetElem.html#GetElem">GetElem</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a> <span class="fn">α</span> <span class="fn">fun (<span class="fn">a</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>) (<span class="fn">i</span> : <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a>) =&gt; <span class="fn"><span class="fn">i</span>.<a href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">toNat</a></span> <a href=".././Init/Prelude.html#LT.lt">&lt;</a> <span class="fn"><span class="fn">a</span>.<a href=".././Init/Prelude.html#Array.size">size</a></span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instGetElemArrayModuleIdxLtNatToNatSize">Lean.instGetElemArrayModuleIdxLtNatToNatSize</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Init/GetElem.html#GetElem.mk">{</a> <span class="fn">getElem</span> := <span class="fn">fun (<span class="fn">a</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>) (<span class="fn">i</span> : <a href=".././Lean/Environment.html#Lean.ModuleIdx">Lean.ModuleIdx</a>) (<span class="fn">h</span> : <span class="fn"><span class="fn">i</span>.<a href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">toNat</a></span> <a href=".././Init/Prelude.html#LT.lt">&lt;</a> <span class="fn"><span class="fn">a</span>.<a href=".././Init/Prelude.html#Array.size">size</a></span>) =&gt; <span class="fn">a</span><a href=".././Init/GetElem.html#GetElem.getElem">[</a><span class="fn"><span class="fn">i</span>.<a href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">toNat</a></span><a href=".././Init/GetElem.html#GetElem.getElem">]</a></span> <a href=".././Init/GetElem.html#GetElem.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instGetElem?ArrayModuleIdxLtNatToNatSize"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L90-L92">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instGetElem?ArrayModuleIdxLtNatToNatSize"><span class="name">Lean</span>.<span class="name">instGetElem?ArrayModuleIdxLtNatToNatSize</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/GetElem.html#GetElem?">GetElem?</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a> <span class="fn">α</span> <span class="fn">fun (<span class="fn">a</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span>) (<span class="fn">i</span> : <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a>) =&gt; <span class="fn"><span class="fn">i</span>.<a href=".././Lean/Environment.html#Lean.ModuleIdx.toNat">toNat</a></span> <a href=".././Init/Prelude.html#LT.lt">&lt;</a> <span class="fn"><span class="fn">a</span>.<a href=".././Init/Prelude.html#Array.size">size</a></span></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.ConstMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L94-L94">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstMap"><span class="name">Lean</span>.<span class="name">ConstMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.ConstMap">Lean.ConstMap</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap">Lean.SMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">Lean.ConstantInfo</a></span></li></ul></details><details id="instances-for-list-Lean.ConstMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Import"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L96-L102">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Import"><span class="name">Lean</span>.<span class="name">Import</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Import.mk"><li id="Lean.Import.module" class="structure_field"><div class="structure_field_info">module : <a href=".././Init/Prelude.html#Lean.Name">Name</a></div></li><li id="Lean.Import.importAll" class="structure_field"><div class="structure_field_info">importAll : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p><code>import all</code>; whether to import and expose all data saved by the module.</p></div></li><li id="Lean.Import.isExported" class="structure_field"><div class="structure_field_info">isExported : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>Whether to activate this import when the current module itself is imported.</p></div></li></ul><details id="instances-for-list-Lean.Import" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instReprImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L102-L102">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instReprImport"><span class="name">Lean</span>.<span class="name">instReprImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/Repr.html#Repr">Repr</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instReprImport">Lean.instReprImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Data/Repr.html#Repr.mk">{</a> <span class="fn">reprPrec</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.reprImport._@.Lean.Environment._hyg.237">Lean.reprImport✝</a> <a href=".././Init/Data/Repr.html#Repr.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L102-L102">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedImport"><span class="name">Lean</span>.<span class="name">instInhabitedImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedImport">Lean.instInhabitedImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#Lean.Import.mk">{</a> <span class="fn">module</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">importAll</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">isExported</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#Lean.Import.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instCoeNameImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L104-L104">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instCoeNameImport"><span class="name">Lean</span>.<span class="name">instCoeNameImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Coe.html#Coe">Coe</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instCoeNameImport">Lean.instCoeNameImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Coe.html#Coe.mk">{</a> <span class="fn">coe</span> := <span class="fn">fun (<span class="fn">x</span> : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>) =&gt; <a href=".././Lean/Environment.html#Lean.Import.mk">{</a> <span class="fn">module</span> := <span class="fn">x</span> <a href=".././Lean/Environment.html#Lean.Import.mk">}</a></span> <a href=".././Init/Coe.html#Coe.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instToStringImport"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L106-L106">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instToStringImport"><span class="name">Lean</span>.<span class="name">instToStringImport</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString">ToString</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instToStringImport">Lean.instToStringImport</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Data/ToString/Basic.html#ToString.mk">{</a> <span class="fn">toString</span> := <span class="fn">fun (<span class="fn">imp</span> : <a href=".././Lean/Environment.html#Lean.Import">Lean.Import</a>) =&gt; <span class="fn"><a href=".././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn"><span class="fn">imp</span>.<a href=".././Lean/Environment.html#Lean.Import.module">module</a></span></span></span> <a href=".././Init/Data/ToString/Basic.html#ToString.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.CompactedRegion"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L108-L112">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion"><span class="name">Lean</span>.<span class="name">CompactedRegion</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>A compacted region holds multiple Lean objects in a contiguous memory region, which can be read/written to/from disk.
Objects inside the region do not have reference counters and cannot be freed individually. The contents of .olean
files are compacted regions.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.CompactedRegion">Lean.CompactedRegion</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#USize">USize</a></li></ul></details><details id="instances-for-list-Lean.CompactedRegion" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.CompactedRegion.isMemoryMapped"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L114-L115">source</a></div><div class="attributes">@[extern  lean_compacted_region_is_memory_mapped]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion.isMemoryMapped"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">isMemoryMapped</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">CompactedRegion</a> → <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.CompactedRegion.free"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L117-L119">source</a></div><div class="attributes">@[extern  lean_compacted_region_free]</div>
<div class="decl_header"><span class="decl_kind">unsafe opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.CompactedRegion.free"><span class="name">Lean</span>.<span class="name">CompactedRegion</span>.<span class="name">free</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.CompactedRegion">CompactedRegion</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></div><p>Free a compacted region and its contents. No live references to the contents may exist at the time of invocation.</p></div></div><div class="decl" id="Lean.EnvExtensionEntrySpec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L121-L122">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionEntrySpec"><span class="name">Lean</span>.<span class="name">EnvExtensionEntrySpec</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#NonemptyType">NonemptyType</a></div></div><p>Opaque persistent environment extension entry.</p></div></div><div class="decl" id="Lean.EnvExtensionEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L123-L123">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtensionEntry"><span class="name">Lean</span>.<span class="name">EnvExtensionEntry</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">Lean.EnvExtensionEntry</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtensionEntrySpec">Lean.EnvExtensionEntrySpec</a>.<a href=".././Init/Prelude.html#NonemptyType.type">type</a></span></li></ul></details><details id="instances-for-list-Lean.EnvExtensionEntry" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvExtensionEntry"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L124-L124">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvExtensionEntry"><span class="name">Lean</span>.<span class="name">instNonemptyEnvExtensionEntry</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">EnvExtensionEntry</a></span></div></div></div></div><div class="decl" id="Lean.ModuleData"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L126-L147">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ModuleData"><span class="name">Lean</span>.<span class="name">ModuleData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Content of a .olean file.
We use <code>compact.cpp</code> to generate the image of this object in disk.</p><ul class="structure_fields" id="Lean.ModuleData.mk"><li id="Lean.ModuleData.isModule" class="structure_field"><div class="structure_field_info">isModule : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>Participating in the module system?</p></div></li><li id="Lean.ModuleData.imports" class="structure_field"><div class="structure_field_info">imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div></li><li id="Lean.ModuleData.constNames" class="structure_field"><div class="structure_field_info">constNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div><div class="structure_field_doc"><p><code><a href=".././Lean/Environment.html#Lean.ModuleData.constNames">constNames</a></code> contains all constant names in <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>.
This information is redundant. It is equal to <code>constants.map fun c =&gt; c.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.name">name</a></code>,
but it improves the performance of <code><a href=".././Lean/Environment.html#Lean.importModules">importModules</a></code>. <code>perf</code> reports that 12% of the
runtime was being spent on <code>ConstantInfo.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.name">name</a></code> when importing a file containing only <code>import <a href=".././Lean.html">Lean</a></code></p></div></li><li id="Lean.ModuleData.constants" class="structure_field"><div class="structure_field_info">constants : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a></span></div></li><li id="Lean.ModuleData.extraConstNames" class="structure_field"><div class="structure_field_info">extraConstNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div><div class="structure_field_doc"><p>Extra entries for the <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment.const2ModIdx">const2ModIdx</a></code> map in the <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></code> object.
The code generator creates auxiliary declarations that are not in the
mapping <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>, but we want to know in which module they were generated.</p></div></li><li id="Lean.ModuleData.entries" class="structure_field"><div class="structure_field_info">entries : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">EnvExtensionEntry</a></span>)</span></div></li></ul><details id="instances-for-list-Lean.ModuleData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedModuleData"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L147-L147">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedModuleData"><span class="name">Lean</span>.<span class="name">instInhabitedModuleData</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.EnvironmentHeader"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L149-L173">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvironmentHeader"><span class="name">Lean</span>.<span class="name">EnvironmentHeader</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Environment fields that are not used often.</p><ul class="structure_fields" id="Lean.EnvironmentHeader.mk"><li id="Lean.EnvironmentHeader.trustLevel" class="structure_field"><div class="structure_field_info">trustLevel : <a href=".././Init/Prelude.html#UInt32">UInt32</a></div><div class="structure_field_doc"><p>The trust level used by the kernel. For example,
the kernel assumes imported constants are type correct when the trust level is greater than zero.</p></div></li><li id="Lean.EnvironmentHeader.mainModule" class="structure_field"><div class="structure_field_info">mainModule : <a href=".././Init/Prelude.html#Lean.Name">Name</a></div><div class="structure_field_doc"><p>Name of the module being compiled.</p></div></li><li id="Lean.EnvironmentHeader.isModule" class="structure_field"><div class="structure_field_info">isModule : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>Participating in the module system?</p></div></li><li id="Lean.EnvironmentHeader.imports" class="structure_field"><div class="structure_field_info">imports : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div><div class="structure_field_doc"><p>Direct imports</p></div></li><li id="Lean.EnvironmentHeader.regions" class="structure_field"><div class="structure_field_info">regions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">CompactedRegion</a></span></div><div class="structure_field_doc"><p>Compacted regions for all imported modules. Objects in compacted memory regions do no require any memory management.</p></div></li><li id="Lean.EnvironmentHeader.moduleNames" class="structure_field"><div class="structure_field_info">moduleNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div><div class="structure_field_doc"><p>Name of all imported modules (directly and indirectly).
The index of a module name in the array equals the <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code> for the same module.</p></div></li><li id="Lean.EnvironmentHeader.moduleData" class="structure_field"><div class="structure_field_info">moduleData : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a></span></div><div class="structure_field_doc"><p>Module data for all imported modules.</p></div></li></ul><details id="instances-for-list-Lean.EnvironmentHeader" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvironmentHeader"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L173-L173">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvironmentHeader"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironmentHeader</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.EnvironmentHeader">EnvironmentHeader</a></span></div></div></div></div><div class="decl" id="Lean.Kernel.Diagnostics"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L177-L182">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Diagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Diagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Kernel.Diagnostics.mk"><li id="Lean.Kernel.Diagnostics.unfoldCounter" class="structure_field"><div class="structure_field_info">unfoldCounter : <span class="fn"><a href=".././Lean/Data/PersistentHashMap.html#Lean.PHashMap">PHashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div><div class="structure_field_doc"><p>Number of times each declaration has been unfolded by the kernel.</p></div></li><li id="Lean.Kernel.Diagnostics.enabled" class="structure_field"><div class="structure_field_info">enabled : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>If <code><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.enabled">enabled</a> = true</code>, kernel records declarations that have been unfolded.</p></div></li></ul><details id="instances-for-list-Lean.Kernel.Diagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.instInhabitedDiagnostics"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L182-L182">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instInhabitedDiagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.Kernel.instInhabitedDiagnostics">Lean.Kernel.instInhabitedDiagnostics</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.mk">{</a> <span class="fn">unfoldCounter</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">enabled</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L184-L248">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>An environment stores declarations provided by the user. The kernel
currently supports different kinds of declarations such as definitions, theorems,
and inductive families. Each has a unique identifier (i.e., <code>Name</code>), and can be
parameterized by a sequence of universe parameters.
A constant in Lean is just a reference to a <code>ConstantInfo</code> object. The main task of
the kernel is to type check these declarations and refuse type incorrect ones. The
kernel does not allow declarations containing metavariables and/or free variables
to be added to an environment. Environments are never destructively updated.</p><p>The environment also contains a collection of extensions. For example, the <code>simp</code> theorems
declared by users are stored in an environment extension. Users can declare new extensions
using meta-programming.</p><ul class="structure_fields" id="_private.Lean.Environment.0.Lean.Kernel.Environment.mk"><li id="Lean.Kernel.Environment.constants" class="structure_field"><div class="structure_field_info">constants : <a href=".././Lean/Environment.html#Lean.ConstMap">ConstMap</a></div><div class="structure_field_doc"><p>Mapping from constant name to <code>ConstantInfo</code>. It contains all constants (definitions, theorems,
axioms, etc) that have been already type checked by the kernel.</p></div></li><li id="Lean.Kernel.Environment.quotInit" class="structure_field"><div class="structure_field_info">quotInit : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p><code><a href=".././Lean/Environment.html#Lean.Kernel.Environment.quotInit">quotInit</a> = true</code> if the command <code>init_quot</code> has already been executed for the environment, and
<code><a href=".././Init/Prelude.html#Quot">Quot</a></code> declarations have been added to the environment. When the flag is set, the type checker can
assume that the <code><a href=".././Init/Prelude.html#Quot">Quot</a></code> declarations in the environment have indeed been added by the kernel and
not by the user.</p></div></li><li id="Lean.Kernel.Environment.diagnostics" class="structure_field"><div class="structure_field_info">diagnostics : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a></div><div class="structure_field_doc"><p>Diagnostic information collected during kernel execution.</p><p>Remark: We store kernel diagnostic information in an environment field to simplify the interface
with the kernel implemented in C/C++. Thus, we can only track declarations in methods, such as
<code>addDecl</code>, which return a new environment. <code><a href=".././Lean/Environment.html#Lean.Kernel.isDefEq">Kernel.isDefEq</a></code> and <code><a href=".././Lean/Environment.html#Lean.Kernel.whnf">Kernel.whnf</a></code> do not update the
statistics. We claim this is ok since these methods are mainly used for debugging.</p></div></li><li id="Lean.Kernel.Environment.const2ModIdx" class="structure_field"><div class="structure_field_info">const2ModIdx : <span class="fn"><a href=".././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div><div class="structure_field_doc"><p>Mapping from constant name to module (index) where constant has been declared.
Recall that a Lean file has a header where previously compiled modules can be imported.
Each imported module has a unique <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code>.
Many extensions use the <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code> to efficiently retrieve information stored in imported modules.</p><p>Remark: this mapping also contains auxiliary constants, created by the code generator, that are <strong>not</strong> in
the field <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>. These auxiliary constants are invisible to the Lean kernel and elaborator.
Only the code generator uses them.</p></div></li><li id="_private.Lean.Environment.0.Lean.Kernel.Environment.extensions" class="structure_field"><div class="structure_field_info">extensions : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div><div class="structure_field_doc"><p>Environment extensions. It also includes user-defined extensions.</p></div></li><li id="_private.Lean.Environment.0.Lean.Kernel.Environment.extraConstNames" class="structure_field"><div class="structure_field_info">extraConstNames : <a href=".././Lean/Data/NameMap.html#Lean.NameSet">Lean.NameSet</a></div><div class="structure_field_doc"><p>Constant names to be saved in the field <code><a href=".././Lean/Environment.html#Lean.ModuleData.extraConstNames">extraConstNames</a></code> at <code><a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a></code>.
It contains auxiliary declaration names created by the code generator which are not in <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>.
When importing modules, we want to insert them at <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment.const2ModIdx">const2ModIdx</a></code>.</p></div></li><li id="Lean.Kernel.Environment.header" class="structure_field"><div class="structure_field_info">header : <a href=".././Lean/Environment.html#Lean.EnvironmentHeader">EnvironmentHeader</a></div><div class="structure_field_doc"><p>The header contains additional information that is set at import time.</p></div></li></ul><details id="instances-for-list-Lean.Kernel.Environment" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.instNonemptyEnvironment"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L248-L248">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.instNonemptyEnvironment"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instNonemptyEnvironment</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></span></div></div></div></div><div class="decl" id="Lean.Kernel.Exception"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L250-L269">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Exception"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Exception</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Exceptions that can be raised by the kernel when type checking new declarations.</p><ul class="constructors"><li class="constructor" id="Lean.Kernel.Exception.unknownConstant">unknownConstant<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.alreadyDeclared">alreadyDeclared<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.declTypeMismatch">declTypeMismatch<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">decl</span> : <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">givenType</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.declHasMVars">declHasMVars<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">expr</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.declHasFVars">declHasFVars<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">expr</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.funExpected">funExpected<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">expr</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.typeExpected">typeExpected<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">expr</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.letTypeMismatch">letTypeMismatch<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">givenType </span><span class="fn">expectedType</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.exprTypeMismatch">exprTypeMismatch<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">expr </span><span class="fn">expectedType</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.appTypeMismatch">appTypeMismatch<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">app </span><span class="fn">funType </span><span class="fn">argType</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.invalidProj">invalidProj<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">proj</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.thmTypeIsNotProp">thmTypeIsNotProp<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">type</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.other">other<span class="decl_args">
<span class="fn">(<span class="fn">msg</span> : <a href=".././Init/Prelude.html#String">String</a>)</span></span>
 : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.deterministicTimeout">deterministicTimeout : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.excessiveMemory">excessiveMemory : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.deepRecursion">deepRecursion : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li><li class="constructor" id="Lean.Kernel.Exception.interrupted">interrupted : <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></li></ul><details id="instances-for-list-Lean.Kernel.Exception" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.instNonemptyException"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L269-L269">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.instNonemptyException"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">instNonemptyException</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a></span></div></div></div></div><div class="decl" id="Lean.Kernel.Environment.find?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L273-L276">source</a></div><div class="attributes">@[export lean_environment_find]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.find?"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">find?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.find?">find?</a></span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap.find?'">Lean.SMap.find?'</a> <span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.constants">constants</a></span> <span class="fn">n</span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.find?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.addDeclCore"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L286-L289">source</a></div><div class="attributes">@[extern  lean_add_decl]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.addDeclCore"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">addDeclCore</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">maxHeartbeats</span> : <a href=".././Init/Prelude.html#USize">USize</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">decl</span> : <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></span></div></div><p>Type check given declaration and add it to the environment</p></div></div><div class="decl" id="Lean.Kernel.Environment.addDeclWithoutChecking"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L291-L299">source</a></div><div class="attributes">@[extern  lean_add_decl_without_checking]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.addDeclWithoutChecking"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">addDeclWithoutChecking</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">decl</span> : <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></span></div></div><p>Add declaration to kernel without type checking it.</p><p><strong>WARNING</strong> This function is meant for temporarily working around kernel performance issues.
It compromises soundness because, for example, a buggy tactic may produce an invalid proof,
and the kernel will not catch it if the new option is set to true.</p></div></div><div class="decl" id="Lean.Kernel.Environment.Diagnostics.isEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L305-L307">source</a></div><div class="attributes">@[export lean_kernel_diag_is_enabled]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.Diagnostics.isEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">Diagnostics</span>.<span class="name">isEnabled</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">d</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.Environment.Diagnostics.isEnabled">Lean.Kernel.Environment.Diagnostics.isEnabled</a> <span class="fn">d</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">d</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.enabled">enabled</a></span></li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.Diagnostics.isEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.enableDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L309-L311">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.enableDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">enableDiag</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">flag</span> : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></div></div><p>Enables/disables kernel diagnostics.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.enableDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.isDiagnosticsEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L313-L314">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">isDiagnosticsEnabled</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.isDiagnosticsEnabled">isDiagnosticsEnabled</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.diagnostics">diagnostics</a></span>.<a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics.enabled">enabled</a></span></li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.isDiagnosticsEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.resetDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L316-L317">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.resetDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">resetDiag</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.resetDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.Diagnostics.recordUnfold"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L319-L325">source</a></div><div class="attributes">@[export lean_kernel_record_unfold]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.Diagnostics.recordUnfold"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">Diagnostics</span>.<span class="name">recordUnfold</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">d</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.Diagnostics.recordUnfold" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.getDiagnostics"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L327-L329">source</a></div><div class="attributes">@[export lean_kernel_get_diag]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.getDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">getDiagnostics</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.getDiagnostics">getDiagnostics</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.diagnostics">diagnostics</a></span></li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.getDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.Environment.setDiagnostics"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L331-L333">source</a></div><div class="attributes">@[export lean_kernel_set_diag]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.Environment.setDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">Environment</span>.<span class="name">setDiagnostics</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">diag</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Kernel.Environment.setDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.KernelException"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L337-L338">source</a></div><div class="attributes">@[reducible, inline, deprecated Lean.Kernel.Exception (since := &quot;2024-12-12&quot;)]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.KernelException"><span class="name">Lean</span>.<span class="name">KernelException</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.KernelException">Lean.KernelException</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Lean.Kernel.Exception</a></li></ul></details><details id="instances-for-list-Lean.KernelException" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ConstantKind"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L340-L342">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantKind"><span class="name">Lean</span>.<span class="name">ConstantKind</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Lean.ConstantKind.defn">defn : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.thm">thm : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.axiom">axiom : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.opaque">opaque : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.quot">quot : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.induct">induct : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.ctor">ctor : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li><li class="constructor" id="Lean.ConstantKind.recursor">recursor : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></li></ul><details id="instances-for-list-Lean.ConstantKind" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedConstantKind"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L342-L342">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedConstantKind"><span class="name">Lean</span>.<span class="name">instInhabitedConstantKind</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedConstantKind">Lean.instInhabitedConstantKind</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#Lean.ConstantKind.defn">Lean.ConstantKind.defn</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instBEqConstantKind"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L342-L342">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instBEqConstantKind"><span class="name">Lean</span>.<span class="name">instBEqConstantKind</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#BEq">BEq</a> <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instBEqConstantKind">Lean.instBEqConstantKind</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#BEq.mk">{</a> <span class="fn">beq</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.beqConstantKind._@.Lean.Environment._hyg.1378">Lean.beqConstantKind✝</a> <a href=".././Init/Prelude.html#BEq.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instReprConstantKind"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L342-L342">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instReprConstantKind"><span class="name">Lean</span>.<span class="name">instReprConstantKind</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Data/Repr.html#Repr">Repr</a> <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instReprConstantKind">Lean.instReprConstantKind</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Data/Repr.html#Repr.mk">{</a> <span class="fn">reprPrec</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.reprConstantKind._@.Lean.Environment._hyg.1396">Lean.reprConstantKind✝</a> <a href=".././Init/Data/Repr.html#Repr.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.ConstantKind.ofConstantInfo"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L344-L352">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo"><span class="name">Lean</span>.<span class="name">ConstantKind</span>.<span class="name">ofConstantInfo</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a> → <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.defnInfo">Lean.ConstantInfo.defnInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.defn">Lean.ConstantKind.defn</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.thmInfo">Lean.ConstantInfo.thmInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.thm">Lean.ConstantKind.thm</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.axiomInfo">Lean.ConstantInfo.axiomInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.axiom">Lean.ConstantKind.axiom</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.opaqueInfo">Lean.ConstantInfo.opaqueInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.opaque">Lean.ConstantKind.opaque</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.quotInfo">Lean.ConstantInfo.quotInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.quot">Lean.ConstantKind.quot</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.inductInfo">Lean.ConstantInfo.inductInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.induct">Lean.ConstantKind.induct</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.ctorInfo">Lean.ConstantInfo.ctorInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.ctor">Lean.ConstantKind.ctor</a></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">(<a href=".././Lean/Declaration.html#Lean.ConstantInfo.recInfo">Lean.ConstantInfo.recInfo</a> <span class="fn">val</span>)</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.recursor">Lean.ConstantKind.recursor</a></li></ul></details><details id="instances-for-list-Lean.ConstantKind.ofConstantInfo" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.AsyncConstantInfo"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L354-L364">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.AsyncConstantInfo"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p><code>ConstantInfo</code> variant that allows for asynchronous filling of components via tasks.</p><ul class="structure_fields" id="Lean.AsyncConstantInfo.mk"><li id="Lean.AsyncConstantInfo.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Name</a></div><div class="structure_field_doc"><p>The declaration name, known immediately.</p></div></li><li id="Lean.AsyncConstantInfo.kind" class="structure_field"><div class="structure_field_info">kind : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a></div><div class="structure_field_doc"><p>The kind of the constant, known immediately.</p></div></li><li id="Lean.AsyncConstantInfo.sig" class="structure_field"><div class="structure_field_info">sig : <span class="fn"><a href=".././Init/Core.html#Task">Task</a> <a href=".././Lean/Declaration.html#Lean.ConstantVal">ConstantVal</a></span></div><div class="structure_field_doc"><p>The &quot;signature&quot; including level params and type, potentially filled asynchronously.</p></div></li><li id="Lean.AsyncConstantInfo.constInfo" class="structure_field"><div class="structure_field_info">constInfo : <span class="fn"><a href=".././Init/Core.html#Task">Task</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a></span></div><div class="structure_field_doc"><p>The final, complete constant info, potentially filled asynchronously.</p></div></li></ul><details id="instances-for-list-Lean.AsyncConstantInfo" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedAsyncConstantInfo"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L364-L364">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedAsyncConstantInfo"><span class="name">Lean</span>.<span class="name">instInhabitedAsyncConstantInfo</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedAsyncConstantInfo">Lean.instInhabitedAsyncConstantInfo</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.mk">{</a> <span class="fn">name</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">kind</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">sig</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">constInfo</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.AsyncConstantInfo.toConstantVal"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L368-L369">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.AsyncConstantInfo.toConstantVal"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">toConstantVal</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Declaration.html#Lean.ConstantVal">ConstantVal</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.toConstantVal">toConstantVal</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.sig">sig</a></span>.<a href=".././Init/Core.html#Task.get">get</a></span></li></ul></details><details id="instances-for-list-Lean.AsyncConstantInfo.toConstantVal" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.AsyncConstantInfo.toConstantInfo"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L371-L372">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.AsyncConstantInfo.toConstantInfo"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">toConstantInfo</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.toConstantInfo">toConstantInfo</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.constInfo">constInfo</a></span>.<a href=".././Init/Core.html#Task.get">get</a></span></li></ul></details><details id="instances-for-list-Lean.AsyncConstantInfo.toConstantInfo" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.AsyncConstantInfo.ofConstantInfo"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L374-L378">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.AsyncConstantInfo.ofConstantInfo"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">ofConstantInfo</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.ofConstantInfo">Lean.AsyncConstantInfo.ofConstantInfo</a> <span class="fn">c</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.mk">{</a> <span class="fn">name</span> := <span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantInfo.name">name</a></span>, <span class="fn">kind</span> := <span class="fn"><a href=".././Lean/Environment.html#Lean.ConstantKind.ofConstantInfo">Lean.ConstantKind.ofConstantInfo</a> <span class="fn">c</span></span>, <span class="fn">sig</span> := <a href=".././Init/Core.html#Task.pure">{</a> <span class="fn">get</span> := <span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantInfo.toConstantVal">toConstantVal</a></span> <a href=".././Init/Core.html#Task.pure">}</a>,
    <span class="fn">constInfo</span> := <a href=".././Init/Core.html#Task.pure">{</a> <span class="fn">get</span> := <span class="fn">c</span> <a href=".././Init/Core.html#Task.pure">}</a> <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.mk">}</a></li></ul></details><details id="instances-for-list-Lean.AsyncConstantInfo.ofConstantInfo" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.AsyncConstantInfo.isUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L380-L383">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.AsyncConstantInfo.isUnsafe"><span class="name">Lean</span>.<span class="name">AsyncConstantInfo</span>.<span class="name">isUnsafe</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.isUnsafe">isUnsafe</a></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.kind">kind</a></span> with
  | <a href=".././Lean/Environment.html#Lean.ConstantKind.thm">Lean.ConstantKind.thm</a> =&gt; <a href=".././Init/Prelude.html#Bool.false">false</a>
  | <span class="fn">x</span> =&gt; <span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.toConstantInfo">toConstantInfo</a></span>.<a href=".././Lean/Declaration.html#Lean.ConstantInfo.isUnsafe">isUnsafe</a></span></span></li></ul></details><details id="instances-for-list-Lean.AsyncConstantInfo.isUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyAsyncContext"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L404-L404">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyAsyncContext"><span class="name">Lean</span>.<span class="name">instNonemptyAsyncContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext">Lean.AsyncContext✝</a></span></div></div></div></div><div class="decl" id="Lean.instInhabitedAsyncConsts"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L437-L437">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedAsyncConsts"><span class="name">Lean</span>.<span class="name">instInhabitedAsyncConsts</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConsts">Lean.AsyncConsts✝</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedAsyncConsts">Lean.instInhabitedAsyncConsts</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConsts.mk">{</a> <span class="fn">size</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">revList</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">map</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">normalizedTrie</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConsts.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instTypeNameAsyncConsts"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L437-L437">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instTypeNameAsyncConsts"><span class="name">Lean</span>.<span class="name">instTypeNameAsyncConsts</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Dynamic.html#TypeName">TypeName</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConsts">Lean.AsyncConsts✝</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instTypeNameAsyncConsts">Lean.instTypeNameAsyncConsts</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#Lean.inst._@.Lean.Environment._hyg.2021">Lean.inst✝</a></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedVisibilityMap"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L491-L491">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedVisibilityMap"><span class="name">Lean</span>.<span class="name">instInhabitedVisibilityMap</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">a✝</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">a✝</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap">Lean.VisibilityMap✝</a> <span class="fn">a✝</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedVisibilityMap">Lean.instInhabitedVisibilityMap</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.mk">{</a> <span class="fn">«private»</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">public</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instNonemptyVisibilityMap"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L491-L491">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyVisibilityMap"><span class="name">Lean</span>.<span class="name">instNonemptyVisibilityMap</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α✝</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">α✝</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap">Lean.VisibilityMap✝</a> <span class="fn">α✝</span>)</span></span></div></div></div></div><div class="decl" id="Lean.instNonemptyRealizationResult"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L498-L498">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyRealizationResult"><span class="name">Lean</span>.<span class="name">instNonemptyRealizationResult</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.RealizationResult">Lean.RealizationResult✝</a></span></div></div></div></div><div class="decl" id="Lean.Environment"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L516-L582">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment"><span class="name">Lean</span>.<span class="name">Environment</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Elaboration-specific extension of <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Kernel.Environment</a></code> that adds tracking of asynchronously
elaborated declarations.</p><ul class="structure_fields" id="_private.Lean.Environment.0.Lean.Environment.mk"><li id="_private.Lean.Environment.0.Lean.Environment.base" class="structure_field"><div class="structure_field_info">base : <span class="fn"><a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap">Lean.VisibilityMap✝</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a></span></div><div class="structure_field_doc"><p>Kernel environments containing imported constants. Also stores environment extension state for the
current branch of the environment (in <code><a href=".././Lean/Environment.html#Lean.OLeanLevel.private">private</a></code>). Any other data should be considered
indeterminate.</p><p>As <code>base</code> is eagerly available, we prefer taking information from it instead of <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code> whenever
possible.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.serverBaseExts" class="structure_field"><div class="structure_field_info">serverBaseExts : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span></div><div class="structure_field_doc"><p>Additional imported environment extension state for use in the language server. This field is
identical to <code>base.extensions</code> in other contexts. Access via
<code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">getModuleEntries</a> (includeServer := true)</code>.</p></div></li><li id="Lean.Environment.checked" class="structure_field"><div class="structure_field_info">checked : <span class="fn"><a href=".././Init/Core.html#Task">Task</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Kernel.Environment</a></span></div><div class="structure_field_doc"><p>Kernel environment task that is fulfilled when all asynchronously elaborated declarations are
finished, containing the resulting environment. Also collects the environment extension state of
all environment branches that contributed contained declarations.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.asyncConstsMap" class="structure_field"><div class="structure_field_info">asyncConstsMap : <span class="fn"><a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap">Lean.VisibilityMap✝</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConsts">Lean.AsyncConsts✝</a></span></div><div class="structure_field_doc"><p>Container of asynchronously elaborated declarations. For consistency, <code><a href=".././Lean/AddDecl.html#Lean.addDecl">Lean.addDecl</a></code> makes sure
this contains constants added even synchronously, i.e. <code>base ⨃ asyncConsts</code> is the set of
constants known on the current environment branch, which is a subset of <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code>.</p><p>Private view should correspond to kernel map. Public view may contain fewer constants and less
data per constant.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.asyncCtx?" class="structure_field"><div class="structure_field_info">asyncCtx? : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext">Lean.AsyncContext✝</a></span></div><div class="structure_field_doc"><p>Information about this asynchronous branch of the environment, if any.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.realizedImportedConsts?" class="structure_field"><div class="structure_field_info">realizedImportedConsts? : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.RealizationContext">Lean.RealizationContext✝</a></span></div><div class="structure_field_doc"><p>Realized constants belonging to imported declarations. Must be initialized by calling
<code>enableRealizationsForImports</code>.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.realizedLocalConsts" class="structure_field"><div class="structure_field_info">realizedLocalConsts : <span class="fn"><a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lean.NameMap</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.RealizationContext">Lean.RealizationContext✝</a></span></div><div class="structure_field_doc"><p>Realized constants belonging to local declarations. This is a map from local declarations, which
need to be registered synchronously using <code><a href=".././Lean/Environment.html#Lean.Environment.enableRealizationsForConst">enableRealizationsForConst</a></code>, to their realization
context incl. a ref of realized constants.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.allRealizations" class="structure_field"><div class="structure_field_info">allRealizations : <span class="fn"><a href=".././Init/Core.html#Task">Task</a> <span class="fn">(<a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lean.NameMap</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConst">Lean.AsyncConst✝</a>)</span></span></div><div class="structure_field_doc"><p>Task collecting all realizations from the current and already-forked environment branches, akin to
how <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code> collects all declarations. We only use it as a fallback in
<code>findAsyncCore?</code>/<code><a href=".././Lean/Environment.html#Lean.EnvExtension.findStateAsync">findStateAsync</a></code>; see there.</p></div></li><li id="Lean.Environment.isExporting" class="structure_field"><div class="structure_field_info">isExporting : <a href=".././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>Indicates whether the environment is being used in an exported context, i.e. whether it should
provide access to only the data to be imported by other modules participating in the module
system.</p></div></li></ul><details id="instances-for-list-Lean.Environment" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instNonemptyEnvironment"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L582-L582">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instNonemptyEnvironment"><span class="name">Lean</span>.<span class="name">instNonemptyEnvironment</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div></div></div><div class="decl" id="Lean.Environment.ofKernelEnv"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L601-L603">source</a></div><div class="attributes">@[export lean_elab_environment_of_kernel_env]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.ofKernelEnv"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">ofKernelEnv</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Kernel.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.ofKernelEnv">Lean.Environment.ofKernelEnv</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.mk">{</a> <span class="fn">base</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.mk">{</a> <span class="fn">«private»</span> := <span class="fn">env</span>, <span class="fn">public</span> := <span class="fn">env</span> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.mk">}</a>, <span class="fn">realizedImportedConsts?</span> := <a href=".././Init/Prelude.html#Option.none">none</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Environment.ofKernelEnv" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.toKernelEnv"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L605-L607">source</a></div><div class="attributes">@[export lean_elab_environment_to_kernel_env]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.toKernelEnv"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">toKernelEnv</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Kernel.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.toKernelEnv">toKernelEnv</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></span>.<a href=".././Init/Core.html#Task.get">get</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.toKernelEnv" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.setExporting"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L609-L611">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.setExporting"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">setExporting</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">isExporting</span> : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Updates <code><a href=".././Lean/Environment.html#Lean.Environment.isExporting">Environment.isExporting</a></code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.setExporting" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.asyncPrefix?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L621-L623">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.asyncPrefix?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">asyncPrefix?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div></div><p>The declaration prefix to which the environment is restricted to, if any.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.asyncPrefix?">asyncPrefix?</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#Option.map">Option.map</a> <span class="fn">(fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext">Lean.AsyncContext✝</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext.declPrefix">declPrefix</a></span>)</span> <span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.asyncCtx?">Lean.Environment.asyncCtx?✝</a> <span class="fn">env</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.asyncPrefix?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isRealizing"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L625-L627">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isRealizing"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isRealizing</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>True while inside <code><a href=".././Lean/Environment.html#Lean.Environment.realizeConst">realizeConst</a></code>'s <code>realize</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.isRealizing">isRealizing</a></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Data/Option/Basic.html#Option.any">Option.any</a> <span class="fn">(fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext">Lean.AsyncContext✝</a>) =&gt; <a href=".././Init/Prelude.html#Bool.not">!</a><span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext.realizingStack">realizingStack</a></span>.<a href=".././Init/Data/List/Basic.html#List.isEmpty">isEmpty</a></span>)</span> <span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.asyncCtx?">Lean.Environment.asyncCtx?✝</a> <span class="fn">env</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.isRealizing" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.importEnv?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L629-L635">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.importEnv?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">importEnv?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><p>Returns the environment just after importing. <code>none</code> if <code><a href=".././Lean/Environment.html#Lean.finalizeImport">finalizeImport</a></code> has never been called on
it.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.importEnv?">importEnv?</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment.importEnv?.unsafe_impl_1">Lean.Environment.importEnv?.unsafe_impl_1</a> <span class="fn">env</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.importEnv?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.unlockAsync"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L637-L639">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.unlockAsync"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">unlockAsync</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Forgets about the asynchronous context restrictions. Used only for <code>withoutModifyingEnv</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.unlockAsync" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.asyncMayContain"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L641-L651">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.asyncMayContain"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">asyncMayContain</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Checks whether the given declaration name may potentially added, or have been added, to the current
environment branch, which is the case either if this is the main branch or if the declaration name
is a suffix (modulo privacy and hygiene information) of the top-level declaration name for which
this branch was created.</p><p>This function should always be checked before modifying an <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.async">AsyncMode.async</a></code> environment extension
to ensure <code><a href=".././Lean/Environment.html#Lean.EnvExtension.findStateAsync">findStateAsync</a></code> will be able to find the modification from other branches.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.asyncMayContain">asyncMayContain</a></span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Data/Option/Basic.html#Option.all">Option.all</a> <span class="fn">(fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext">Lean.AsyncContext✝</a>) =&gt; <span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext.mayContain">mayContain</a></span> <span class="fn">declName</span></span>)</span> <span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.asyncCtx?">Lean.Environment.asyncCtx?✝</a> <span class="fn">env</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.asyncMayContain" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.addDeclCore"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L661-L677">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addDeclCore"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addDeclCore</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">maxHeartbeats</span> : <a href=".././Init/Prelude.html#USize">USize</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">decl</span> : <a href=".././Lean/Declaration.html#Lean.Declaration">Declaration</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">doCheck</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Kernel.Exception</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><p>Adds given declaration to the environment, type checking it unless <code>doCheck</code> is false.</p><p>This is a plumbing function for the implementation of <code><a href=".././Lean/AddDecl.html#Lean.addDecl">Lean.addDecl</a></code>, most users should use it
instead.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.addDeclCore" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.constants"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L679-L681">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.constants"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">constants</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.ConstMap">ConstMap</a></div></div><p>Mapping from constant name to <code>ConstantInfo</code>. It contains all constants (definitions, theorems,
axioms, etc) that have been already type checked by the kernel.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.constants">constants</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.toKernelEnv">toKernelEnv</a></span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.constants">constants</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.constants" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.const2ModIdx"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L683-L685">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.const2ModIdx"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">const2ModIdx</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div></div><p>Mapping from constant name to module (index) where constant has been declared.
Recall that a Lean file has a header where previously compiled modules can be imported.
Each imported module has a unique <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code>.
Many extensions use the <code><a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></code> to efficiently retrieve information stored in imported modules.</p><p>Remark: this mapping also contains auxiliary constants, created by the code generator, that are <strong>not</strong> in
the field <code><a href=".././Lean/Environment.html#Lean.ModuleData.constants">constants</a></code>. These auxiliary constants are invisible to the Lean kernel and elaborator.
Only the code generator uses them.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.const2ModIdx">const2ModIdx</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.toKernelEnv">toKernelEnv</a></span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.const2ModIdx">const2ModIdx</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.const2ModIdx" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.addExtraName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L700-L709">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addExtraName"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addExtraName</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Save an extra constant name that is used to populate <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment.const2ModIdx">const2ModIdx</a></code> when we import
.olean files. We use this feature to save in which module an auxiliary declaration
created by the code generator has been created.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.addExtraName" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.findAsync?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L753-L771">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.findAsync?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">findAsync?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipRealize</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a></span></div></div><p>Looks up the given declaration name in the environment, avoiding forcing any in-progress elaboration
tasks unless necessary. This can usually be done efficiently because <code><a href=".././Lean/Environment.html#Lean.Environment.addConstAsync">addConstAsync</a></code> ensures that
declarations added in an environment branch have that branch's declaration name as a prefix, so we
know exactly what tasks to wait for to find a declaration. However, this is not true for
declarations from <code><a href=".././Lean/Environment.html#Lean.Environment.realizeConst">realizeConst</a></code>, which are not restricted to the current prefix, and reference to
which may escpae the branch(es) they have been realized on such as when looking into the type <code>Expr</code>
of a declaration found on another branch. Thus when we cannot find the declaration using the fast
prefix-based lookup, we fall back to waiting for and looking at the realizations from all branches.
To avoid this expensive search for realizations from other branches, <code>skipRealize</code> can set to ensure
negative lookups are as fast as positive ones.</p><p>Use <code><a href=".././Lean/Environment.html#Lean.Environment.findTask">findTask</a></code> instead if any blocking should be avoided.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.findAsync?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.findTask"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L773-L778">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.findTask"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">findTask</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipRealize</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Core.html#Task">Task</a> <span class="fn">(<a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">AsyncConstantInfo</a>)</span></span></div></div><p>Like <code><a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></code> but returns a task instead of resorting to blocking.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.findTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.findConstVal?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L780-L788">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.findConstVal?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">findConstVal?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipRealize</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.ConstantVal">ConstantVal</a></span></div></div><p>Like <code>findAsync</code> but blocks on everything but the constant's body (if any), which is not accessible
through the result.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.findConstVal?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.find?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L790-L794">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.find?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">find?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipRealize</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a></span></div></div><p>Like <code><a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></code>, but blocks until the constant's info is fully available.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.find?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.enableRealizationsForConst"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L796-L823">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.enableRealizationsForConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">enableRealizationsForConst</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><p>Allows <code><a href=".././Lean/Environment.html#Lean.Environment.realizeConst">realizeConst</a></code> calls for the given declaration in all derived environment branches.
Realizations will run using the given environment and options to ensure deterministic results. Note
that while we check that the function isn't called before the declaration is actually added to the
environment, we cannot automatically check that it isn't otherwise called too early in the sense
that helper declarations and environment extension state that may be relevant to realizations may
not have been added yet. We do check that we are not calling it from a different branch than <code>c</code> was
added on, which would be definitely too late. Thus, this function should generally be called in
elaborators calling <code>addDecl</code> (when that declaration is a plausible target for realization) at the
latest possible point, i.e. at the very end of the elaborator or just before a first realization may
be triggered if any.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.enableRealizationsForConst" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.dbgFormatAsyncState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L825-L836">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.dbgFormatAsyncState"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">dbgFormatAsyncState</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Init/Prelude.html#String">String</a></span></div></div><p>Returns debug output about the asynchronous state of the environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.dbgFormatAsyncState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.dbgFormatCheckedSyncState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L838-L840">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.dbgFormatCheckedSyncState"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">dbgFormatCheckedSyncState</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Init/Prelude.html#String">String</a></span></div></div><p>Returns debug output about the synchronous state of the environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.dbgFormatCheckedSyncState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.PromiseCheckedResult"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L842-L856">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">PromiseCheckedResult</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Result of <code><a href=".././Lean/Environment.html#Lean.Environment.promiseChecked">Lean.Environment.promiseChecked</a></code>.</p><ul class="structure_fields" id="Lean.Environment.PromiseCheckedResult.mk"><li id="Lean.Environment.PromiseCheckedResult.mainEnv" class="structure_field"><div class="structure_field_info">mainEnv : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div><div class="structure_field_doc"><p>Resulting &quot;main branch&quot; environment. Accessing the kernel environment will block until
<code><a href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult.commitChecked">PromiseCheckedResult.commitChecked</a></code> has been called.</p></div></li><li id="Lean.Environment.PromiseCheckedResult.asyncEnv" class="structure_field"><div class="structure_field_info">asyncEnv : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div><div class="structure_field_doc"><p>Resulting &quot;async branch&quot; environment which should be used in a new task and then to call
<code><a href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult.commitChecked">PromiseCheckedResult.commitChecked</a></code> to commit results back to the main environment. If it is not
called and the <code><a href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult">PromiseCheckedResult</a></code> object is dropped, the kernel environment will be left
unchanged.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.PromiseCheckedResult.checkedEnvPromise" class="structure_field"><div class="structure_field_info">checkedEnvPromise : <span class="fn"><a href=".././Init/System/Promise.html#IO.Promise">IO.Promise</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a></span></div></li></ul><details id="instances-for-list-Lean.Environment.PromiseCheckedResult" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.realizingStack"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L858-L859">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.realizingStack"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">realizingStack</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.realizingStack">realizingStack</a></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn">(<a href=".././Init/Prelude.html#Option.map">Option.map</a> <span class="fn">(fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext">Lean.AsyncContext✝</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncContext.realizingStack">realizingStack</a></span>)</span> <span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.asyncCtx?">Lean.Environment.asyncCtx?✝</a> <span class="fn">env</span>)</span>)</span>.<a href=".././Init/Prelude.html#Option.getD">getD</a></span> <a href=".././Init/Prelude.html#List.nil">[</a><a href=".././Init/Prelude.html#List.nil">]</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.realizingStack" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.promiseChecked"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L873-L888">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.promiseChecked"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">promiseChecked</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult">PromiseCheckedResult</a></span></div></div><p>Starts an asynchronous modification of the kernel environment. The environment is split into a
&quot;main&quot; branch that will block on access to the kernel environment until
<code><a href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult.commitChecked">PromiseCheckedResult.commitChecked</a></code> has been called on the &quot;async&quot; environment branch.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.promiseChecked" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.PromiseCheckedResult.commitChecked"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L890-L894">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult.commitChecked"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">PromiseCheckedResult</span>.<span class="name">commitChecked</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">res</span> : <a href=".././Lean/Environment.html#Lean.Environment.PromiseCheckedResult">PromiseCheckedResult</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Commits the kernel environment of the given environment back to the main branch.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.PromiseCheckedResult.commitChecked" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.instNonemptyConstPromiseVal"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L902-L902">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.instNonemptyConstPromiseVal"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">instNonemptyConstPromiseVal</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Nonempty">Nonempty</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.ConstPromiseVal">Lean.Environment.ConstPromiseVal✝</a></span></div></div></div></div><div class="decl" id="Lean.Environment.AddConstAsyncResult"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L904-L927">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Result of <code><a href=".././Lean/Environment.html#Lean.Environment.addConstAsync">Lean.Environment.addConstAsync</a></code> which is necessary to complete the asynchronous addition.</p><ul class="structure_fields" id="Lean.Environment.AddConstAsyncResult.mk"><li id="Lean.Environment.AddConstAsyncResult.mainEnv" class="structure_field"><div class="structure_field_info">mainEnv : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div><div class="structure_field_doc"><p>Resulting &quot;main branch&quot; environment which contains the declaration name as an asynchronous
constant. Accessing the constant or kernel environment will block until the corresponding
<code>AddConstAsyncResult.commit*</code> function has been called.</p></div></li><li id="Lean.Environment.AddConstAsyncResult.asyncEnv" class="structure_field"><div class="structure_field_info">asyncEnv : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div><div class="structure_field_doc"><p>Resulting &quot;async branch&quot; environment which should be used to add the desired declaration in a new
task and then call <code>AddConstAsyncResult.commit*</code> to commit results back to the main environment.
<code><a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult.commitCheckEnv">commitCheckEnv</a></code> completes the addition; if it is not called and the <code><a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult">AddConstAsyncResult</a></code> object
is dropped, <code>sorry</code>ed default values will be reported instead and the kernel environment will be
left unchanged.</p></div></li><li id="_private.Lean.Environment.0.Lean.Environment.AddConstAsyncResult.constName" class="structure_field"><div class="structure_field_info">constName : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></div></li><li id="_private.Lean.Environment.0.Lean.Environment.AddConstAsyncResult.kind" class="structure_field"><div class="structure_field_info">kind : <a href=".././Lean/Environment.html#Lean.ConstantKind">Lean.ConstantKind</a></div></li><li id="_private.Lean.Environment.0.Lean.Environment.AddConstAsyncResult.sigPromise" class="structure_field"><div class="structure_field_info">sigPromise : <span class="fn"><a href=".././Init/System/Promise.html#IO.Promise">IO.Promise</a> <a href=".././Lean/Declaration.html#Lean.ConstantVal">Lean.ConstantVal</a></span></div></li><li id="_private.Lean.Environment.0.Lean.Environment.AddConstAsyncResult.constPromise" class="structure_field"><div class="structure_field_info">constPromise : <span class="fn"><a href=".././Init/System/Promise.html#IO.Promise">IO.Promise</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.ConstPromiseVal">Lean.Environment.ConstPromiseVal✝</a></span></div></li><li id="_private.Lean.Environment.0.Lean.Environment.AddConstAsyncResult.checkedEnvPromise" class="structure_field"><div class="structure_field_info">checkedEnvPromise : <span class="fn"><a href=".././Init/System/Promise.html#IO.Promise">IO.Promise</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a></span></div></li><li id="_private.Lean.Environment.0.Lean.Environment.AddConstAsyncResult.allRealizationsPromise" class="structure_field"><div class="structure_field_info">allRealizationsPromise : <span class="fn"><a href=".././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">(<a href=".././Lean/Data/NameMap.html#Lean.NameMap">Lean.NameMap</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConst">Lean.AsyncConst✝</a>)</span></span></div></li></ul><details id="instances-for-list-Lean.Environment.AddConstAsyncResult" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.addConstAsync"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L950-L1013">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.addConstAsync"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">addConstAsync</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">constName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">kind</span> : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">exportedKind</span> : <a href=".././Lean/Environment.html#Lean.ConstantKind">ConstantKind</a> := <span class="fn">kind</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">reportExts </span><span class="fn">checkMayContain</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult">AddConstAsyncResult</a></span></div></div><p>Starts the asynchronous addition of a constant to the environment. The environment is split into a
&quot;main&quot; branch that holds a reference to the constant to be added but will block on access until the
corresponding information has been added on the &quot;async&quot; environment branch and committed there; see
the respective fields of <code><a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult">AddConstAsyncResult</a></code> as well as the [Environment Branches] note for more
information.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.addConstAsync" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.AddConstAsyncResult.commitSignature"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1015-L1024">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult.commitSignature"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span>.<span class="name">commitSignature</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">res</span> : <a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult">AddConstAsyncResult</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">sig</span> : <a href=".././Lean/Declaration.html#Lean.ConstantVal">ConstantVal</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Commits the signature of the constant to the main environment branch. The declaration name must
match the name originally given to <code><a href=".././Lean/Environment.html#Lean.Environment.addConstAsync">addConstAsync</a></code>. It is optional to call this function but can
help in unblocking corresponding accesses to the constant on the main branch.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.AddConstAsyncResult.commitSignature" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.AddConstAsyncResult.commitConst"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1026-L1057">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult.commitConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span>.<span class="name">commitConst</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">res</span> : <a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult">AddConstAsyncResult</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">info? </span><span class="fn">exportedInfo?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a></span> := <a href=".././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Commits the full constant info as well as the current environment extension state and set of nested
asynchronous constants to the main environment branch. If <code>info?</code> is <code>none</code>, it is taken from the
given environment. The declaration name and kind must match the original values given to
<code><a href=".././Lean/Environment.html#Lean.Environment.addConstAsync">addConstAsync</a></code>. The signature must match the previous <code><a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult.commitSignature">commitSignature</a></code> call, if any.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.AddConstAsyncResult.commitConst" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.AddConstAsyncResult.commitCheckEnv"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1059-L1072">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult.commitCheckEnv"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">AddConstAsyncResult</span>.<span class="name">commitCheckEnv</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">res</span> : <a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult">AddConstAsyncResult</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Assuming <code><a href=".././Lean/AddDecl.html#Lean.addDecl">Lean.addDecl</a></code> has been run for the constant to be added on the async environment branch,
commits the full constant info from that call to the main environment, waits for the final kernel
environment resulting from the <code>addDecl</code> call, and commits it to the main branch as well, unblocking
kernel additions there. All <code><a href=".././Lean/Environment.html#Lean.Environment.AddConstAsyncResult.commitConst">commitConst</a></code> preconditions apply.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.AddConstAsyncResult.commitCheckEnv" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.contains"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1074-L1082">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.contains"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">contains</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipRealize</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Checks whether <code><a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></code> would return a result.</p><p>NOTE: Unlike <code>findAsync</code>, this function defaults <code>skipRealize</code> to <code>true</code> to avoid unnecessary
blocking on realizations, which should always be brought into scope by running <code><a href=".././Lean/Environment.html#Lean.Environment.realizeConst">realizeConst</a></code>, which
does its own, optimized existence check.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.contains">contains</a></span> <span class="fn">n</span> <span class="fn">skipRealize</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></span> <span class="fn">n</span> <span class="fn">skipRealize</span>)</span>.<a href=".././Init/Data/Option/Basic.html#Option.isSome">isSome</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.contains" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.containsOnBranch"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1084-L1089">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.containsOnBranch"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">containsOnBranch</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">n</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><p>Checks whether the given declaration is known on the current branch, in which case <code><a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></code> will
not block.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.containsOnBranch">containsOnBranch</a></span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   (<span class="fn"><span class="fn">(<span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.asyncConsts">Lean.Environment.asyncConsts✝</a> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConsts.find?">find?</a></span> <span class="fn">n</span>)</span>.<a href=".././Init/Data/Option/Basic.html#Option.isSome">isSome</a></span> <a href=".././Init/Prelude.html#Bool.or">||</a>     <span class="fn"><a href=".././Lean/Data/SMap.html#Lean.SMap.contains">Lean.SMap.contains</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.base">Lean.Environment.base✝</a> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.get">get</a></span> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.constants">constants</a></span> <span class="fn">n</span></span>)</li></ul></details><details id="instances-for-list-Lean.Environment.containsOnBranch" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.header"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1091-L1093">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.header"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">header</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.EnvironmentHeader">EnvironmentHeader</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.header">header</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.base">Lean.Environment.base✝</a> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.private">private</a></span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.header">header</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.header" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.imports"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1095-L1096">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.imports"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">imports</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.imports">imports</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.header">header</a></span>.<a href=".././Lean/Environment.html#Lean.EnvironmentHeader.imports">imports</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.imports" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.allImportedModuleNames"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1098-L1099">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.allImportedModuleNames"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">allImportedModuleNames</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.allImportedModuleNames">allImportedModuleNames</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.header">header</a></span>.<a href=".././Lean/Environment.html#Lean.EnvironmentHeader.moduleNames">moduleNames</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.allImportedModuleNames" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.setMainModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1101-L1108">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.setMainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">setMainModule</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">m</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.setMainModule" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.mainModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1110-L1111">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.mainModule"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">mainModule</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Lean.Name">Name</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.mainModule">mainModule</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.header">header</a></span>.<a href=".././Lean/Environment.html#Lean.EnvironmentHeader.mainModule">mainModule</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.mainModule" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.getModuleIdxFor?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1113-L1115">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdxFor?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?">getModuleIdxFor?</a></span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.base">Lean.Environment.base✝</a> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.get">get</a></span> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.const2ModIdx">const2ModIdx</a></span><a href=".././Init/GetElem.html#GetElem?.getElem?">[</a><span class="fn">declName</span><a href=".././Init/GetElem.html#GetElem?.getElem?">]</a><a href=".././Init/GetElem.html#GetElem?.getElem?">?</a></li></ul></details><details id="instances-for-list-Lean.Environment.getModuleIdxFor?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isImportedConst"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1117-L1118">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isImportedConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isImportedConst</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.isImportedConst">isImportedConst</a></span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?">getModuleIdxFor?</a></span> <span class="fn">declName</span>)</span>.<a href=".././Init/Data/Option/Basic.html#Option.isSome">isSome</a></span></li></ul></details><details id="instances-for-list-Lean.Environment.isImportedConst" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isConstructor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1120-L1121">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isConstructor"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isConstructor</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.isConstructor">isConstructor</a></span> <span class="fn">declName</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Data/Option/Basic.html#Option.any">Option.any</a> <span class="fn">(fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#Lean.AsyncConstantInfo">Lean.AsyncConstantInfo</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#Lean.AsyncConstantInfo.kind">kind</a></span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <a href=".././Lean/Environment.html#Lean.ConstantKind.ctor">Lean.ConstantKind.ctor</a>)</span> <span class="fn">(<span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></span> <span class="fn">declName</span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Environment.isConstructor" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.isSafeDefinition"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1123-L1126">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.isSafeDefinition"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">isSafeDefinition</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.isSafeDefinition" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.getModuleIdx?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1128-L1129">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.getModuleIdx?"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">getModuleIdx?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">moduleName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.getModuleIdx?">getModuleIdx?</a></span> <span class="fn">moduleName</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.findIdx?">Array.findIdx?</a> <span class="fn">(fun (<span class="fn">x</span> : <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a>) =&gt; <span class="fn">x</span> <a href=".././Init/Prelude.html#BEq.beq">==</a> <span class="fn">moduleName</span>)</span> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.header">header</a></span>.<a href=".././Lean/Environment.html#Lean.EnvironmentHeader.moduleNames">moduleNames</a></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.getModuleIdx?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ConstantVal.instantiateTypeLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1133-L1134">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantVal.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">ConstantVal</span>.<span class="name">instantiateTypeLevelParams</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Declaration.html#Lean.ConstantVal">ConstantVal</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ls</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.ConstantVal.instantiateTypeLevelParams">instantiateTypeLevelParams</a></span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantVal.type">type</a></span>.<a href=".././Lean/Util/InstantiateLevelParams.html#Lean.Expr.instantiateLevelParams">instantiateLevelParams</a></span> <span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantVal.levelParams">levelParams</a></span> <span class="fn">ls</span></span></li></ul></details><details id="instances-for-list-Lean.ConstantVal.instantiateTypeLevelParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ConstantInfo.instantiateTypeLevelParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1138-L1139">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateTypeLevelParams"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateTypeLevelParams</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ls</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateTypeLevelParams">instantiateTypeLevelParams</a></span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantInfo.toConstantVal">toConstantVal</a></span>.<a href=".././Lean/Environment.html#Lean.ConstantVal.instantiateTypeLevelParams">instantiateTypeLevelParams</a></span> <span class="fn">ls</span></span></li></ul></details><details id="instances-for-list-Lean.ConstantInfo.instantiateTypeLevelParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ConstantInfo.instantiateValueLevelParams!"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1141-L1142">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateValueLevelParams!"><span class="name">Lean</span>.<span class="name">ConstantInfo</span>.<span class="name">instantiateValueLevelParams!</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <a href=".././Lean/Declaration.html#Lean.ConstantInfo">ConstantInfo</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ls</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Level.html#Lean.Level">Level</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Expr.html#Lean.Expr">Expr</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Environment.html#Lean.ConstantInfo.instantiateValueLevelParams!">instantiateValueLevelParams!</a></span> <span class="fn">ls</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantInfo.value!">value!</a></span>.<a href=".././Lean/Util/InstantiateLevelParams.html#Lean.Expr.instantiateLevelParams">instantiateLevelParams</a></span> <span class="fn"><span class="fn">c</span>.<a href=".././Lean/Declaration.html#Lean.ConstantInfo.levelParams">levelParams</a></span> <span class="fn">ls</span></span></li></ul></details><details id="instances-for-list-Lean.ConstantInfo.instantiateValueLevelParams!" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.AsyncMode"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1146-L1207">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">AsyncMode</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Async access mode for environment extensions used in <code>EnvExtension.get/set/modifyState</code>.
When modified in concurrent contexts, extensions may need to switch to a different mode than the
default <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.mainOnly">mainOnly</a></code>, which will panic in such cases. The access mode is set at environment extension
registration time but can be overriden when calling the mentioned functions in order to weaken it
for specific accesses.</p><p>In all modes, the state stored into the <code>.olean</code> file for persistent environment extensions is the
result of <code><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">getState</a></code> called on the main environment branch at the end of the file, i.e. it
encompasses all modifications for all modes but <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.local">local</a></code>.</p><ul class="constructors"><li class="constructor" id="Lean.EnvExtension.AsyncMode.sync">sync : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a><div class="inductive_ctor_doc"><p>Safest access mode, writes and reads the extension state to/from the full <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code>
environment. This mode ensures the observed state is identical independently of whether or how
parallel elaboration is used but <code><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">getState</a></code> will block on all prior environment branches by
waiting for <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code>. <code><a href=".././Lean/Environment.html#Lean.EnvExtension.setState">setState</a></code> and <code><a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">modifyState</a></code> do not block.</p><p>While a safe fallback for when <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.mainOnly">mainOnly</a></code> is not sufficient, any extension that reasonably could
be used in parallel elaboration contexts should opt for a weaker mode to avoid blocking unless
there is no way to access the correct state without waiting for all prior environment branches, in
which case its data management should be restructured if at all possible.</p></div></li><li class="constructor" id="Lean.EnvExtension.AsyncMode.local">local : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a><div class="inductive_ctor_doc"><p>Accesses only the state of the current environment branch. Modifications on other branches are not
visible and are ultimately discarded except for the main branch. Provides the fastest accessors,
will never block.</p><p>This mode is particularly suitable for extensions where state does not escape from lexical scopes
even without parallelism, e.g. <code>ScopedEnvExtension</code>s when setting local entries.</p></div></li><li class="constructor" id="Lean.EnvExtension.AsyncMode.mainOnly">mainOnly : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a><div class="inductive_ctor_doc"><p>Default access mode. Like <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.local">local</a></code> but panics when trying to modify the state on anything but the
main environment branch. For extensions that fulfill this requirement, all modes functionally
coincide with <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.local">local</a></code> but this is the safest and most efficient choice in that case, preventing
accidental misuse.</p><p>This mode is suitable for extensions that are modified only at the command elaboration level
before any environment forks in the command, and in particular for extensions that are modified
only at the very beginning of the file.</p></div></li><li class="constructor" id="Lean.EnvExtension.AsyncMode.async">async : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a><div class="inductive_ctor_doc"><p>Accumulates modifications in the <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code> environment like <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.sync">sync</a></code>, but <code><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">getState</a></code> will panic
instead of blocking. Instead <code><a href=".././Lean/Environment.html#Lean.EnvExtension.findStateAsync">findStateAsync</a></code> should be used, which will access the state of the
environment branch corresponding to the passed declaration name, if any, or otherwise the state
of the current branch. In other words, at most one environment branch will be blocked on instead
of all prior branches. The local state can still be accessed by calling <code><a href=".././Lean/Environment.html#Lean.EnvExtension.getState">getState</a></code> with mode
<code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.local">local</a></code> explicitly.</p><p>This mode is suitable for extensions with map-like state where the key uniquely identifies the
top-level declaration where it could have been set, e.g. because the key on modification is always
the surrounding declaration's name. Any calls to <code><a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">modifyState</a></code>/<code><a href=".././Lean/Environment.html#Lean.EnvExtension.setState">setState</a></code> should assert
<code><a href=".././Lean/Environment.html#Lean.Environment.asyncMayContain">asyncMayContain</a></code> with that key to ensure state is never accidentally stored in a branch where it
cannot be found by <code><a href=".././Lean/Environment.html#Lean.EnvExtension.findStateAsync">findStateAsync</a></code>. In particular, this mode is closest to how the environment's
own constant map works which asserts the same predicate on modification and provides <code><a href=".././Lean/Environment.html#Lean.Environment.findAsync?">findAsync?</a></code>
for block-avoiding access.</p></div></li></ul><details id="instances-for-list-Lean.EnvExtension.AsyncMode" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.instInhabitedAsyncMode"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1207-L1207">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.instInhabitedAsyncMode"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">instInhabitedAsyncMode</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.EnvExtension.instInhabitedAsyncMode">Lean.EnvExtension.instInhabitedAsyncMode</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.sync">Lean.EnvExtension.AsyncMode.sync</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.ReplayFn"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1209-L1210">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ReplayFn"><span class="name">Lean</span>.<span class="name">ReplayFn</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.ReplayFn">Lean.ReplayFn</a> <span class="fn">σ</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">(<span class="fn">σ</span> → <span class="fn">σ</span> → <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span> → <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span></span>)</span></li></ul></details><details id="instances-for-list-Lean.ReplayFn" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1212-L1227">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension"><span class="name">Lean</span>.<span class="name">EnvExtension</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Environment extension, can only be generated by <code><a href=".././Lean/Environment.html#Lean.registerEnvExtension">registerEnvExtension</a></code> that allocates a unique index
for this extension into each environment's extension state's array.</p><ul class="structure_fields" id="_private.Lean.Environment.0.Lean.EnvExtension.mk"><li id="Lean.EnvExtension.idx" class="structure_field"><div class="structure_field_info">idx : <a href=".././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.EnvExtension.mkInitial" class="structure_field"><div class="structure_field_info">mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span></div></li><li id="Lean.EnvExtension.asyncMode" class="structure_field"><div class="structure_field_info">asyncMode : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a></div></li><li id="Lean.EnvExtension.replay?" class="structure_field"><div class="structure_field_info">replay? : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.ReplayFn">ReplayFn</a> <span class="fn">σ</span>)</span></span></div><div class="structure_field_doc"><p>Optional function that, given state before and after realization and newly added constants,
replays this change onto a state from another (derived) environment. This function is used only
when making changes to an extension inside a <code><a href=".././Lean/Environment.html#Lean.Environment.realizeConst">realizeConst</a></code> call, in which case it must be
present.</p></div></li></ul><details id="instances-for-list-Lean.EnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedEnvExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1227-L1227">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedEnvExtension"><span class="name">Lean</span>.<span class="name">instInhabitedEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">a✝</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">a✝</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedEnvExtension">Lean.instInhabitedEnvExtension</a> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.EnvExtension.mk">{</a> <span class="fn">idx</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">mkInitial</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">asyncMode</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">replay?</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.EnvExtension.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.EnvExtension.ensureExtensionsArraySize"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1233-L1250">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.ensureExtensionsArraySize"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">ensureExtensionsArraySize</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">exts</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a>)</span></span></div></div><p>User-defined environment extensions are declared using the <code>initialize</code> command.
This command is just syntax sugar for the <code>init</code> attribute.
When we <code>import</code> lean modules, the vector stored at <code>envExtensionsRef</code> may increase in size because of
user-defined environment extensions. When this happens, we must adjust the size of the <code>env.extensions</code>.
This method is invoked when processing <code>import</code>s.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.ensureExtensionsArraySize">Lean.EnvExtension.ensureExtensionsArraySize</a> <span class="fn">exts</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension.ensureExtensionsArraySize.loop">Lean.EnvExtension.ensureExtensionsArraySize.loop</a> <span class="fn"><span class="fn">exts</span>.<a href=".././Init/Prelude.html#Array.size">size</a></span> <span class="fn">exts</span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtension.ensureExtensionsArraySize" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.ensureExtensionsArraySize.loop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1243-L1250">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.ensureExtensionsArraySize.loop"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">ensureExtensionsArraySize</span>.<span class="name">loop</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">i</span> : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">exts</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a>)</span></span></div></div></div></div><div class="decl" id="Lean.EnvExtension.mkInitialExtStates"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1279-L1281">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.mkInitialExtStates"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">mkInitialExtStates</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.EnvExtension.mkInitialExtStates">Lean.EnvExtension.mkInitialExtStates</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">exts</span> ← <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.EnvExtension.envExtensionsRef">Lean.EnvExtension.envExtensionsRef✝</a></span>
  <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.mapM">Array.mapM</a> <span class="fn">(fun (<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">Lean.EnvExtension</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">Lean.EnvExtensionState</a></span>) =&gt; <span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.mkInitial">mkInitial</a></span>)</span> <span class="fn">exts</span></span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtension.mkInitialExtStates" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1283-L1309">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">modifyState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">asyncMode</span> : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a> := <span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.asyncMode">asyncMode</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Applies the given function to the extension state. See <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a></code> for details on how modifications
from different environment branches are reconciled.</p><p>Note that in modes <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.sync">sync</a></code> and <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.async">async</a></code>, <code>f</code> will be called twice, on the local and on the <code><a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></code>
state.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.EnvExtension.modifyState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1311-L1316">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.setState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">setState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Sets the extension state to the given value. See <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a></code> for details on how modifications from
different environment branches are reconciled.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.setState">setState</a></span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Core.html#inline">inline</a> <span class="fn">(<span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">modifyState</a></span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">x</span> : <span class="fn">σ</span>) =&gt; <span class="fn">s</span></span>)</span></span></li></ul></details><details id="instances-for-list-Lean.EnvExtension.setState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.EnvExtension.getState"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1328-L1336">source</a></div><div class="attributes">@[implemented_by _private.Lean.Environment.0.Lean.EnvExtension.getStateUnsafe]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.getState"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">getState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">asyncMode</span> : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a> := <span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.asyncMode">asyncMode</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Returns the current extension state. See <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a></code> for details on how modifications from
different environment branches are reconciled. Panics if the extension is marked as <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.async">async</a></code>; see its
documentation for more details. Overriding the extension's default <code><a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">AsyncMode</a></code> is usually not
recommended and should be considered only for important optimizations.</p></div></div><div class="decl" id="Lean.EnvExtension.findStateAsync"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1373-L1380">source</a></div><div class="attributes">@[implemented_by _private.Lean.Environment.0.Lean.EnvExtension.findStateAsyncUnsafe]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.EnvExtension.findStateAsync"><span class="name">Lean</span>.<span class="name">EnvExtension</span>.<span class="name">findStateAsync</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Returns the final extension state on the environment branch corresponding to the passed declaration
name, if any, or otherwise the state on the current branch. In other words, at most one environment
branch will be blocked on.</p></div></div><div class="decl" id="Lean.registerEnvExtension"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1384-L1401">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerEnvExtension"><span class="name">Lean</span>.<span class="name">registerEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">mkInitial</span> : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">replay?</span> : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.ReplayFn">ReplayFn</a> <span class="fn">σ</span>)</span></span> := <a href=".././Init/Prelude.html#Option.none">none</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">asyncMode</span> : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">EnvExtension.AsyncMode</a> := <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode.mainOnly">EnvExtension.AsyncMode.mainOnly</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">σ</span>)</span></span></div></div><p>Environment extensions can only be registered during initialization.
Reasons:
1- Our implementation assumes the number of extensions does not change after an environment object is created.
2- We do not use any synchronization primitive to access <code>envExtensionsRef</code>.</p><p>Note that by default, extension state is <em>not</em> stored in .olean files and will not propagate across <code>import</code>s.
For that, you need to register a persistent environment extension.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.registerEnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkEmptyEnvironment"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1405-L1419">source</a></div><div class="attributes">@[export lean_mk_empty_environment]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkEmptyEnvironment"><span class="name">Lean</span>.<span class="name">mkEmptyEnvironment</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">trustLevel</span> : <a href=".././Init/Prelude.html#UInt32">UInt32</a> := <span class="fn">0</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkEmptyEnvironment" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtensionState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1421-L1423">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionState</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtensionState.mk"><li id="Lean.PersistentEnvExtensionState.importedEntries" class="structure_field"><div class="structure_field_info">importedEntries : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span></div></li><li id="Lean.PersistentEnvExtensionState.state" class="structure_field"><div class="structure_field_info">state : <span class="fn">σ</span></div></li></ul><details id="instances-for-list-Lean.PersistentEnvExtensionState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportM.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1425-L1427">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportM.Context"><span class="name">Lean</span>.<span class="name">ImportM</span>.<span class="name">Context</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.ImportM.Context.mk"><li id="Lean.ImportM.Context.env" class="structure_field"><div class="structure_field_info">env : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></li><li id="Lean.ImportM.Context.opts" class="structure_field"><div class="structure_field_info">opts : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a></div></li></ul><details id="instances-for-list-Lean.ImportM.Context" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1429-L1429">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportM"><span class="name">Lean</span>.<span class="name">ImportM</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.ImportM">Lean.ImportM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context">Lean.ImportM.Context</a> <a href=".././Init/System/IO.html#IO">IO</a></span></li></ul></details><details id="instances-for-list-Lean.ImportM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1431-L1490">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>An environment extension with support for storing/retrieving entries from a .olean file.</p><ul>
<li>α is the type of the entries that are stored in .olean files.</li>
<li>β is the type of values used to update the state.</li>
<li>σ is the actual state.</li>
</ul><p>For most extensions, α and β coincide. <code>α</code> and ‵β` do not coincide for extensions where the data
used to update the state contains elements which cannot be stored in files (for example, closures).</p><p>During elaboration of a module, state of type <code>σ</code> can be both read and written. When elaboration is
complete, the state of type <code>σ</code> is converted to serialized state of type <code><a href=".././Init/Prelude.html#Array">Array</a> α</code> by
<code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code>. To read the current module's state, use <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">PersistentEnvExtension.getState</a></code>. To
modify it, use <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">PersistentEnvExtension.addEntry</a></code>, with an <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntryFn">addEntryFn</a></code> that performs the appropriate
modification.</p><p>When a module is loaded, the values saved by all of its dependencies for this
<code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a></code> are available as an <code><a href=".././Init/Prelude.html#Array">Array</a> (Array α)</code> via the environment extension,
with one array per transitively imported module. The state of type <code>σ</code> used in the current module
can be initialized from these imports by specifying a suitable <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addImportedFn">addImportedFn</a></code>. The <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addImportedFn">addImportedFn</a></code>
runs at the beginning of elaboration for every module, so it's usually better for performance to
query the array of imported modules directly, because only a fraction of imported entries is usually
queried during elaboration of a module.</p><p>The most typical pattern for using <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a></code> is to set <code>σ</code> to a datatype such as
<code>NameMap</code> that efficiently tracks data for the current module. Then, in <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code>, this type
is converted to an array of pairs, sorted by the key. Given <code>ext : <a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> α β σ</code> and
<code><a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></code>, the complete array of imported entries sorted by module index can be obtained
using <code>(ext.toEnvExtension.<a href=".././Lean/Environment.html#Lean.EnvExtension.getState">getState</a> env).<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.importedEntries">importedEntries</a></code>. To query the extension for some constant
name <code>n</code>, first use <code>env.<a href=".././Lean/Environment.html#Lean.Environment.getModuleIdxFor?">getModuleIdxFor?</a> n</code>. If it returns <code>none</code>, look up <code>n</code> in the current
module's state (the <code>NameMap</code>). If it returns <code>some <a href=".././Lean/Environment.html#Lean.EnvExtension.idx">idx</a></code>, use <code>ext.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">getModuleEntries</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a> <a href=".././Lean/Environment.html#Lean.EnvExtension.idx">idx</a></code> to get
the array of entries for <code>n</code>'s defining module, and query it using <code><a href=".././Init/Data/Array/BinSearch.html#Array.binSearch">Array.binSearch</a></code>. This pattern
imposes a constraint that the extension can only track metadata that is declared in the same module
as the definition to which it applies; relaxing this restriction can make queries slower due to
needing to search <em>all</em> modules. If it is necessary to search all modules, it is usually better to
initialize the state of type <code>σ</code> once from all imported entries and choose a more efficient search
datastructure for it.</p><p>Note that <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntryFn">addEntryFn</a></code> is not in <code><a href=".././Init/System/IO.html#IO">IO</a></code>. This is intentional, and allows us to write simple functions
such as</p><pre><code>def addAlias (env : Environment) (a : Name) (e : Name) : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a> :=
aliasExtension.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry">addEntry</a> <a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a> (a, e)
</code></pre><p>without using <code><a href=".././Init/System/IO.html#IO">IO</a></code>. We have many functions like <code>addAlias</code>.</p><ul class="structure_fields" id="Lean.PersistentEnvExtension.mk"><li id="Lean.PersistentEnvExtension.toEnvExtension" class="structure_field"><div class="structure_field_info">toEnvExtension : <span class="fn"><a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span>)</span></span></div></li><li id="Lean.PersistentEnvExtension.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Name</a></div></li><li id="Lean.PersistentEnvExtension.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">ImportM</a> <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtension.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">β</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtension.exportEntriesFn" class="structure_field"><div class="structure_field_info">exportEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div><div class="structure_field_doc"><p>Function to transform state into data that should always be imported into other modules.</p></div></li><li id="Lean.PersistentEnvExtension.saveEntriesFn" class="structure_field"><div class="structure_field_info">saveEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div><div class="structure_field_doc"><p>Function to transform state into data that should be imported into other modules when the module
system is disabled. When it is enabled, the data is loaded only in the language server and
accessible via <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">getModuleEntries</a> (includeServer := true)</code>. Conventionally, this is a superset of
the data returned by <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code>.</p></div></li><li id="Lean.PersistentEnvExtension.statsFn" class="structure_field"><div class="structure_field_info">statsFn : <span class="fn"><span class="fn">σ</span> → <a href=".././Init/Data/Format/Basic.html#Std.Format">Format</a></span></div></li></ul><details id="instances-for-list-Lean.PersistentEnvExtension" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instInhabitedPersistentEnvExtensionState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1492-L1493">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtensionState"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtensionState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtensionState">Lean.instInhabitedPersistentEnvExtensionState</a> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.mk">{</a> <span class="fn">importedEntries</span> := <a href=".././Init/Prelude.html#List.toArray">#[</a><a href=".././Init/Prelude.html#List.toArray">]</a>, <span class="fn">state</span> := <a href=".././Init/Prelude.html#Inhabited.default">default</a> <a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.mk">}</a> <a href=".././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.instInhabitedPersistentEnvExtension"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1495-L1504">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instInhabitedPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">instInhabitedPersistentEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.getModuleEntries"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1508-L1516">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getModuleEntries</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">m</span> : <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">includeServer</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></div></div><p>Returns the data saved by <code>ext.exportEntriesFn/saveEntriesFn</code> when <code>m</code> was elaborated. See docs on
the functions for details.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.getModuleEntries" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.addEntry"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1518-L1521">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.addEntry"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">addEntry</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">b</span> : <span class="fn">β</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.addEntry" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.getState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1523-L1526">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">getState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">asyncMode</span> : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">EnvExtension.AsyncMode</a> := <span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.toEnvExtension">toEnvExtension</a></span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.asyncMode">asyncMode</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Get the current state of the given extension in the given environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getState">getState</a></span> <span class="fn">env</span> <span class="fn">asyncMode</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.toEnvExtension">toEnvExtension</a></span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.getState">getState</a></span> <span class="fn">env</span> <span class="fn">asyncMode</span>)</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.state">state</a></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.getState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.setState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1528-L1530">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.setState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">setState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <span class="fn">σ</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Set the current state of the given extension in the given environment.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.setState">setState</a></span> <span class="fn">env</span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.toEnvExtension">toEnvExtension</a></span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.modifyState">modifyState</a></span> <span class="fn">env</span> <span class="fn">fun (<span class="fn">ps</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState">Lean.PersistentEnvExtensionState</a> <span class="fn">α</span> <span class="fn">σ</span></span>) =&gt;
    <a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.mk">{</a> <span class="fn">importedEntries</span> := <span class="fn"><span class="fn">ps</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.importedEntries">importedEntries</a></span>, <span class="fn">state</span> := <span class="fn">s</span> <a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.mk">}</a></span></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.setState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.modifyState"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1532-L1535">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.modifyState"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">modifyState</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><span class="fn">σ</span> → <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">asyncMode</span> : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">EnvExtension.AsyncMode</a> := <span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.toEnvExtension">toEnvExtension</a></span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.asyncMode">asyncMode</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a></div></div><p>Modify the state of the given extension in the given environment by applying the given function.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.modifyState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.PersistentEnvExtension.findStateAsync"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1537-L1540">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtension.findStateAsync"><span class="name">Lean</span>.<span class="name">PersistentEnvExtension</span>.<span class="name">findStateAsync</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ext</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">declPrefix</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">σ</span></div></div><p>Returns the final extension state on the environment branch corresponding to the passed declaration
name, if any, or otherwise the state on the current branch. In other words, at most one environment
branch will be blocked on.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.findStateAsync">findStateAsync</a></span> <span class="fn">env</span> <span class="fn">declPrefix</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">(<span class="fn"><span class="fn"><span class="fn">ext</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.toEnvExtension">toEnvExtension</a></span>.<a href=".././Lean/Environment.html#Lean.EnvExtension.findStateAsync">findStateAsync</a></span> <span class="fn">env</span> <span class="fn">declPrefix</span>)</span>.<a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionState.state">state</a></span></li></ul></details><details id="instances-for-list-Lean.PersistentEnvExtension.findStateAsync" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.persistentEnvExtensionsRef"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1545-L1545">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.persistentEnvExtensionsRef"><span class="name">Lean</span>.<span class="name">persistentEnvExtensionsRef</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">EnvExtensionEntry</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionEntry">EnvExtensionEntry</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a>)</span>)</span></span></div></div></div></div><div class="decl" id="Lean.PersistentEnvExtensionDescr"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1547-L1556">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr"><span class="name">Lean</span>.<span class="name">PersistentEnvExtensionDescr</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.PersistentEnvExtensionDescr.mk"><li id="Lean.PersistentEnvExtensionDescr.name" class="structure_field"><div class="structure_field_info">name : <a href=".././Init/Prelude.html#Lean.Name">Name</a></div></li><li id="Lean.PersistentEnvExtensionDescr.mkInitial" class="structure_field"><div class="structure_field_info">mkInitial : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">σ</span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.addImportedFn" class="structure_field"><div class="structure_field_info">addImportedFn : <span class="fn"><span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span>)</span></span> → <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportM">ImportM</a> <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.addEntryFn" class="structure_field"><div class="structure_field_info">addEntryFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><span class="fn">β</span> → <span class="fn">σ</span></span></span></div></li><li id="Lean.PersistentEnvExtensionDescr.exportEntriesFn" class="structure_field"><div class="structure_field_info">exportEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div><div class="structure_field_doc"><p>Function to transform state into data that should always be imported into other modules.</p></div></li><li id="Lean.PersistentEnvExtensionDescr.saveEntriesFn" class="structure_field"><div class="structure_field_info">saveEntriesFn : <span class="fn"><span class="fn">σ</span> → <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">α</span></span></span></div><div class="structure_field_doc"><p>Function to transform state into data that should be imported into other modules when the module
system is disabled. When it is enabled, the data is loaded only in the language server and
accessible via <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">getModuleEntries</a> (includeServer := true)</code>. Conventionally, this is a superset of
the data returned by <code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.exportEntriesFn">exportEntriesFn</a></code>.</p></div></li><li id="Lean.PersistentEnvExtensionDescr.statsFn" class="structure_field"><div class="structure_field_info">statsFn : <span class="fn"><span class="fn">σ</span> → <a href=".././Init/Data/Format/Basic.html#Std.Format">Format</a></span></div></li><li id="Lean.PersistentEnvExtensionDescr.asyncMode" class="structure_field"><div class="structure_field_info">asyncMode : <a href=".././Lean/Environment.html#Lean.EnvExtension.AsyncMode">EnvExtension.AsyncMode</a></div></li><li id="Lean.PersistentEnvExtensionDescr.replay?" class="structure_field"><div class="structure_field_info">replay? : <span class="fn"><a href=".././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.ReplayFn">ReplayFn</a> <span class="fn">σ</span>)</span></span></div></li></ul><details id="instances-for-list-Lean.PersistentEnvExtensionDescr" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.registerPersistentEnvExtensionUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1561-L1583">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerPersistentEnvExtensionUnsafe"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtensionUnsafe</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">descr</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">PersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.registerPersistentEnvExtensionUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.registerPersistentEnvExtension"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1585-L1586">source</a></div><div class="attributes">@[implemented_by Lean.registerPersistentEnvExtensionUnsafe]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.registerPersistentEnvExtension"><span class="name">Lean</span>.<span class="name">registerPersistentEnvExtension</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β </span><span class="fn">σ</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">σ</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">descr</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.PersistentEnvExtensionDescr">PersistentEnvExtensionDescr</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.PersistentEnvExtension">PersistentEnvExtension</a> <span class="fn">α</span> <span class="fn">β</span> <span class="fn">σ</span>)</span></span></div></div></div></div><div class="decl" id="Lean.saveModuleDataParts"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1588-L1595">source</a></div><div class="attributes">@[extern  lean_save_module_data_parts]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.saveModuleDataParts"><span class="name">Lean</span>.<span class="name">saveModuleDataParts</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">mod</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">parts</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> (<a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a>)</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Stores each given module data in the respective file name. Objects shared with prior parts are not
duplicated. Thus the data cannot be loaded with individual <code><a href=".././Lean/Environment.html#Lean.readModuleData">readModuleData</a></code> calls but must loaded by
passing (a prefix of) the file names to <code><a href=".././Lean/Environment.html#Lean.readModuleDataParts">readModuleDataParts</a></code>. <code>mod</code> is used to determine an
arbitrary but deterministic base address for <code>mmap</code>.</p></div></div><div class="decl" id="Lean.readModuleDataParts"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1597-L1602">source</a></div><div class="attributes">@[extern  lean_read_module_data_parts]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.readModuleDataParts"><span class="name">Lean</span>.<span class="name">readModuleDataParts</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">fnames</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Init/Prelude.html#Array">Array</a> (<a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">CompactedRegion</a>))</span></span></div></div><p>Loads the module data from the given file names. The files must be (a prefix of) the result of a
<code><a href=".././Lean/Environment.html#Lean.saveModuleDataParts">saveModuleDataParts</a></code> call.</p></div></div><div class="decl" id="Lean.saveModuleData"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1604-L1605">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.saveModuleData"><span class="name">Lean</span>.<span class="name">saveModuleData</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">fname</span> : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">mod</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">data</span> : <a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.saveModuleData">Lean.saveModuleData</a> <span class="fn">fname</span> <span class="fn">mod</span> <span class="fn">data</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.saveModuleDataParts">Lean.saveModuleDataParts</a> <span class="fn">mod</span> <a href=".././Init/Prelude.html#List.toArray">#[</a><a href=".././Init/Prelude.html#Prod.mk">(</a><span class="fn">fname</span><a href=".././Init/Prelude.html#Prod.mk">,</a> <span class="fn">data</span><a href=".././Init/Prelude.html#Prod.mk">)</a><a href=".././Init/Prelude.html#List.toArray">]</a></span></li></ul></details><details id="instances-for-list-Lean.saveModuleData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.readModuleData"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1607-L1611">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.readModuleData"><span class="name">Lean</span>.<span class="name">readModuleData</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">fname</span> : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion">CompactedRegion</a>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.readModuleData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.freeRegions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1613-L1633">source</a></div><div class="attributes">@[noinline, export lean_environment_free_regions]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.freeRegions"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">freeRegions</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Free compacted regions of imports. No live references to imported objects may exist at the time of invocation; in
particular, <code><a href=".././Lean/Environment.html#Lean.ImportM.Context.env">env</a></code> should be the last reference to any <code><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></code> derived from these imports.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.freeRegions">freeRegions</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Data/Array/Basic.html#Array.forM">Array.forM</a> <a href=".././Lean/Environment.html#Lean.CompactedRegion.free">Lean.CompactedRegion.free</a> <span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.header">header</a></span>.<a href=".././Lean/Environment.html#Lean.EnvironmentHeader.regions">regions</a></span></span></li></ul></details><details id="instances-for-list-Lean.Environment.freeRegions" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.OLeanLevel"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1635-L1643">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.OLeanLevel"><span class="name">Lean</span>.<span class="name">OLeanLevel</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>The level of information to save/load. Each level includes all previous ones.</p><ul class="constructors"><li class="constructor" id="Lean.OLeanLevel.exported">exported : <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a><div class="inductive_ctor_doc"><p>Information from exported contexts.</p></div></li><li class="constructor" id="Lean.OLeanLevel.server">server : <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a><div class="inductive_ctor_doc"><p>Environment extension state for the language server.</p></div></li><li class="constructor" id="Lean.OLeanLevel.private">private : <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a><div class="inductive_ctor_doc"><p>Private module data.</p></div></li></ul><details id="instances-for-list-Lean.OLeanLevel" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.instDecidableEqOLeanLevel"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1643-L1643">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instDecidableEqOLeanLevel"><span class="name">Lean</span>.<span class="name">instDecidableEqOLeanLevel</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#DecidableEq">DecidableEq</a> <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instDecidableEqOLeanLevel">Lean.instDecidableEqOLeanLevel</a> <span class="fn">x✝</span> <span class="fn">y✝</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">if h : <span class="fn"><span class="fn">x✝</span>.<a href=".././Lean/Environment.html#Lean.OLeanLevel.toCtorIdx">toCtorIdx</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">y✝</span>.<a href=".././Lean/Environment.html#Lean.OLeanLevel.toCtorIdx">toCtorIdx</a></span> then <span class="fn"><a href=".././Init/Prelude.html#Decidable.isTrue">isTrue</a> <span class="fn">⋯</span></span> else <span class="fn"><a href=".././Init/Prelude.html#Decidable.isFalse">isFalse</a> <span class="fn">⋯</span></span></span></li></ul></details></div></div><div class="decl" id="Lean.OLeanLevel.adjustFileName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1645-L1648">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.OLeanLevel.adjustFileName"><span class="name">Lean</span>.<span class="name">OLeanLevel</span>.<span class="name">adjustFileName</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">base</span> : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a> → <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.OLeanLevel.adjustFileName">Lean.OLeanLevel.adjustFileName</a> <span class="fn">base</span> <a href=".././Lean/Environment.html#Lean.OLeanLevel.exported">Lean.OLeanLevel.exported</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">base</span></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.OLeanLevel.adjustFileName">Lean.OLeanLevel.adjustFileName</a> <span class="fn">base</span> <a href=".././Lean/Environment.html#Lean.OLeanLevel.server">Lean.OLeanLevel.server</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">base</span>.<a href=".././Init/System/FilePath.html#System.FilePath.addExtension">addExtension</a></span> <span class="fn">&quot;server&quot;</span></span></li><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.OLeanLevel.adjustFileName">Lean.OLeanLevel.adjustFileName</a> <span class="fn">base</span> <a href=".././Lean/Environment.html#Lean.OLeanLevel.private">Lean.OLeanLevel.private</a></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">base</span>.<a href=".././Init/System/FilePath.html#System.FilePath.addExtension">addExtension</a></span> <span class="fn">&quot;private&quot;</span></span></li></ul></details><details id="instances-for-list-Lean.OLeanLevel.adjustFileName" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkModuleData"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1654-L1678">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkModuleData"><span class="name">Lean</span>.<span class="name">mkModuleData</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">level</span> : <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a> := <a href=".././Lean/Environment.html#Lean.OLeanLevel.private">OLeanLevel.private</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.ModuleData">ModuleData</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkModuleData" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.writeModule"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1680-L1689">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.writeModule"><span class="name">Lean</span>.<span class="name">writeModule</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">fname</span> : <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.writeModule" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkExtNameMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1691-L1701">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkExtNameMap"><span class="name">Lean</span>.<span class="name">mkExtNameMap</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">startingAt</span> : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href=".././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span></div></div><p>Construct a mapping from persistent extension name to extension index at the array of persistent extensions.
We only consider extensions starting with index <code>&gt;= startingAt</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkExtNameMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.updateEnvAttributes"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1723-L1732">source</a></div><div class="attributes">@[extern 2 lean_update_env_attributes]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.updateEnvAttributes"><span class="name">Lean</span>.<span class="name">updateEnvAttributes</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></span></div></div><p>&quot;Forward declaration&quot; needed for updating the attribute table with user-defined attributes.
User-defined attributes are declared using the <code>initialize</code> command. The <code>initialize</code> command is just syntax sugar for the <code>init</code> attribute.
The <code>init</code> attribute is initialized after the <code>attributeExtension</code> is initialized. We cannot change the order since the <code>init</code> attribute is an attribute,
and requires this extension.
The <code>attributeExtension</code> initializer uses <code>attributeMapRef</code> to initialize the attribute mapping.
When we a new user-defined attribute declaration is imported, <code>attributeMapRef</code> is updated.
Later, we set this method with code that adds the user-defined attributes that were imported after we initialized <code>attributeExtension</code>.</p></div></div><div class="decl" id="Lean.getNumBuiltinAttributes"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1733-L1734">source</a></div><div class="attributes">@[extern 1 lean_get_num_attributes]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.getNumBuiltinAttributes"><span class="name">Lean</span>.<span class="name">getNumBuiltinAttributes</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div></div><p>&quot;Forward declaration&quot; for retrieving the number of builtin attributes.</p></div></div><div class="decl" id="Lean.ImportState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1787-L1789">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportState"><span class="name">Lean</span>.<span class="name">ImportState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.ImportState.mk"><li id="_private.Lean.Environment.0.Lean.ImportState.moduleNameMap" class="structure_field"><div class="structure_field_info">moduleNameMap : <span class="fn"><a href=".././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.ImportedModule">Lean.ImportedModule✝</a></span></div></li><li id="_private.Lean.Environment.0.Lean.ImportState.moduleNames" class="structure_field"><div class="structure_field_info">moduleNames : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/Prelude.html#Lean.Name">Lean.Name</a></span></div></li></ul><details id="instances-for-list-Lean.ImportState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.throwAlreadyImported"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1791-L1794">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.throwAlreadyImported"><span class="name">Lean</span>.<span class="name">throwAlreadyImported</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href=".././Lean/Environment.html#Lean.ImportState">ImportState</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">const2ModIdx</span> : <span class="fn"><a href=".././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a> <a href=".././Lean/Environment.html#Lean.ModuleIdx">ModuleIdx</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">modIdx</span> : <a href=".././Init/Prelude.html#Nat">Nat</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cname</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.throwAlreadyImported" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportStateM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1796-L1796">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportStateM"><span class="name">Lean</span>.<span class="name">ImportStateM</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Environment.html#Lean.ImportStateM">Lean.ImportStateM</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href=".././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href=".././Lean/Environment.html#Lean.ImportState">Lean.ImportState</a> <a href=".././Init/System/IO.html#IO">IO</a></span></li></ul></details><details id="instances-for-list-Lean.ImportStateM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.ImportStateM.run"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1798-L1799">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.ImportStateM.run"><span class="name">Lean</span>.<span class="name">ImportStateM</span>.<span class="name">run</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.ImportStateM">ImportStateM</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href=".././Lean/Environment.html#Lean.ImportState">ImportState</a> := <a href=".././Lean/Environment.html#Lean.ImportState.mk">{</a> <a href=".././Lean/Environment.html#Lean.ImportState.mk">}</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<span class="fn">α</span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Lean/Environment.html#Lean.ImportState">ImportState</a>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#Lean.ImportStateM.run">run</a></span> <span class="fn">s</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Control/StateRef.html#StateRefT'.run">StateRefT'.run</a> <span class="fn">x</span> <span class="fn">s</span></span></li></ul></details><details id="instances-for-list-Lean.ImportStateM.run" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.importModulesCore"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1801-L1845">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModulesCore"><span class="name">Lean</span>.<span class="name">importModulesCore</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">imports</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">forceImportAll</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportStateM">ImportStateM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.importModulesCore.go"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1803-L1845">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModulesCore.go"><span class="name">Lean</span>.<span class="name">importModulesCore</span>.<span class="name">go</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">imports</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">forceImportAll</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.ImportStateM">ImportStateM</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.finalizeImport"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1877-L1979">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.finalizeImport"><span class="name">Lean</span>.<span class="name">finalizeImport</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href=".././Lean/Environment.html#Lean.ImportState">ImportState</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">imports</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">trustLevel</span> : <a href=".././Init/Prelude.html#UInt32">UInt32</a> := <span class="fn">0</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">leakEnv </span><span class="fn">loadExts</span> : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">level</span> : <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a> := <a href=".././Lean/Environment.html#Lean.OLeanLevel.private">OLeanLevel.private</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><p>Constructs environment from <code><a href=".././Lean/Environment.html#Lean.importModulesCore">importModulesCore</a></code> results.</p><p>See also <code><a href=".././Lean/Environment.html#Lean.importModules">importModules</a></code> for parameter documentation.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.finalizeImport" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.importModules"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L1981-L2010">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.importModules"><span class="name">Lean</span>.<span class="name">importModules</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">imports</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">trustLevel</span> : <a href=".././Init/Prelude.html#UInt32">UInt32</a> := <span class="fn">0</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">plugins</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Init/System/FilePath.html#System.FilePath">System.FilePath</a></span> := <a href=".././Init/Prelude.html#List.toArray">#[</a><a href=".././Init/Prelude.html#List.toArray">]</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">leakEnv </span><span class="fn">loadExts</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">level</span> : <a href=".././Lean/Environment.html#Lean.OLeanLevel">OLeanLevel</a> := <a href=".././Lean/Environment.html#Lean.OLeanLevel.private">OLeanLevel.private</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><p>Creates environment object from given imports.</p><p>If <code>leakEnv</code> is true, we mark the environment as persistent, which means it will not be freed. We
set this when the object would survive until the end of the process anyway. In exchange, RC updates
are avoided, which is especially important when they would be atomic because the environment is
shared across threads (potentially, storing it in an <code><a href=".././Init/System/IO.html#IO.Ref">IO.Ref</a></code> is sufficient for marking it as such).</p><p>If <code>loadExts</code> is true, we initialize the environment extensions using the imported data. Doing so
may use the interpreter and thus is only safe to do after calling <code>enableInitializersExecution</code>; see
also caveats there. If not set, every extension will have its initial value as its state. While the
environment's constant map can be accessed without <code>loadExts</code>, many functions that take
<code><a href=".././Lean/Environment.html#Lean.Kernel.Environment">Environment</a></code> or are in a monad carrying it such as <code>CoreM</code> may not function properly without it.</p><p>If <code>level</code> is <code><a href=".././Lean/Environment.html#Lean.OLeanLevel.exported">exported</a></code>, the module to be elaborated is assumed to be participating in the module
system and imports will be restricted accordingly. If it is <code><a href=".././Lean/Environment.html#Lean.OLeanLevel.server">server</a></code>, the data for
<code><a href=".././Lean/Environment.html#Lean.PersistentEnvExtension.getModuleEntries">getModuleEntries</a> (includeServer := true)</code> is loaded as well. If it is <code><a href=".././Lean/Environment.html#Lean.OLeanLevel.private">private</a></code>, all data is loaded
as if no <code><a href=".././Lean/Environment.html#Lean.Import.module">module</a></code> annotations were present in the imports.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.importModules" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.withImportModules"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2012-L2021">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.withImportModules"><span class="name">Lean</span>.<span class="name">withImportModules</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">imports</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <a href=".././Lean/Environment.html#Lean.Import">Import</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a> → <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">trustLevel</span> : <a href=".././Init/Prelude.html#UInt32">UInt32</a> := <span class="fn">0</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><p>Creates environment object from imports and frees compacted regions after calling <code>act</code>. No live
references to the environment object or imported objects may exist after <code>act</code> finishes. As this
cannot be ruled out after loading environment extensions, <code><a href=".././Lean/Environment.html#Lean.importModules">importModules</a></code>'s <code>loadExts</code> is always
unset using this function.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.withImportModules">Lean.withImportModules</a> <span class="fn">imports</span> <span class="fn">opts</span> <span class="fn">act</span> <span class="fn">trustLevel</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">env</span> ← <span class="fn"><a href=".././Lean/Environment.html#Lean.importModules">Lean.importModules</a> <span class="fn">imports</span> <span class="fn">opts</span> <span class="fn">trustLevel</span></span>
  <span class="fn"><a href=".././Init/Control/Except.html#tryFinally">tryFinally</a> <span class="fn">(<span class="fn">act</span> <span class="fn">env</span>)</span> <span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.freeRegions">freeRegions</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.withImportModules" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.enableDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2023-L2025">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.enableDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">enableDiag</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">flag</span> : <a href=".././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><p>Enables/disables kernel diagnostics.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.enableDiag">Lean.Kernel.enableDiag</a> <span class="fn">env</span> <span class="fn">flag</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.modifyCheckedAsync">Lean.Environment.modifyCheckedAsync✝</a> <span class="fn">env</span> <span class="fn">fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a>) =&gt; <span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.enableDiag">enableDiag</a></span> <span class="fn">flag</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.enableDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.isDiagnosticsEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2027-L2028">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDiagnosticsEnabled"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDiagnosticsEnabled</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDiagnosticsEnabled">Lean.Kernel.isDiagnosticsEnabled</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.base">Lean.Environment.base✝</a> <span class="fn">env</span>)</span>.<a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.VisibilityMap.private">private</a></span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.isDiagnosticsEnabled">isDiagnosticsEnabled</a></span></li></ul></details><details id="instances-for-list-Lean.Kernel.isDiagnosticsEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.resetDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2030-L2031">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.resetDiag"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">resetDiag</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.resetDiag">Lean.Kernel.resetDiag</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.modifyCheckedAsync">Lean.Environment.modifyCheckedAsync✝</a> <span class="fn">env</span> <span class="fn">fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a>) =&gt; <span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.resetDiag">resetDiag</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.resetDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.getDiagnostics"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2033-L2034">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.getDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">getDiagnostics</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.getDiagnostics">Lean.Kernel.getDiagnostics</a> <span class="fn">env</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn"><span class="fn">env</span>.<a href=".././Lean/Environment.html#Lean.Environment.checked">checked</a></span>.<a href=".././Init/Core.html#Task.get">get</a></span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.diagnostics">diagnostics</a></span></li></ul></details><details id="instances-for-list-Lean.Kernel.getDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.setDiagnostics"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2036-L2037">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.setDiagnostics"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">setDiagnostics</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">diag</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Diagnostics">Diagnostics</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.setDiagnostics">Lean.Kernel.setDiagnostics</a> <span class="fn">env</span> <span class="fn">diag</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.Environment.modifyCheckedAsync">Lean.Environment.modifyCheckedAsync✝</a> <span class="fn">env</span> <span class="fn">fun (<span class="fn">x</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Lean.Kernel.Environment</a>) =&gt; <span class="fn"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/Environment.html#Lean.Kernel.Environment.setDiagnostics">setDiagnostics</a></span> <span class="fn">diag</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Kernel.setDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.displayStats"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2058-L2075">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.displayStats"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">displayStats</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.displayStats" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.evalConst"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2077-L2082">source</a></div><div class="attributes">@[extern  lean_eval_const]</div>
<div class="decl_header"><span class="decl_kind">unsafe opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.evalConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConst</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a> u_1)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">constName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Init/Prelude.html#String">String</a> <span class="fn">α</span></span></div></div><p>Evaluate the given declaration under the given environment to a value of the given type.
This function is only safe to use if the type matches the declaration's type in the environment
and if <code>enableInitializersExecution</code> has been used before importing any modules.</p></div></div><div class="decl" id="Lean.Environment.replayConsts"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2087-L2150">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.replayConsts"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">replayConsts</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">dest </span><span class="fn">oldEnv </span><span class="fn">newEnv</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipExisting</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></div><p>Replays the difference between <code>newEnv</code> and <code>oldEnv</code> onto <code>dest</code>: the set of constants in <code>newEnv</code>
but not <code>oldEnv</code> and the environment extension state for extensions defining <code><a href=".././Lean/Environment.html#Lean.EnvExtension.replay?">replay?</a></code>. If
<code>skipExisting</code> is true, constants that are already in <code>dest</code> are not added. If <code>newEnv</code> and <code>dest</code>
are not derived from <code>oldEnv</code>, the result is undefined.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.replayConsts" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.replayConsts.replayKernel"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2116-L2150">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.replayConsts.replayKernel"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">replayConsts</span>.<span class="name">replayKernel</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">oldEnv </span><span class="fn">newEnv</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">skipExisting</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">exts</span> : <span class="fn"><a href=".././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.EnvExtension">EnvExtension</a> <a href=".././Lean/Environment.html#Lean.EnvExtensionState">EnvExtensionState</a>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">consts</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Lean/Environment.html#_private.Lean.Environment.0.Lean.AsyncConst">Lean.AsyncConst✝</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">kenv</span> : <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Kernel.Environment</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Kernel.Exception</a> <a href=".././Lean/Environment.html#Lean.Kernel.Environment">Kernel.Environment</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.replayConsts.replayKernel" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.evalConstCheck"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2152-L2162">source</a></div><div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.evalConstCheck"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">evalConstCheck</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">typeName </span><span class="fn">constName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Control/Except.html#ExceptT">ExceptT</a> <a href=".././Init/Prelude.html#String">String</a> <a href=".././Init/Control/Id.html#Id">Id</a> <span class="fn">α</span></span></div></div><p>Like <code><a href=".././Lean/Environment.html#Lean.Environment.evalConst">evalConst</a></code>, but first check that <code>constName</code> indeed is a declaration of type <code>typeName</code>.
Note that this function cannot guarantee that <code>typeName</code> is in fact the name of the type <code>α</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.evalConstCheck" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.hasUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2164-L2171">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.hasUnsafe"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">hasUnsafe</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.hasUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Environment.realizeConst"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2173-L2262">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Environment.realizeConst"><span class="name">Lean</span>.<span class="name">Environment</span>.<span class="name">realizeConst</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">forConst </span><span class="fn">constName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">realize</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Environment</a> → <span class="fn"><a href=".././Lean/Data/Options.html#Lean.Options">Options</a> → <span class="fn"><a href=".././Init/System/IO.html#BaseIO">BaseIO</a> (<a href=".././Lean/Environment.html#Lean.Environment">Environment</a> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Init/Dynamic.html#Dynamic">Dynamic</a>)</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> (<a href=".././Lean/Environment.html#Lean.Environment">Environment</a> <a href=".././Init/Prelude.html#Prod">×</a> <span class="fn"><a href=".././Init/Core.html#Task">Task</a> <span class="fn">(<a href=".././Init/Prelude.html#Option">Option</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Kernel.Exception</a>)</span></span> <a href=".././Init/Prelude.html#Prod">×</a> <a href=".././Init/Dynamic.html#Dynamic">Dynamic</a>)</span></div></div><p>Plumbing function for <code><a href=".././Lean/Meta/Basic.html#Lean.Meta.realizeConst">Lean.Meta.realizeConst</a></code>; see documentation there.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Environment.realizeConst" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Kernel-API">Kernel API <a class="hover-link" href="#Kernel-API">#</a></h1></div><div class="decl" id="Lean.Kernel.isDefEq"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2269-L2276">source</a></div><div class="attributes">@[extern  lean_kernel_is_def_eq]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDefEq"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEq</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a </span><span class="fn">b</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Kernel isDefEq predicate. We use it mainly for debugging purposes.
Recall that the kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.Kernel.isDefEqGuarded"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2278-L2279">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.isDefEqGuarded"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">isDefEqGuarded</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a </span><span class="fn">b</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDefEqGuarded">Lean.Kernel.isDefEqGuarded</a> <span class="fn">env</span> <span class="fn">lctx</span> <span class="fn">a</span> <span class="fn">b</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn">match <span class="fn"><a href=".././Lean/Environment.html#Lean.Kernel.isDefEq">Lean.Kernel.isDefEq</a> <span class="fn">env</span> <span class="fn">lctx</span> <span class="fn">a</span> <span class="fn">b</span></span> with
  | <span class="fn"><a href=".././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">result</span></span> =&gt; <span class="fn">result</span>
  | <span class="fn">x</span> =&gt; <a href=".././Init/Prelude.html#Bool.false">false</a></span></li></ul></details><details id="instances-for-list-Lean.Kernel.isDefEqGuarded" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Kernel.whnf"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2281-L2288">source</a></div><div class="attributes">@[extern  lean_kernel_whnf]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.whnf"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">whnf</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><p>Kernel WHNF function. We use it mainly for debugging purposes.
Recall that the kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.Kernel.check"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2290-L2297">source</a></div><div class="attributes">@[extern  lean_kernel_check]</div>
<div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.Kernel.check"><span class="name">Lean</span>.<span class="name">Kernel</span>.<span class="name">check</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">lctx</span> : <a href=".././Lean/LocalContext.html#Lean.LocalContext">LocalContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Except">Except</a> <a href=".././Lean/Environment.html#Lean.Kernel.Exception">Exception</a> <a href=".././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><p>Kernel typecheck function. We use it mainly for debugging purposes.
Recall that the Kernel type checker does not support metavariables.
When implementing automation, consider using the <code>MetaM</code> methods.</p></div></div><div class="decl" id="Lean.MonadEnv"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2301-L2303">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.MonadEnv"><span class="name">Lean</span>.<span class="name">MonadEnv</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.MonadEnv.mk"><li id="Lean.MonadEnv.getEnv" class="structure_field"><div class="structure_field_info">getEnv : <span class="fn"><span class="fn">m</span> <a href=".././Lean/Environment.html#Lean.Environment">Environment</a></span></div></li><li id="Lean.MonadEnv.modifyEnv" class="structure_field"><div class="structure_field_info">modifyEnv : <span class="fn"><span class="fn">(<a href=".././Lean/Environment.html#Lean.Environment">Environment</a> → <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span> → <span class="fn"><span class="fn">m</span> <a href=".././Init/Prelude.html#Unit">Unit</a></span></span></div></li></ul><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.MonadEnv" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.instMonadEnvOfMonadLift"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2307-L2310">source</a></div><div class="attributes">@[always_inline]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.instMonadEnvOfMonadLift"><span class="name">Lean</span>.<span class="name">instMonadEnvOfMonadLift</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">m </span><span class="fn">n</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#MonadLift">MonadLift</a> <span class="fn">m</span> <span class="fn">n</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">MonadEnv</a> <span class="fn">n</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.instMonadEnvOfMonadLift">Lean.instMonadEnvOfMonadLift</a> <span class="fn">m</span> <span class="fn">n</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <a href=".././Lean/Environment.html#Lean.MonadEnv.mk">{</a> <span class="fn">getEnv</span> := <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <a href=".././Lean/Environment.html#Lean.MonadEnv.getEnv">Lean.getEnv</a></span>,
    <span class="fn">modifyEnv</span> := <span class="fn">fun (<span class="fn">f</span> : <span class="fn"><a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a> → <a href=".././Lean/Environment.html#Lean.Environment">Lean.Environment</a></span>) =&gt; <span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href=".././Lean/Environment.html#Lean.MonadEnv.modifyEnv">Lean.modifyEnv</a> <span class="fn">f</span>)</span></span></span> <a href=".././Lean/Environment.html#Lean.MonadEnv.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.withExporting"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2312-L2325">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.withExporting"><span class="name">Lean</span>.<span class="name">withExporting</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Control/Except.html#MonadFinally">MonadFinally</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Data/Options.html#Lean.MonadOptions">MonadOptions</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">isExporting</span> : <a href=".././Init/Prelude.html#Bool">Bool</a> := <a href=".././Init/Prelude.html#Bool.true">true</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><p>Sets <code><a href=".././Lean/Environment.html#Lean.Environment.isExporting">Environment.isExporting</a></code> to the given value while executing <code>x</code>. No-op if
<code><a href=".././Lean/Environment.html#Lean.EnvironmentHeader.isModule">EnvironmentHeader.isModule</a></code> is false.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.withExporting" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.withoutExporting"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2327-L2329">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.withoutExporting"><span class="name">Lean</span>.<span class="name">withoutExporting</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Control/Except.html#MonadFinally">MonadFinally</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Data/Options.html#Lean.MonadOptions">MonadOptions</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><p>Sets <code><a href=".././Lean/Environment.html#Lean.Environment.isExporting">Environment.isExporting</a></code> to false while executing <code>x</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Environment.html#Lean.withoutExporting">Lean.withoutExporting</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Environment.html#Lean.withExporting">Lean.withExporting</a> <span class="fn">x</span> <a href=".././Init/Prelude.html#Bool.false">false</a></span></li></ul></details><details id="instances-for-list-Lean.withoutExporting" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.mkDefinitionValInferrringUnsafe"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2331-L2336">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.mkDefinitionValInferrringUnsafe"><span class="name">Lean</span>.<span class="name">mkDefinitionValInferrringUnsafe</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href=".././foundational_types.html">Type</a> → <a href=".././foundational_types.html">Type</a></span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href=".././Lean/Environment.html#Lean.MonadEnv">MonadEnv</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">name</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">levelParams</span> : <span class="fn"><a href=".././Init/Prelude.html#List">List</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">type </span><span class="fn">value</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">hints</span> : <a href=".././Lean/Declaration.html#Lean.ReducibilityHints">ReducibilityHints</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href=".././Lean/Declaration.html#Lean.DefinitionVal">DefinitionVal</a></span></div></div><p>Constructs a DefinitionVal, inferring the <code>unsafe</code> field</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.mkDefinitionValInferrringUnsafe" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.getMaxHeight"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Environment.lean#L2338-L2345">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Environment.html#Lean.getMaxHeight"><span class="name">Lean</span>.<span class="name">getMaxHeight</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">env</span> : <a href=".././Lean/Environment.html#Lean.Environment">Environment</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href=".././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#UInt32">UInt32</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.getMaxHeight" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src=".././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>