<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Server.FileWorker</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Server.FileWorker";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/Environment.html">Lean.Environment</a></li><li><a href="../.././Lean/LoadDynlib.html">Lean.LoadDynlib</a></li><li><a href="../.././Init/System/IO.html">Init.System.IO</a></li><li><a href="../.././Lean/Data/Lsp.html">Lean.Data.Lsp</a></li><li><a href="../.././Lean/Data/RBMap.html">Lean.Data.RBMap</a></li><li><a href="../.././Lean/Language/Lean.html">Lean.Language.Lean</a></li><li><a href="../.././Lean/Server/AsyncList.html">Lean.Server.AsyncList</a></li><li><a href="../.././Lean/Server/References.html">Lean.Server.References</a></li><li><a href="../.././Lean/Server/Utils.html">Lean.Server.Utils</a></li><li><a href="../.././Lean/Util/FileSetupInfo.html">Lean.Util.FileSetupInfo</a></li><li><a href="../.././Lean/Widget/InteractiveDiagnostic.html">Lean.Widget.InteractiveDiagnostic</a></li><li><a href="../.././Std/Sync/Channel.html">Std.Sync.Channel</a></li><li><a href="../.././Lean/Data/Json/FromToJson.html">Lean.Data.Json.FromToJson</a></li><li><a href="../.././Lean/Server/CodeActions/UnknownIdentifier.html">Lean.Server.CodeActions.UnknownIdentifier</a></li><li><a href="../.././Lean/Server/Completion/ImportCompletion.html">Lean.Server.Completion.ImportCompletion</a></li><li><a href="../.././Lean/Server/FileWorker/RequestHandling.html">Lean.Server.FileWorker.RequestHandling</a></li><li><a href="../.././Lean/Server/FileWorker/SetupFile.html">Lean.Server.FileWorker.SetupFile</a></li><li><a href="../.././Lean/Server/FileWorker/Utils.html">Lean.Server.FileWorker.Utils</a></li><li><a href="../.././Lean/Server/FileWorker/WidgetRequests.html">Lean.Server.FileWorker.WidgetRequests</a></li><li><a href="../.././Lean/Server/Rpc/Basic.html">Lean.Server.Rpc.Basic</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Server.FileWorker" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.RefreshInfo"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">RefreshInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.PartialHandlerInfo"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PartialHandlerInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.instInhabitedPartialHandlerInfo"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">instInhabitedPartialHandlerInfo</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext.modifyGetPartialHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">modifyGetPartialHandler</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext.modifyPartialHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">modifyPartialHandler</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext.updateRequestsInFlight"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">updateRequestsInFlight</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext.initPendingServerRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">initPendingServerRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerContext.resolveServerRequestResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">resolveServerRequestResponse</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.instInhabitedReportSnapshotsState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">instInhabitedReportSnapshotsState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.server.reportDelayMs"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">server</span>.<span class="name">reportDelayMs</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.MemorizedInteractiveDiagnostics"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">MemorizedInteractiveDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.instTypeNameMemorizedInteractiveDiagnostics"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">instTypeNameMemorizedInteractiveDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.PendingRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PendingRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PendingRequestMap</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.AvailableImportsCache"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">AvailableImportsCache</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.WorkerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.setupImports"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">setupImports</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initializeWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initializeWorker.mkLspOutputChannel"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span>.<span class="name">mkLspOutputChannel</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initializeWorker.getImportClosure?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span>.<span class="name">getImportClosure?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.sendServerRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">sendServerRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.sendUntypedServerRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">sendUntypedServerRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.updatePendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updatePendingRequests</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.updateDocument"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updateDocument</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleDidChange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleCancelRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleStaleDependency"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleStaleDependency</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRpcRelease"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcRelease</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRpcKeepAlive"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcKeepAlive</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRpcConnect"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcConnect</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">parseParams</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleNotification</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.queueRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">queueRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleImportCompletionRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleImportCompletionRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleStatefulPreRequestSpecialCases"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleStatefulPreRequestSpecialCases</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleGetInteractiveDiagnosticsRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleGetInteractiveDiagnosticsRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handlePreRequestSpecialCases?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handlePreRequestSpecialCases?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handlePostRequestSpecialCases"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handlePostRequestSpecialCases</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.emitRequestResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">emitRequestResponse</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.emitRequestResponse.emitResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">emitRequestResponse</span>.<span class="name">emitResponse</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRequest</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleResponse</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.handleResponseError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleResponseError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">mainLoop</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.runRefreshTasks"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">runRefreshTasks</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.runRefreshTasks.sleepWithCancellation"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">runRefreshTasks</span>.<span class="name">sleepWithCancellation</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initAndRunWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initAndRunWorker</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.initAndRunWorker.writeErrorDiag"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initAndRunWorker</span>.<span class="name">writeErrorDiag</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Server.FileWorker.workerMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">workerMain</span></a></div></nav><main>
<div class="mod_doc"><p>For general server architecture, see <code>README.md</code>. For details of IPC communication, see <code>Watchdog.lean</code>.
This module implements per-file worker processes.</p><p>File processing and requests+notifications against a file should be concurrent for two reasons:</p><ul>
<li>By the LSP standard, requests should be cancellable.</li>
<li>Since Lean allows arbitrary user code to be executed during elaboration via the tactic framework,
elaboration can be extremely slow and even not halt in some cases. Users should be able to
work with the file while this is happening, e.g. make new changes to the file or send requests.</li>
</ul><p>To achieve these goals, elaboration is executed in a chain of tasks, where each task corresponds to
the elaboration of one command. When the elaboration of one command is done, the next task is spawned.
On didChange notifications, we search for the task in which the change occurred. If we stumble across
a task that has not yet finished before finding the task we're looking for, we terminate it
and start the elaboration there, otherwise we start the elaboration at the task where the change occurred.</p><p>Requests iterate over tasks until they find the command that they need to answer the request.
In order to not block the main thread, this is done in a request task.
If a task that the request task waits for is terminated, a change occurred somewhere before the
command that the request is looking for and the request sends a &quot;content changed&quot; error.</p></div><div class="decl" id="Lean.Server.FileWorker.RefreshInfo"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L63-L65">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.RefreshInfo"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">RefreshInfo</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.RefreshInfo.mk"><li id="Lean.Server.FileWorker.RefreshInfo.lastRefreshTimestamp" class="structure_field"><div class="structure_field_info">lastRefreshTimestamp : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Server.FileWorker.RefreshInfo.successiveRefreshAttempts" class="structure_field"><div class="structure_field_info">successiveRefreshAttempts : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.RefreshInfo" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.PartialHandlerInfo"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L67-L71">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PartialHandlerInfo</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.PartialHandlerInfo.mk"><li id="Lean.Server.FileWorker.PartialHandlerInfo.refreshMethod" class="structure_field"><div class="structure_field_info">refreshMethod : <a href="../.././Init/Prelude.html#String">String</a></div></li><li id="Lean.Server.FileWorker.PartialHandlerInfo.requestsInFlight" class="structure_field"><div class="structure_field_info">requestsInFlight : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li><li id="Lean.Server.FileWorker.PartialHandlerInfo.pendingRefreshInfo?" class="structure_field"><div class="structure_field_info">pendingRefreshInfo? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.RefreshInfo">RefreshInfo</a></span></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.PartialHandlerInfo" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.instInhabitedPartialHandlerInfo"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L71-L71">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.instInhabitedPartialHandlerInfo"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">instInhabitedPartialHandlerInfo</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo">PartialHandlerInfo</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.instInhabitedPartialHandlerInfo">Lean.Server.FileWorker.instInhabitedPartialHandlerInfo</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo.mk">{</a> <span class="fn">refreshMethod</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">requestsInFlight</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">pendingRefreshInfo?</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo.mk">}</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L75-L99">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.WorkerContext.mk"><li id="Lean.Server.FileWorker.WorkerContext.chanOut" class="structure_field"><div class="structure_field_info">chanOut : <span class="fn"><a href="../.././Std/Sync/Channel.html#Std.Channel">Std.Channel</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">JsonRpc.Message</a></span></div><div class="structure_field_doc"><p>Synchronized output channel for LSP messages. Notifications for outdated versions are
discarded on read.</p></div></li><li id="Lean.Server.FileWorker.WorkerContext.maxDocVersionRef" class="structure_field"><div class="structure_field_info">maxDocVersionRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Init/Data/Int/Basic.html#Int">Int</a></span></div><div class="structure_field_doc"><p>Latest document version received by the client, used for filtering out notifications from
previous versions.</p></div></li><li id="Lean.Server.FileWorker.WorkerContext.freshRequestIdRef" class="structure_field"><div class="structure_field_info">freshRequestIdRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Init/Data/Int/Basic.html#Int">Int</a></span></div></li><li id="Lean.Server.FileWorker.WorkerContext.stickyDiagnosticsRef" class="structure_field"><div class="structure_field_info">stickyDiagnosticsRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Widget/InteractiveDiagnostic.html#Lean.Widget.InteractiveDiagnostic">Widget.InteractiveDiagnostic</a>)</span></span></div><div class="structure_field_doc"><p>Diagnostics that are included in every single <code>textDocument/publishDiagnostics</code> notification.</p></div></li><li id="Lean.Server.FileWorker.WorkerContext.partialHandlersRef" class="structure_field"><div class="structure_field_info">partialHandlersRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Lean/Data/RBMap.html#Lean.RBMap">RBMap</a> <a href="../.././Init/Prelude.html#String">String</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo">PartialHandlerInfo</a> <a href="../.././Init/Data/Ord.html#Ord.compare">compare</a>)</span></span></div></li><li id="Lean.Server.FileWorker.WorkerContext.pendingServerRequestsRef" class="structure_field"><div class="structure_field_info">pendingServerRequestsRef : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Std/Data/TreeMap/Basic.html#Std.TreeMap">Std.TreeMap</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a> <span class="fn">(<a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse">ServerRequestResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span>)</span> <a href="../.././Init/Data/Ord.html#Ord.compare">compare</a>)</span></span></div></li><li id="Lean.Server.FileWorker.WorkerContext.hLog" class="structure_field"><div class="structure_field_info">hLog : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.initParams" class="structure_field"><div class="structure_field_info">initParams : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lsp.InitializeParams</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.processor" class="structure_field"><div class="structure_field_info">processor : <span class="fn"><a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext">Parser.InputContext</a> → <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.InitialSnapshot">Language.Lean.InitialSnapshot</a></span></span></div></li><li id="Lean.Server.FileWorker.WorkerContext.clientHasWidgets" class="structure_field"><div class="structure_field_info">clientHasWidgets : <a href="../.././Init/Prelude.html#Bool">Bool</a></div></li><li id="Lean.Server.FileWorker.WorkerContext.cmdlineOpts" class="structure_field"><div class="structure_field_info">cmdlineOpts : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a></div><div class="structure_field_doc"><p>Options defined on the worker cmdline (i.e. not including options from <code>setup-file</code>), used for
context-free tasks such as editing delay.</p></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.WorkerContext" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext.modifyGetPartialHandler"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L101-L106">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.modifyGetPartialHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">modifyGetPartialHandler</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo">PartialHandlerInfo</a> → <span class="fn">α</span> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo">PartialHandlerInfo</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">α</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.WorkerContext.modifyGetPartialHandler" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext.modifyPartialHandler"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L108-L113">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.modifyPartialHandler"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">modifyPartialHandler</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo">PartialHandlerInfo</a> → <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PartialHandlerInfo">PartialHandlerInfo</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.WorkerContext.modifyPartialHandler" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext.updateRequestsInFlight"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L115-L116">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.updateRequestsInFlight"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">updateRequestsInFlight</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href="../.././Init/Prelude.html#Nat">Nat</a> → <a href="../.././Init/Prelude.html#Nat">Nat</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.WorkerContext.updateRequestsInFlight" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext.initPendingServerRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L118-L131">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.initPendingServerRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">initPendingServerRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">responseType</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">FromJson</a> <span class="fn">responseType</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">responseType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse">ServerRequestResponse</a> <span class="fn">responseType</span>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.WorkerContext.initPendingServerRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerContext.resolveServerRequestResponse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L133-L141">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.resolveServerRequestResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerContext</span>.<span class="name">resolveServerRequestResponse</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">response</span> : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse">ServerRequestResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.WorkerContext.resolveServerRequestResponse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h1 class="markdown-heading" id="Asynchronous-snapshot-elaboration">Asynchronous snapshot elaboration <a class="hover-link" href="#Asynchronous-snapshot-elaboration">#</a></h1></div><div class="decl" id="Lean.Server.FileWorker.instInhabitedReportSnapshotsState"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L178-L178">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.instInhabitedReportSnapshotsState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">instInhabitedReportSnapshotsState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Server/FileWorker.html#_private.Lean.Server.FileWorker.0.Lean.Server.FileWorker.ReportSnapshotsState">Lean.Server.FileWorker.ReportSnapshotsState✝</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.instInhabitedReportSnapshotsState">Lean.Server.FileWorker.instInhabitedReportSnapshotsState</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Server/FileWorker.html#_private.Lean.Server.FileWorker.0.Lean.Server.FileWorker.ReportSnapshotsState.mk">{</a> <span class="fn">hasBlocked</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">allInfoTrees</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">newInfoTrees</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">hasFatal</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Server/FileWorker.html#_private.Lean.Server.FileWorker.0.Lean.Server.FileWorker.ReportSnapshotsState.mk">}</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.server.reportDelayMs"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L180-L187">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.server.reportDelayMs"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">server</span>.<span class="name">reportDelayMs</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span></div></div></div></div><div class="decl" id="Lean.Server.FileWorker.MemorizedInteractiveDiagnostics"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L189-L196">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.MemorizedInteractiveDiagnostics"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">MemorizedInteractiveDiagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Type of state stored in <code>Snapshot.Diagnostics.cacheRef?</code>.</p><p>See also section &quot;Communication&quot; in Lean/Server/README.md.</p><ul class="structure_fields" id="Lean.Server.FileWorker.MemorizedInteractiveDiagnostics.mk"><li id="Lean.Server.FileWorker.MemorizedInteractiveDiagnostics.diags" class="structure_field"><div class="structure_field_info">diags : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Widget/InteractiveDiagnostic.html#Lean.Widget.InteractiveDiagnostic">Widget.InteractiveDiagnostic</a></span></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.MemorizedInteractiveDiagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.instTypeNameMemorizedInteractiveDiagnostics"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L196-L196">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.instTypeNameMemorizedInteractiveDiagnostics"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">instTypeNameMemorizedInteractiveDiagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.MemorizedInteractiveDiagnostics">MemorizedInteractiveDiagnostics</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.instTypeNameMemorizedInteractiveDiagnostics">Lean.Server.FileWorker.instTypeNameMemorizedInteractiveDiagnostics</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.inst._@.Lean.Server.FileWorker._hyg.804">Lean.Server.FileWorker.inst✝</a></li></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.PendingRequest"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L336-L338">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PendingRequest</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.PendingRequest.mk"><li id="Lean.Server.FileWorker.PendingRequest.requestTask" class="structure_field"><div class="structure_field_info">requestTask : <span class="fn"><a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <a href="../.././Init/Prelude.html#Unit">Unit</a>)</span></span></div></li><li id="Lean.Server.FileWorker.PendingRequest.cancelTk" class="structure_field"><div class="structure_field_info">cancelTk : <a href="../.././Lean/Server/RequestCancellation.html#Lean.Server.RequestCancellationToken">RequestCancellationToken</a></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.PendingRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.PendingRequestMap"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L341-L341">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">PendingRequestMap</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">Lean.Server.FileWorker.PendingRequestMap</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">Lean.RBMap</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">Lean.JsonRpc.RequestID</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequest">Lean.Server.FileWorker.PendingRequest</a> <a href="../.././Init/Data/Ord.html#Ord.compare">compare</a></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.PendingRequestMap" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.AvailableImportsCache"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L343-L345">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AvailableImportsCache"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">AvailableImportsCache</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.AvailableImportsCache.mk"><li id="Lean.Server.FileWorker.AvailableImportsCache.availableImports" class="structure_field"><div class="structure_field_info">availableImports : <a href="../.././Lean/Server/Completion/ImportCompletion.html#ImportCompletion.AvailableImports">ImportCompletion.AvailableImports</a></div></li><li id="Lean.Server.FileWorker.AvailableImportsCache.lastRequestTimestampMs" class="structure_field"><div class="structure_field_info">lastRequestTimestampMs : <a href="../.././Init/Prelude.html#Nat">Nat</a></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.AvailableImportsCache" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L347-L355">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Server.FileWorker.WorkerState.mk"><li id="Lean.Server.FileWorker.WorkerState.doc" class="structure_field"><div class="structure_field_info">doc : <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.EditableDocument">EditableDocument</a></div></li><li id="Lean.Server.FileWorker.WorkerState.reporterCancelTk" class="structure_field"><div class="structure_field_info">reporterCancelTk : <a href="../.././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></div><div class="structure_field_doc"><p>Token flagged for aborting <code>doc.reporter</code> when a new document version comes in.</p></div></li><li id="Lean.Server.FileWorker.WorkerState.importCachingTask?" class="structure_field"><div class="structure_field_info">importCachingTask? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AvailableImportsCache">AvailableImportsCache</a>)</span>)</span></span></div></li><li id="Lean.Server.FileWorker.WorkerState.pendingRequests" class="structure_field"><div class="structure_field_info">pendingRequests : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">PendingRequestMap</a></div></li><li id="Lean.Server.FileWorker.WorkerState.rpcSessions" class="structure_field"><div class="structure_field_info">rpcSessions : <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap">RBMap</a> <a href="../.././Init/Prelude.html#UInt64">UInt64</a> <span class="fn">(<a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Lean/Server/FileWorker/Utils.html#Lean.Server.FileWorker.RpcSession">RpcSession</a>)</span> <a href="../.././Init/Data/Ord.html#Ord.compare">compare</a></span></div><div class="structure_field_doc"><p>A map of RPC session IDs. We allow asynchronous elab tasks and request handlers
to modify sessions. A single <code>Ref</code> ensures atomic transactions.</p></div></li></ul><details id="instances-for-list-Lean.Server.FileWorker.WorkerState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.WorkerM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L357-L357">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">WorkerM</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">Lean.Server.FileWorker.WorkerM</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">Lean.Server.FileWorker.WorkerContext</a> <span class="fn">(<a href="../.././Init/Control/StateRef.html#StateRefT'">StateRefT'</a> <a href="../.././Init/System/IO.html#IO.RealWorld">IO.RealWorld</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState">Lean.Server.FileWorker.WorkerState</a> <a href="../.././Init/System/IO.html#IO">IO</a>)</span></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.WorkerM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.setupImports"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L363-L422">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.setupImports"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">setupImports</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">meta</span> : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cmdlineOpts</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">chanOut</span> : <span class="fn"><a href="../.././Std/Sync/Channel.html#Std.Channel">Std.Channel</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">JsonRpc.Message</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">stx</span> : <a href="../.././Init/Prelude.html#Lean.TSyntax">TSyntax</a> <span class="fn">`Lean.Parser.Module.header</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Language.ProcessingT</a> <a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.HeaderProcessedSnapshot">Language.Lean.HeaderProcessedSnapshot</a> <a href="../.././Lean/Language/Lean.html#Lean.Language.Lean.SetupImportsResult">Language.Lean.SetupImportsResult</a>)</span></span></div></div><p>Callback from Lean language processor after parsing imports that requests necessary information from
Lake for processing imports.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.setupImports" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.initializeWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L426-L513">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initializeWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">meta</span> : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">o </span><span class="fn">e</span> : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">initParams</span> : <a href="../.././Lean/Data/Lsp/InitShutdown.html#Lean.Lsp.InitializeParams">Lsp.InitializeParams</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> (<a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a> <a href="../.././Init/Prelude.html#Prod">×</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState">WorkerState</a>)</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.initializeWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.initializeWorker.mkLspOutputChannel"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L481-L505">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initializeWorker.mkLspOutputChannel"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span>.<span class="name">mkLspOutputChannel</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">o</span> : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">maxDocVersion</span> : <span class="fn"><a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <a href="../.././Init/Data/Int/Basic.html#Int">Int</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href="../.././Std/Sync/Channel.html#Std.Channel">Std.Channel</a> <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">JsonRpc.Message</a>)</span></span></div></div><p>Creates an LSP message output channel along with a reader that sends out read messages on
the output FS stream after discarding outdated notifications. This is the only component of
the worker with access to the output stream, so we can synchronize messages from parallel
elaboration tasks here.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.initializeWorker.mkLspOutputChannel" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.initializeWorker.getImportClosure?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L507-L513">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initializeWorker.getImportClosure?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initializeWorker</span>.<span class="name">getImportClosure?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">snap</span> : <a href="../.././Lean/Language/Lean/Types.html#Lean.Language.Lean.InitialSnapshot">Language.Lean.InitialSnapshot</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Init/Prelude.html#Lean.Name">Name</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.initializeWorker.getImportClosure?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.sendServerRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L518-L529">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.sendServerRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">sendServerRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">paramType</span> : <a href="../.././foundational_types.html">Type</a> u_1)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.ToJson">ToJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">responseType</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">FromJson</a> <span class="fn">responseType</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">responseType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">param</span> : <span class="fn">paramType</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse">ServerRequestResponse</a> <span class="fn">responseType</span>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.sendServerRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.sendUntypedServerRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L531-L536">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.sendUntypedServerRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">sendUntypedServerRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">param</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse">ServerRequestResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.sendUntypedServerRequest">Lean.Server.FileWorker.sendUntypedServerRequest</a> <span class="fn">ctx</span> <span class="fn">method</span> <span class="fn">param</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.sendServerRequest">Lean.Server.FileWorker.sendServerRequest</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Lean.Json</a> <span class="fn">ctx</span> <span class="fn">method</span> <span class="fn">param</span></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.sendUntypedServerRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.updatePendingRequests"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L541-L542">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updatePendingRequests"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updatePendingRequests</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">map</span> : <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">PendingRequestMap</a> → <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">PendingRequestMap</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.updatePendingRequests" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.updateDocument"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L544-L557">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updateDocument"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">updateDocument</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">meta</span> : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">DocumentMeta</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Given the new document, updates editable doc state.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.updateDocument" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleDidChange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L563-L587">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleDidChange"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleDidChange</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">p</span> : <a href="../.././Lean/Data/Lsp/TextSync.html#Lean.Lsp.DidChangeTextDocumentParams">Lsp.DidChangeTextDocumentParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleDidChange" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleCancelRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L589-L594">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleCancelRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleCancelRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">p</span> : <a href="../.././Lean/Data/Lsp/CancelParams.html#Lean.Lsp.CancelParams">Lsp.CancelParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleCancelRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleStaleDependency"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L596-L616">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleStaleDependency"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleStaleDependency</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Lsp/Internal.html#Lean.Lsp.LeanStaleDependencyParams">Lsp.LeanStaleDependencyParams</a> → <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></span></div></div><p>Received from the watchdog when a dependency of this file is detected as being stale.
Issues a sticky diagnostic to the client that it should run &quot;Restart File&quot;.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleStaleDependency" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleRpcRelease"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L618-L629">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRpcRelease"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcRelease</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">p</span> : <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcReleaseParams">Lsp.RpcReleaseParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleRpcRelease" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleRpcKeepAlive"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L631-L635">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRpcKeepAlive"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcKeepAlive</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">p</span> : <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcKeepAliveParams">Lsp.RpcKeepAliveParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleRpcKeepAlive" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><p>Requests here are handled synchronously rather than in the asynchronous <code>RequestM</code>.</p></div><div class="decl" id="Lean.Server.FileWorker.handleRpcConnect"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L642-L646">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRpcConnect"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRpcConnect</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcConnectParams">Lsp.RpcConnectParams</a> → <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Lean/Data/Lsp/Extra.html#Lean.Lsp.RpcConnected">Lsp.RpcConnected</a></span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleRpcConnect" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.parseParams"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L651-L654">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.parseParams"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">parseParams</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">paramType</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Data/Json/FromToJson.html#Lean.FromJson">FromJson</a> <span class="fn">paramType</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <span class="fn">paramType</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.parseParams" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleNotification"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L656-L665">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleNotification"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleNotification</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleNotification">Lean.Server.FileWorker.handleNotification</a> <span class="fn">method</span> <span class="fn">params</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<a href="../.././Lean/Server/Utils.html#IO.throwServerError">IO.throwServerError</a> (<span class="fn"><a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">&quot;Got unsupported notification method: &quot;</span></span> <a href="../.././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn"><a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">method</span></span> <a href="../.././Init/Prelude.html#HAppend.hAppend">++</a> <span class="fn"><a href="../.././Init/Data/ToString/Basic.html#ToString.toString">toString</a> <span class="fn">&quot;&quot;</span></span>))</span></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleNotification" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.queueRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L667-L669">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.queueRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">queueRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">r</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequest">PendingRequest</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.queueRequest">Lean.Server.FileWorker.queueRequest</a> <span class="fn">id</span> <span class="fn">r</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.updatePendingRequests">Lean.Server.FileWorker.updatePendingRequests</a> <span class="fn">fun (<span class="fn">x</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.PendingRequestMap">Lean.Server.FileWorker.PendingRequestMap</a>) =&gt;
    <span class="fn"><a href="../.././Lean/Data/RBMap.html#Lean.RBMap.insert">Lean.RBMap.insert</a> <span class="fn">x</span> <span class="fn">id</span> <span class="fn">r</span></span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.queueRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleImportCompletionRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L671-L693">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleImportCompletionRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleImportCompletionRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Lsp/LanguageFeatures.html#Lean.Lsp.CompletionParams">Lsp.CompletionParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.AvailableImportsCache">AvailableImportsCache</a>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleImportCompletionRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleStatefulPreRequestSpecialCases"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L695-L718">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleStatefulPreRequestSpecialCases"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleStatefulPreRequestSpecialCases</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleStatefulPreRequestSpecialCases" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleGetInteractiveDiagnosticsRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L721-L745">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleGetInteractiveDiagnosticsRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleGetInteractiveDiagnosticsRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Server/FileWorker/WidgetRequests.html#Lean.Widget.GetInteractiveDiagnosticsParams">Widget.GetInteractiveDiagnosticsParams</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">RequestM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Widget/InteractiveDiagnostic.html#Lean.Widget.InteractiveDiagnostic">Widget.InteractiveDiagnostic</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleGetInteractiveDiagnosticsRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handlePreRequestSpecialCases?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L747-L778">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handlePreRequestSpecialCases?"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handlePreRequestSpecialCases?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">st</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerState">WorkerState</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">RequestM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">RequestTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.LspResponse">LspResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handlePreRequestSpecialCases?">Lean.Server.FileWorker.handlePreRequestSpecialCases?</a> <span class="fn">ctx</span> <span class="fn">st</span> <span class="fn">id</span> <span class="fn">method</span> <span class="fn">params</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <a href="../.././Init/Prelude.html#Option.none">none</a></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handlePreRequestSpecialCases?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handlePostRequestSpecialCases"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L780-L812">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handlePostRequestSpecialCases"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handlePostRequestSpecialCases</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">task</span> : <span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">RequestTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.LspResponse">LspResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/Requests.html#Lean.Server.RequestM">RequestM</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">RequestTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.LspResponse">LspResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handlePostRequestSpecialCases" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.emitRequestResponse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L814-L848">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.emitRequestResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">emitRequestResponse</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">requestTask?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Lean/Server/Requests.html#Lean.Server.RequestError">RequestError</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.RequestTask">RequestTask</a> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.LspResponse">LspResponse</a> <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span>)</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk</span> : <a href="../.././Lean/Server/RequestCancellation.html#Lean.Server.RequestCancellationToken">RequestCancellationToken</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <a href="../.././Init/Prelude.html#Unit">Unit</a>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.emitRequestResponse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.emitRequestResponse.emitResponse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L838-L848">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.emitRequestResponse.emitResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">emitRequestResponse</span>.<span class="name">emitResponse</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">ctx</span> : <a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext">WorkerContext</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">m</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.Message">JsonRpc.Message</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">isComplete</span> : <a href="../.././Init/Prelude.html#Bool">Bool</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.emitRequestResponse.emitResponse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleRequest"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L850-L881">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleRequest"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleRequest</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">method</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleRequest" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleResponse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L883-L885">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleResponse"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleResponse</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">response</span> : <a href="../.././Lean/Data/Json/Basic.html#Lean.Json">Json</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleResponse">Lean.Server.FileWorker.handleResponse</a> <span class="fn">id</span> <span class="fn">response</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">ctx</span> ← <a href="../.././Init/Prelude.html#MonadReader.read">read</a>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn"><span class="fn">ctx</span>.<a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.resolveServerRequestResponse">resolveServerRequestResponse</a></span> <span class="fn">id</span> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse.success">Lean.Server.ServerRequestResponse.success</a> <span class="fn">response</span>)</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleResponse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.handleResponseError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L887-L889">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleResponseError"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">handleResponseError</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">id</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.RequestID">JsonRpc.RequestID</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">code</span> : <a href="../.././Lean/Data/JsonRpc.html#Lean.JsonRpc.ErrorCode">JsonRpc.ErrorCode</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">message</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.handleResponseError">Lean.Server.FileWorker.handleResponseError</a> <span class="fn">id</span> <span class="fn">code</span> <span class="fn">message</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">ctx</span> ← <a href="../.././Init/Prelude.html#MonadReader.read">read</a>
  <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn"><span class="fn">ctx</span>.<a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerContext.resolveServerRequestResponse">resolveServerRequestResponse</a></span> <span class="fn">id</span> <span class="fn">(<a href="../.././Lean/Server/Requests.html#Lean.Server.ServerRequestResponse.failure">Lean.Server.ServerRequestResponse.failure</a> <span class="fn">code</span> <span class="fn">message</span>)</span>)</span></span></span></li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.handleResponseError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.mainLoop"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L895-L932">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.mainLoop"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">mainLoop</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">hIn</span> : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div></div></div><div class="decl" id="Lean.Server.FileWorker.runRefreshTasks"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L935-L1004">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.runRefreshTasks"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">runRefreshTasks</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.WorkerM">WorkerM</a> <span class="fn">(<a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Lean/Server/ServerTask.html#Lean.Server.ServerTask">ServerTask</a> <a href="../.././Init/Prelude.html#Unit">Unit</a>)</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.runRefreshTasks" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.runRefreshTasks.sleepWithCancellation"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L993-L1004">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.runRefreshTasks.sleepWithCancellation"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">runRefreshTasks</span>.<span class="name">sleepWithCancellation</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">ms</span> : <a href="../.././Init/Prelude.html#UInt32">UInt32</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.runRefreshTasks.sleepWithCancellation" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.initAndRunWorker"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L1006-L1045">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initAndRunWorker"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initAndRunWorker</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">i </span><span class="fn">o </span><span class="fn">e</span> : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.initAndRunWorker" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.initAndRunWorker.writeErrorDiag"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L1040-L1045">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.initAndRunWorker.writeErrorDiag"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">initAndRunWorker</span>.<span class="name">writeErrorDiag</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">o</span> : <a href="../.././Init/System/IO.html#IO.FS.Stream">IO.FS.Stream</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">meta</span> : <a href="../.././Lean/Server/Utils.html#Lean.Server.DocumentMeta">DocumentMeta</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">err</span> : <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.initAndRunWorker.writeErrorDiag" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Server.FileWorker.workerMain"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/81b85203c90439fb7d7e0cec32130d62d8cb7a2e/src/Lean/Server/FileWorker.lean#L1047-L1057">source</a></div><div class="attributes">@[export lean_server_worker_main]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Server/FileWorker.html#Lean.Server.FileWorker.workerMain"><span class="name">Lean</span>.<span class="name">Server</span>.<span class="name">FileWorker</span>.<span class="name">workerMain</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#UInt32">UInt32</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Server.FileWorker.workerMain" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>